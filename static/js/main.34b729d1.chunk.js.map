{"version":3,"sources":["classes/Scene.ts","space/PERSPECTIVE.ts","space/LinePath.tsx","space/Anchor.tsx","styles.ts","textures/water-2.png","space/MonochromeBox.tsx","space/Viewport.tsx","demos/scaffolding.tsx","demos/demo.cubes.tsx","util/Event.ts","ui/ContextMenu.tsx","Game.ts","util/BinaryHeap.ts","classes/Path.ts","constants/names.tsx","entities/Entity.tsx","entities/PersonEntity.tsx","entities/CivilianEntity.tsx","classes/Coordinate.ts","entities/GuardEntity.tsx","util/Random.ts","jobs/Job.ts","jobs/LoiterJob.ts","jobs/PatrolJob.ts","generators/hello-world.ts","terrain/DualMeshTileComponent.tsx","terrain/GenericTerrain.ts","terrain/DualMeshTerrain.ts","ui/ActiveEntityOverlay.tsx","ui/Overlay.tsx","ui/GameApplication.tsx","App.tsx","index.tsx"],"names":["Scene","seed","terrain","entities","this","destroyers","map","entity","play","forEach","d","PERSPECTIVE","degrees","tileSize","_cos","_sin","_tan","isometricAngle","Math","PI","cos","sin","tan","x","y","z","cartX","cartY","tileHeight","isoY","distanceToCameraComparator","a","b","dZ","dX","dY","LinePath","path","stroke","strokeWidth","spatialCoordinates","coordinate","toPixels","cc","c","reduce","lines","start","i","all","concat","x1","y1","x2","y2","String","Crosshair","size","points","Anchor","children","crosshairSize","pixels","useMemo","overflow","MovingAnchor","moveTo","moveSpeed","onRest","onClick","dx","dy","ix","iy","loc","useSpring","to","config","duration","from","svg","color","background","Color","white","beach","highlightedTerrain","lighten","terrainStroke","darken","saturate","styles","css","string","coordsToPixels","coords","borderWidth","COORDINATE_CLOSEST_TO_CAMERA","BORDER_NODES","XZ_NODES","YZ_NODES","XY_NODES","MonochromeBox","fill","strokeLinecap","innerStroke","desaturate","innerStrokeWidth","gProps","innerStrokeCss","strokeCss","style","onContextMenu","cursor","join","PIXEL_FRIENDLY_PYTHAGORAS","pow","mathRoundMaybe","n","round","AbsolutelyPositionedContainer","styled","div","Viewport","overlay","center","zoom","translateX","translateY","springStyles","transform","ViewportSvgContainer","rest","width","height","shapeRendering","viewBox","NoAxis","YAxis","ZAxis","sqrt","XAxis","ViewportHtmlContainer","location","axis","left","top","pixelWidth","Axis","abs","Backdrop","Demo","window","alert","Event","listeners","callback","push","splice","indexOf","args","borderColor","ContextMenuArrow","ContextMenuBoundary","ContextMenuBody","ContextMenuButton","button","ContextMenuFooter","ContextMenuManager","state","$changed","contents","emit","ContextMenuContainer","contextMenu","useGame","useState","managerState","setManagerState","useEffect","Error","on","Game","scene","GameContext","createContext","gameApi","useContext","BinaryHeap","scoreFunction","content","element","sinkDown","length","result","end","pop","bubbleUp","node","parentN","parent","elemScore","child2N","child1N","swap","child1Score","child1","child2","DIAGONAL","pos0","pos1","D2","d1","d2","min","Path","graph","options","cache","heap","heuristic","Map","get","f","closestNode","closestNodeHeuristics","h","g","closed","visited","set","currentNode","currentNodeHeuristics","equals","tracePath","neighbors","getNeighborTiles","il","neighbor","neighborHeuristics","isLand","gScore","beenVisited","hScore","closest","rescoreElement","console","warn","heuristicReport","curr","unshift","FIRST_NAMES_M","replace","split","name","trim","FIRST_NAMES_F","noop","PersonEntity","id","$startedWalking","$stoppedWalking","$startedWalkStep","$stoppedWalkStep","passport","Component","cx","cy","r","feminine","random","firstName","floor","destination","find","unlisten","nextStep","shift","doPathStep","hasNaN","job","constructor","PersonEntityComponent","animatePosition","deps","cb","useCallback","eventDestroyers","useEventListeners","euclideanDistanceTo","CivilianEntity","Coordinate","coord","dz","isNaN","xy","offset","GuardEntity","mix","Random","seedrandom","double","arr","index","float","Job","LoiterJob","walkMinWait","walkMaxWait","walkChanceOnRoll","walkMaxDistance","steps","doTimeout","setTimeout","destinations","selectClosestTiles","walkTo","arrayItem","PatrolJob","waypoints","waypointIndex","next","repeat","Array","_","generateEntities","walkableTiles","tiles","filter","guard","island","getIslands","includes","generatePatrolJob","doJob","worker","TERRAIN_FILL","TERRAIN_FILL_HIGHLIGHTED","TERRAIN_STROKE","TERRAIN_STROKE_WATER","opaquer","DualMeshTileComponent","tile","svgProps","isHovered","setIsHovered","_neighbors","some","_outlinePoints","className","onMouseEnter","onMouseLeave","DualMeshTerrainComponent","onTileClick","onTileContextMenu","pathElements","seen","connections","origin","target","strokeDasharray","terrainElements","getTilesInRenderOrder","event","preventDefault","stopPropagation","toString","GenericTile","num","toFixed","coord2","GenericTerrain","_tilesInRenderOrder","islands","selector","queue","current","neighbours","maxDistance","selectContiguousTiles","other","t","fromCache","open","slice","sort","DualMeshTile","_isGhost","_isLand","undefined","item","maxDepth","DualMeshTerrain","_mesh","props","React","createElement","last","distance","Infinity","generateRandom","density","poisson","Poisson","shape","minDistance","meshBuilder","MeshBuilder","boundarySpacing","p","addPoint","mesh","create","coordinates","outlinePointIndices","r_circulate_t","t_x","t_y","t_ghost","r_circulate_r","Boolean","ActiveEntityOverlayBoundary","ActiveEntityOverlayBody","Avatar","HorizontalLinkList","nav","HorizontalLinkListItem","EntityTextBadge","label","marginTop","group","log","groupEnd","ActiveEntityOverlay","Overlay","section","fancyTimeFormat","seconds","GameApplication","game","initialViewportCenter","setCenter","activeEntity","setActiveEntity","close","addEventListener","removeEventListener","fontSize","opacity","href","rel","GameRoute","gameApplicationProps","Date","now","generateTerrain","getClosestToXy","generateEverything","Provider","value","TestRoute","exact","component","DemoCubes","App","ReactDOM","render","StrictMode","globalStyleRules","hashType","document","getElementById"],"mappings":"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","file":"static/js/main.34b729d1.chunk.js","sourcesContent":["import { Entity } from '../entities/Entity';\nimport { GenericTerrain, GenericTile } from '../terrain/GenericTerrain';\n\nexport class Scene<T extends GenericTerrain<GenericTile> = GenericTerrain<GenericTile>> {\n\tpublic readonly terrain: T;\n\n\t// @TODO change to not readonly, and handle spontaneous changes\n\tpublic readonly entities: Entity[];\n\n\tpublic readonly seed;\n\n\tconstructor(seed: string, terrain: T, entities: Entity[]) {\n\t\tthis.seed = seed;\n\t\tthis.terrain = terrain;\n\t\tthis.entities = entities;\n\t}\n\n\tplay() {\n\t\tconst destroyers = this.entities.map((entity) => entity.play());\n\t\treturn () => destroyers.forEach((d) => d());\n\t}\n}\n","import { CoordinateLike } from '../classes/Coordinate';\n\n//        z+,                height\n//        |        __ y+,    depth\n//        |     __/\n//        |  __/\n//    0,0 |_/\n//          \\__\n//             \\__\n//                \\__ x+,    width\n\nconst BASE_LENGTH = 32;\n\nexport type InGameDistance = number;\nexport type OnScreenDistance = number;\nexport type OnSreenAngle = number;\n\nclass Perspective {\n\tpublic readonly degrees: OnSreenAngle;\n\tpublic readonly tileSize: OnScreenDistance;\n\n\tprivate _cos: OnSreenAngle;\n\tprivate _sin: OnSreenAngle;\n\tprivate _tan: OnSreenAngle;\n\n\tconstructor(degrees: OnSreenAngle, tileSize: OnScreenDistance) {\n\t\tthis.degrees = degrees;\n\t\tthis.tileSize = tileSize;\n\n\t\tconst isometricAngle = degrees * (Math.PI / 180);\n\t\tthis._cos = Math.cos(isometricAngle);\n\t\tthis._sin = Math.sin(isometricAngle);\n\t\tthis._tan = Math.tan(isometricAngle);\n\t}\n\n\ttoPixels(\n\t\tx: InGameDistance,\n\t\ty: InGameDistance,\n\t\tz: InGameDistance\n\t): [OnScreenDistance, OnScreenDistance] {\n\t\tconst cartX = (x + y) * this._cos,\n\t\t\tcartY = (x - y) * this._sin;\n\n\t\tconst tileHeight = this.tileSize;\n\n\t\treturn [\n\t\t\tcartX * this.tileSize, // x\n\t\t\tcartY * this.tileSize - tileHeight * z // y\n\t\t];\n\t}\n\n\tprivate toCoords(\n\t\tcartX: InGameDistance,\n\t\tcartY: InGameDistance\n\t): [InGameDistance, InGameDistance, InGameDistance] {\n\t\tconst isoY = this._tan * cartX + cartY,\n\t\t\tisoX = (cartY - isoY) / -this._sin - isoY;\n\n\t\t// this is good so far, b should be rescaled for tile size. as\n\t\treturn [isoX / this.tileSize, isoY / this.tileSize, 0];\n\t}\n}\n\nexport const PERSPECTIVE = new Perspective(30, BASE_LENGTH);\n\nexport function distanceToCameraComparator(a: CoordinateLike, b: CoordinateLike) {\n\tconst dZ = b.z - a.z;\n\tif (dZ) {\n\t\treturn -dZ;\n\t}\n\tconst dX = b.x - a.x;\n\tif (dX) {\n\t\treturn -dX;\n\t}\n\n\tconst dY = a.y - b.y;\n\tif (dY) {\n\t\treturn -dY;\n\t}\n\treturn 0;\n}\n","import React, { FunctionComponent, ReactElement } from 'react';\nimport { CoordinateArray } from '../classes/Coordinate';\n\nimport { PERSPECTIVE } from './PERSPECTIVE';\n\nconst BORDER_WIDTH = 0;\n\nexport const LinePath: FunctionComponent<\n\tOmit<React.SVGProps<SVGLineElement>, 'path'> & {\n\t\tpath: CoordinateArray[];\n\t}\n> = ({ path, stroke = 'black', strokeWidth = BORDER_WIDTH }) => {\n\tlet spatialCoordinates = path\n\t\t.map(coordinate => PERSPECTIVE.toPixels(...coordinate))\n\t\t.map(cc => cc.map(c => c + BORDER_WIDTH));\n\n\treturn (\n\t\t<>\n\t\t\t{spatialCoordinates.reduce<ReactElement[]>(\n\t\t\t\t(lines, start, i, all) =>\n\t\t\t\t\ti\n\t\t\t\t\t\t? lines.concat([\n\t\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\t\t\tx1={start[0]}\n\t\t\t\t\t\t\t\t\ty1={start[1]}\n\t\t\t\t\t\t\t\t\tx2={all[i - 1][0]}\n\t\t\t\t\t\t\t\t\ty2={all[i - 1][1]}\n\t\t\t\t\t\t\t\t\tstroke={stroke}\n\t\t\t\t\t\t\t\t\tstrokeWidth={String(strokeWidth)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t  ])\n\t\t\t\t\t\t: lines,\n\t\t\t\t[]\n\t\t\t)}\n\t\t</>\n\t);\n};\n","import { useSpring } from '@react-spring/core';\nimport { animated } from '@react-spring/web';\nimport React, { FunctionComponent, useMemo } from 'react';\nimport { CoordinateArray, CoordinateLike } from '../classes/Coordinate';\nimport { SvgMouseInteractionProps } from '../types';\nimport { LinePath } from './LinePath';\nimport { InGameDistance, PERSPECTIVE } from './PERSPECTIVE';\n\nconst Crosshair: FunctionComponent<{ size: InGameDistance }> = ({ size = 4 }) => {\n\tconst lines: CoordinateArray[][] = [\n\t\t[\n\t\t\t// over the x axis\n\t\t\t[-1 * size, 0, 0],\n\t\t\t[size, 0, 0]\n\t\t],\n\t\t[\n\t\t\t// over the y axis\n\t\t\t[0, -1 * size, 0],\n\t\t\t[0, size, 0]\n\t\t],\n\t\t[\n\t\t\t// over the z axis\n\t\t\t[0, 0, -1 * size],\n\t\t\t[0, 0, size]\n\t\t]\n\t];\n\n\treturn (\n\t\t<>\n\t\t\t{lines.map((points, i) => (\n\t\t\t\t<LinePath key={i} path={points} stroke={'rgba(0,0,0)'} strokeWidth={0.5} />\n\t\t\t))}\n\t\t</>\n\t);\n};\n\nexport const Anchor: FunctionComponent<\n\tSvgMouseInteractionProps & {\n\t\tcrosshairSize?: InGameDistance;\n\t} & Partial<CoordinateLike>\n> = ({ x = 0, y = 0, z = 0, children, crosshairSize = 0 }) => {\n\tconst pixels = useMemo(() => PERSPECTIVE.toPixels(x, y, z), [x, y, z]);\n\n\treturn (\n\t\t<svg x={pixels[0]} y={pixels[1]} overflow={'visible'}>\n\t\t\t{crosshairSize ? <Crosshair size={crosshairSize} /> : null}\n\t\t\t{children}\n\t\t</svg>\n\t);\n};\n\nexport const MovingAnchor: FunctionComponent<\n\tSvgMouseInteractionProps & {\n\t\tmoveTo: CoordinateLike;\n\t\tmoveSpeed: number;\n\t\tonRest?: () => void;\n\t\tcrosshairSize?: InGameDistance;\n\t}\n> = ({ moveTo, moveSpeed, onRest, children, crosshairSize = 0, onClick }) => {\n\tconst [dx, dy] = useMemo(() => PERSPECTIVE.toPixels(moveTo.x, moveTo.y, moveTo.z), [moveTo]);\n\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\tconst [ix, iy] = useMemo(() => [dx, dy], []);\n\n\t// if (isNaN(dx) || isNaN(dy)) {\n\t// \tdebugger;\n\t// }\n\tconst loc = useSpring({\n\t\tto: {\n\t\t\tx: dx,\n\t\t\ty: dy\n\t\t},\n\t\tconfig: {\n\t\t\tduration: moveSpeed\n\t\t},\n\t\tfrom: {\n\t\t\tx: ix,\n\t\t\ty: iy\n\t\t},\n\t\tonRest\n\t});\n\n\t// @TODO reuse <Anchor>\n\treturn (\n\t\t<animated.svg x={loc.x} y={loc.y} overflow={'visible'} onClick={onClick}>\n\t\t\t{crosshairSize ? <Crosshair size={crosshairSize} /> : null}\n\t\t\t{children}\n\t\t</animated.svg>\n\t);\n};\n","import { css } from '@emotion/react';\nimport Color from 'color';\nimport nebulaTexture from './textures/water-2.png';\n\nexport const color: Record<string, Color> = {};\ncolor.background = Color('#cde1fc');\ncolor.white = Color('#fff');\ncolor.terrain = Color('#a1d83c');\ncolor.beach = Color('#f7d884');\ncolor.highlightedTerrain = color.terrain.lighten(1);\ncolor.terrainStroke = color.terrain.darken(0.5).saturate(0.3);\nconst styles = css`\n\t:root {\n\t}\n\n\tbody {\n\t\tbackground: ${color.background.string()} url(${nebulaTexture});\n\t}\n\n\tp {\n\t\tmargin: 0;\n\t}\n`;\n\nexport default styles;\n","export default \"data:image/png;base64,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\"","import Color from 'color';\nimport React, { FunctionComponent } from 'react';\nimport { CoordinateArray } from '../classes/Coordinate';\nimport { color } from '../styles';\nimport { SvgMouseInteractionProps } from '../types';\nimport { InGameDistance, PERSPECTIVE } from './PERSPECTIVE';\n\nconst BORDER_WIDTH = 0;\n\nfunction coordsToPixels(coords: CoordinateArray[], borderWidth = BORDER_WIDTH) {\n\treturn coords\n\t\t.map(coordinate => PERSPECTIVE.toPixels(...coordinate))\n\t\t.map(cc => cc.map(c => c + borderWidth));\n}\n\nconst COORDINATE_CLOSEST_TO_CAMERA = PERSPECTIVE.toPixels(1, 0, 1).map(c => c + BORDER_WIDTH);\n\nlet BORDER_NODES = coordsToPixels([\n\t[1, 1, 0], // 0\n\t[1, 1, 1],\n\t[0, 1, 1], // 2\n\t[0, 0, 1],\n\t[0, 0, 0], // 4\n\t[1, 0, 0]\n]);\n\n// facing to the bottom left, aka -y\nlet XZ_NODES = coordsToPixels([\n\t[0, 0, 0],\n\t[0, 0, 1],\n\t[1, 0, 1],\n\t[1, 0, 0]\n]);\n\n// facing to the bottom right, aka +x\nlet YZ_NODES = coordsToPixels([\n\t[1, 0, 0],\n\t[1, 1, 0],\n\t[1, 1, 1],\n\t[1, 0, 1]\n]);\n\n// facing top, aka +z\nlet XY_NODES = coordsToPixels([\n\t[0, 0, 1],\n\t[1, 0, 1],\n\t[1, 1, 1],\n\t[0, 1, 1]\n]);\n\nexport const MonochromeBox: FunctionComponent<\n\tSvgMouseInteractionProps & {\n\t\tsize?: number;\n\t\tstrokeLinecap?: 'round' | 'butt' | 'square' | 'inherit' | undefined;\n\t\tfill?: Color;\n\t\tstroke?: Color;\n\t\tstrokeWidth?: InGameDistance;\n\t\tinnerStrokeWidth?: InGameDistance;\n\t\tinnerStroke?: Color;\n\t}\n> = ({\n\tsize = 1,\n\tfill = color.terrain,\n\tstrokeLinecap = 'round',\n\tstroke = fill.darken(0.3).saturate(0.3),\n\tstrokeWidth = 1,\n\tinnerStroke = fill.lighten(0.4).desaturate(0.8),\n\tinnerStrokeWidth = strokeWidth,\n\t...gProps\n}) => {\n\tconst innerStrokeCss = innerStroke && innerStroke.string();\n\tconst strokeCss = stroke && stroke.string();\n\n\tconst style: Record<string, string> = {};\n\tif (gProps.onClick || gProps.onContextMenu) {\n\t\tstyle.cursor = 'pointer';\n\t}\n\n\treturn (\n\t\t<g {...gProps} style={style}>\n\t\t\t{fill && (\n\t\t\t\t<>\n\t\t\t\t\t<polygon\n\t\t\t\t\t\tkey={'xz'}\n\t\t\t\t\t\tpoints={XZ_NODES.map(c => c.map(cc => cc * size).join(',')).join(' ')}\n\t\t\t\t\t\tfill={fill.string()}\n\t\t\t\t\t\tstrokeWidth={0}\n\t\t\t\t\t/>\n\t\t\t\t\t<polygon\n\t\t\t\t\t\tkey={'xy'}\n\t\t\t\t\t\tpoints={XY_NODES.map(c => c.map(cc => cc * size).join(',')).join(' ')}\n\t\t\t\t\t\tfill={fill.lighten(0.2).string()}\n\t\t\t\t\t\tstrokeWidth={0}\n\t\t\t\t\t/>\n\t\t\t\t\t<polygon\n\t\t\t\t\t\tkey={'yz'}\n\t\t\t\t\t\tpoints={YZ_NODES.map(c => c.map(cc => cc * size).join(',')).join(' ')}\n\t\t\t\t\t\tfill={fill.darken(0.2).string()}\n\t\t\t\t\t\tstrokeWidth={0}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{innerStroke && (\n\t\t\t\t<>\n\t\t\t\t\t<line\n\t\t\t\t\t\tkey={'x-bar'}\n\t\t\t\t\t\tx1={COORDINATE_CLOSEST_TO_CAMERA[0] * size}\n\t\t\t\t\t\ty1={COORDINATE_CLOSEST_TO_CAMERA[1] * size}\n\t\t\t\t\t\tx2={BORDER_NODES[3][0] * size}\n\t\t\t\t\t\ty2={BORDER_NODES[3][1] * size}\n\t\t\t\t\t\tstroke={innerStrokeCss}\n\t\t\t\t\t\tstrokeWidth={innerStrokeWidth}\n\t\t\t\t\t\tstrokeLinecap={strokeLinecap}\n\t\t\t\t\t/>\n\t\t\t\t\t<line\n\t\t\t\t\t\tkey={'y-bar'}\n\t\t\t\t\t\tx1={COORDINATE_CLOSEST_TO_CAMERA[0] * size}\n\t\t\t\t\t\ty1={COORDINATE_CLOSEST_TO_CAMERA[1] * size}\n\t\t\t\t\t\tx2={BORDER_NODES[1][0] * size}\n\t\t\t\t\t\ty2={BORDER_NODES[1][1] * size}\n\t\t\t\t\t\tstroke={innerStrokeCss}\n\t\t\t\t\t\tstrokeWidth={innerStrokeWidth}\n\t\t\t\t\t\tstrokeLinecap={strokeLinecap}\n\t\t\t\t\t/>\n\t\t\t\t\t<line\n\t\t\t\t\t\tkey={'z-bar'}\n\t\t\t\t\t\tx1={COORDINATE_CLOSEST_TO_CAMERA[0] * size}\n\t\t\t\t\t\ty1={COORDINATE_CLOSEST_TO_CAMERA[1] * size}\n\t\t\t\t\t\tx2={BORDER_NODES[5][0] * size}\n\t\t\t\t\t\ty2={BORDER_NODES[5][1] * size}\n\t\t\t\t\t\tstroke={innerStrokeCss}\n\t\t\t\t\t\tstrokeWidth={innerStrokeWidth}\n\t\t\t\t\t\tstrokeLinecap={strokeLinecap}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\n\t\t\t<polygon\n\t\t\t\tkey={'outline'}\n\t\t\t\tpoints={BORDER_NODES.map(c => c.map(cc => cc * size).join(',')).join(' ')}\n\t\t\t\tstroke={strokeCss}\n\t\t\t\tfill={'transparent'}\n\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\tstrokeLinecap={strokeLinecap}\n\t\t\t/>\n\t\t</g>\n\t);\n};\n","import styled from '@emotion/styled';\nimport React, { FunctionComponent, ReactElement, useMemo } from 'react';\nimport { CoordinateLike } from '../classes/Coordinate';\nimport { InGameDistance, PERSPECTIVE } from './PERSPECTIVE';\n\n// The pythagoras distance (1/sqrt(2)) with a little tweaking for better looks\nconst PIXEL_FRIENDLY_PYTHAGORAS = 1 / Math.pow(2, 1 / 2); //0.8;\n\nfunction mathRoundMaybe(n: number) {\n\t// For debugging only. Adjust to taste.\n\n\treturn Math.round(n);\n\t// return n;\n}\n\n// Force the type to AnimatedComponent to avoid a weird TS inference bug\n//\nexport const AbsolutelyPositionedContainer = styled.div`\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\twidth: 0;\n\theight: 0;\n\ttransition: transform 5s;\n\t> * {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t}\n`;\n\ntype ViewportComponentProps = {\n\tzoom?: number;\n\tcenter?: CoordinateLike;\n\toverlay?: ReactElement;\n};\n\nexport const Viewport: FunctionComponent<ViewportComponentProps> = ({\n\toverlay,\n\tcenter = { x: 0, y: 0, z: 0 },\n\tzoom = 1,\n\tchildren\n}) => {\n\tconst [translateX, translateY] = useMemo(\n\t\t() =>\n\t\t\tPERSPECTIVE.toPixels(center.x, center.y, center.z).map(\n\t\t\t\t(n, i) => mathRoundMaybe(-n) + (i ? 0 : 0.5)\n\t\t\t),\n\t\t[center]\n\t);\n\n\tconst springStyles =\n\t\t//useSpring({\n\t\t// \tconfig: config.molasses,\n\t\t// \tto:\n\t\t{\n\t\t\ttransform: `translate(\n\t\t\t\t${translateX * zoom}px,\n\t\t\t\t${translateY * zoom}px\n\t\t\t)`\n\t\t};\n\t// });\n\n\treturn (\n\t\t<AbsolutelyPositionedContainer style={springStyles}>\n\t\t\t<ViewportSvgContainer zoom={zoom} children={children} />\n\t\t\t{overlay}\n\t\t</AbsolutelyPositionedContainer>\n\t);\n};\n\nexport const ViewportSvgContainer: FunctionComponent<\n\t{\n\t\tzoom?: number;\n\t} & React.SVGProps<SVGSVGElement>\n> = ({ zoom = 1, ...rest }) => (\n\t<svg\n\t\twidth=\"1px\"\n\t\theight=\"1px\"\n\t\toverflow=\"visible\"\n\t\tshapeRendering=\"geometricPrecision\"\n\t\tviewBox={[0, 0, 1 / zoom, 1 / zoom].join(' ')}\n\t\t{...rest}\n\t/>\n);\n\nconst NoAxis = styled.div<{ zoom?: number }>`\n\t--scale-val: ${({ zoom = 1 }) => zoom};\n\n\tposition: absolute;\n\ttransform-origin: top left;\n\ttransform: scale(var(--scale-val));\n`;\n\nconst YAxis = styled(NoAxis)`\n\ttransform: skewY(-${PERSPECTIVE.degrees}deg)\n\t\tscale(calc(${PIXEL_FRIENDLY_PYTHAGORAS} * var(--scale-val)), var(--scale-val));\n`;\n\nconst ZAxis = styled(NoAxis)`\n\ttransform: rotate(-${PERSPECTIVE.degrees}deg) skewX(${PERSPECTIVE.degrees}deg)\n\t\tscale(\n\t\t\tcalc(${Math.sqrt(PIXEL_FRIENDLY_PYTHAGORAS)} * var(--scale-val)),\n\t\t\tcalc(${PIXEL_FRIENDLY_PYTHAGORAS} * var(--scale-val))\n\t\t);\n`;\n\nconst XAxis = styled(NoAxis)`\n\ttransform: skewY(${PERSPECTIVE.degrees}deg)\n\t\tscale(calc(${PIXEL_FRIENDLY_PYTHAGORAS} * var(--scale-val)), var(--scale-val));\n`;\n\nexport const ViewportHtmlContainer: FunctionComponent<{\n\taxis?: 'x' | 'y' | 'z';\n\twidth: InGameDistance;\n\theight: InGameDistance;\n\tzoom?: number;\n\tlocation: CoordinateLike;\n}> = ({ location, zoom = 1, axis, width, height, children }) => {\n\tconst { x, y, z } = location,\n\t\t// @TODO use css variable to zoom instead of JS\n\t\t[left, top] = PERSPECTIVE.toPixels(x, y, z).map(n => mathRoundMaybe(n * zoom));\n\t// @TODO use css variable to zoom instead of JS\n\tconst [pixelWidth] = PERSPECTIVE.toPixels(0, width, height).map(n => mathRoundMaybe(n * zoom));\n\tconst Axis = axis === 'y' ? YAxis : axis === 'x' ? XAxis : axis === 'z' ? ZAxis : NoAxis;\n\treturn (\n\t\t<Axis\n\t\t\tzoom={zoom}\n\t\t\tstyle={{\n\t\t\t\tleft: mathRoundMaybe(left),\n\t\t\t\ttop: mathRoundMaybe(top),\n\t\t\t\twidth:\n\t\t\t\t\tmathRoundMaybe(axis ? pixelWidth / PIXEL_FRIENDLY_PYTHAGORAS : pixelWidth) +\n\t\t\t\t\t'px',\n\t\t\t\theight:\n\t\t\t\t\tMath.abs(\n\t\t\t\t\t\t(height * PERSPECTIVE.tileSize) /\n\t\t\t\t\t\t\t(axis === 'z' ? PIXEL_FRIENDLY_PYTHAGORAS : 1)\n\t\t\t\t\t) + 'px'\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</Axis>\n\t);\n};\n","import styled from '@emotion/styled';\n\nexport const Backdrop = styled.div<{ height?: number }>`\n\tposition: relative;\n\theight: ${({ height = 180 }) => `${height}px`};\n\tbackground-image: linear-gradient(\n\t\t45deg,\n\t\trgba(255, 255, 255, 0.02) 25%,\n\t\trgba(0, 0, 0, 0.02) 25%,\n\t\trgba(0, 0, 0, 0.02) 50%,\n\t\trgba(255, 255, 255, 0.02) 50%,\n\t\trgba(255, 255, 255, 0.02) 75%,\n\t\trgba(0, 0, 0, 0.02) 75%,\n\t\trgba(0, 0, 0, 0.02) 100%\n\t);\n\tbackground-size: 56.57px 56.57px;\n\tmargin-bottom: 1em;\n`;\n","import Color from 'color';\nimport { FunctionComponent } from 'react';\nimport { Anchor } from '../space/Anchor';\nimport { MonochromeBox } from '../space/MonochromeBox';\nimport { Viewport } from '../space/Viewport';\nimport { Backdrop } from './scaffolding';\n\nconst Demo: FunctionComponent = () => (\n\t<>\n\t\t<Backdrop>\n\t\t\t<Viewport zoom={1} center={{ x: 0.5, y: 0.5, z: 0.5 }}>\n\t\t\t\t<Anchor x={-2} y={-2} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={0} y={0} z={0}>\n\t\t\t\t\t<MonochromeBox innerStroke={Color('#630a0a7d')} fill={Color('#960202')} />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={2} y={2} z={0}>\n\t\t\t\t\t<MonochromeBox\n\t\t\t\t\t\tfill={Color('#ffffff7f')}\n\t\t\t\t\t\tonClick={() => window.alert('Clicky click!')}\n\t\t\t\t\t/>\n\t\t\t\t</Anchor>\n\t\t\t</Viewport>\n\t\t</Backdrop>\n\t\t<Backdrop>\n\t\t\t<Viewport center={{ x: 1, y: 0, z: 0.5 }}>\n\t\t\t\t<Anchor x={0} y={0} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={1} y={0} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={2} y={0} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={2} y={-1} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t</Viewport>\n\t\t</Backdrop>\n\t</>\n);\n\nexport default Demo;\n","import { DependencyList, useCallback, useEffect } from 'react';\n\ntype EventHandler<EventData extends Array<unknown>> = (...args: EventData) => void;\ntype EventDestroyer = () => void;\n\n/**\n *  Consitutes one named event type\n */\nexport class Event<EventData extends Array<unknown> = []> {\n\tprivate listeners: EventHandler<EventData>[] = [];\n\n\ton(callback: EventHandler<EventData>) {\n\t\tthis.listeners.push(callback);\n\n\t\treturn () => {\n\t\t\tthis.listeners.splice(this.listeners.indexOf(callback));\n\t\t};\n\t}\n\n\temit(...args: EventData) {\n\t\tthis.listeners.forEach(callback => callback(...args));\n\t}\n\n\tclear() {\n\t\tthis.listeners = [];\n\t}\n}\n\n/**\n * A conventience wrapper for `useEffect` specifically for listening to a list of events, and unlistening when the\n * component is unmounted.\n *\n * For example:\n *\n *   useEventListeners(() => [\n *       entity.moveStart.on(coordinate => animatePosition(coordinate)),\n *       entity.moveRest.on(coordinate => console.log('Done'))\n *   ], [entity.moveStart, entity.moveRest]);\n */\nexport const useEventListeners = (callback: () => EventDestroyer[], deps: DependencyList = []) => {\n\tconst cb = useCallback(\n\t\t() => {\n\t\t\tconst eventDestroyers = callback();\n\t\t\treturn () => eventDestroyers.forEach(d => d());\n\t\t},\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\tdeps\n\t);\n\treturn useEffect(cb, [cb]);\n};\n","import styled from '@emotion/styled';\nimport React, { FunctionComponent, ReactElement, useEffect, useState } from 'react';\nimport { CoordinateLike } from '../classes/Coordinate';\nimport { useGame } from '../Game';\nimport { ViewportHtmlContainer } from '../space/Viewport';\nimport { Event } from '../util/Event';\n\n/**\n * Presentational components\n */\nconst borderColor = `rgba(0,0, 0, 0.5)`;\nconst ContextMenuArrow = styled.div`\n\twidth: 0;\n\theight: 0;\n\tborder-left: 6px solid transparent;\n\tborder-right: 6px solid transparent;\n\tborder-top: 6px solid ${borderColor};\n\ttransform: translate(calc(-50% + 0px), -6px);\n`;\n\nconst ContextMenuBoundary = styled.div`\n\tposition: absolute;\n\tbottom: 100%;\n\tleft: 50%;\n\tbackdrop-filter: blur(2px);\n\ttransform: translate(-50%, -6px);\n`;\n\nconst ContextMenuBody = styled.div`\n\tborder: 1px solid ${borderColor};\n\tbackground-color: rgba(0, 0, 0, 0.4);\n\tborder-radius: 3px;\n\toverflow: hidden;\n`;\n\nexport const ContextMenuButton = styled.button`\n\tborder: none;\n\tdisplay: block;\n\twidth: 100%;\n\tbox-sizing: border-box;\n\n\t// Same as HorizontalLinkListItem\n\tpadding: 0.5em 1em;\n\twhite-space: nowrap;\n\ttransition: background-color 0.5s;\n\tcolor: white;\n\tbackground-color: transparent;\n\t&:hover {\n\t\tbackground-color: ${borderColor};\n\t\tcursor: pointer;\n\t}\n`;\n\nexport const ContextMenuFooter = styled.button`\n\tborder: none;\n\tdisplay: block;\n\twidth: 100%;\n\tbox-sizing: border-box;\n\n\t// Same as HorizontalLinkListItem\n\tpadding: 0.5em 1em;\n\twhite-space: nowrap;\n\ttransition: background-color 0.5s;\n\tcolor: white;\n\tbackground-color: ${borderColor};\n`;\n\n/**\n * Logic\n */\ntype ContextManagerState = false | { location: CoordinateLike; contents: ReactElement };\nexport class ContextMenuManager {\n\tpublic state: ContextManagerState = false;\n\tpublic $changed = new Event<[ContextManagerState]>();\n\n\topen(location: CoordinateLike, contents: ReactElement) {\n\t\tthis.state = { location, contents };\n\t\tthis.$changed.emit(this.state);\n\t}\n\n\tisOpen() {\n\t\treturn !!this.state;\n\t}\n\n\tclose() {\n\t\tthis.state = false;\n\t\tthis.$changed.emit(this.state);\n\t}\n}\n\nexport const ContextMenuContainer: FunctionComponent<{ zoom?: number }> = ({ zoom = 1 }) => {\n\tconst { contextMenu } = useGame();\n\tconst [managerState, setManagerState] = useState(contextMenu?.state);\n\tuseEffect(() => {\n\t\tif (!contextMenu) {\n\t\t\tthrow new Error('Shit.');\n\t\t}\n\t\treturn contextMenu.$changed.on(setManagerState);\n\t}, [contextMenu]);\n\n\tif (!managerState) {\n\t\treturn null;\n\t}\n\treturn (\n\t\t<ViewportHtmlContainer location={managerState.location} width={0} height={0} zoom={zoom}>\n\t\t\t<ContextMenuBoundary>\n\t\t\t\t<ContextMenuBody>{managerState.contents}</ContextMenuBody>\n\t\t\t</ContextMenuBoundary>\n\t\t\t<ContextMenuArrow />\n\t\t</ViewportHtmlContainer>\n\t);\n};\n","import { createContext, useContext } from 'react';\nimport { Scene } from './classes/Scene';\nimport { ContextMenuManager } from './ui/ContextMenu';\n\nexport class Game {\n\tpublic readonly contextMenu = new ContextMenuManager();\n\tpublic readonly scene: Scene;\n\n\tconstructor(scene: Scene) {\n\t\tthis.scene = scene;\n\t}\n}\n\nexport const GameContext = createContext<null | Game>(null);\n\nexport const useGame = () => {\n\tconst gameApi = useContext(GameContext);\n\tif (!gameApi) {\n\t\tthrow new Error('Game context does not exist');\n\t}\n\treturn gameApi;\n};\n","type BinaryHeapScorer<P> = (node: P) => number;\n\nexport class BinaryHeap<P> {\n\tscoreFunction: BinaryHeapScorer<P>;\n\tcontent: P[] = [];\n\tconstructor(scoreFunction: BinaryHeapScorer<P>) {\n\t\tthis.content = [];\n\t\tthis.scoreFunction = scoreFunction;\n\t}\n\tpush(element: P) {\n\t\t// Add the new element to the end of the array.\n\t\tthis.content.push(element);\n\n\t\t// Allow it to sink down.\n\t\tthis.sinkDown(this.content.length - 1);\n\t}\n\tpop() {\n\t\t// Store the first element so we can return it later.\n\t\tconst result = this.content[0];\n\n\t\t// Get the element at the end of the array.\n\t\tconst end = this.content.pop();\n\t\tif (!end) {\n\t\t\treturn result;\n\t\t}\n\n\t\t// If there are any elements left, put the end element at the\n\t\t// start, and let it bubble up.\n\t\tif (this.content.length > 0) {\n\t\t\tthis.content[0] = end;\n\t\t\tthis.bubbleUp(0);\n\t\t}\n\t\treturn result;\n\t}\n\tremove(node: P) {\n\t\tconst i = this.content.indexOf(node);\n\n\t\t// When it is found, the process seen in 'pop' is repeated\n\t\t// to fill up the hole.\n\t\tconst end = this.content.pop();\n\t\tif (!end) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (i !== this.content.length - 1) {\n\t\t\tthis.content[i] = end;\n\n\t\t\tif (this.scoreFunction(end) < this.scoreFunction(node)) {\n\t\t\t\tthis.sinkDown(i);\n\t\t\t} else {\n\t\t\t\tthis.bubbleUp(i);\n\t\t\t}\n\t\t}\n\t}\n\tsize() {\n\t\treturn this.content.length;\n\t}\n\trescoreElement(node: P) {\n\t\tthis.sinkDown(this.content.indexOf(node));\n\t}\n\tsinkDown(n: number) {\n\t\t// Fetch the element that has to be sunk.\n\t\tconst element = this.content[n];\n\n\t\t// When at 0, an element can not sink any further.\n\t\twhile (n > 0) {\n\t\t\t// Compute the parent element's index, and fetch it.\n\t\t\tconst parentN = ((n + 1) >> 1) - 1;\n\t\t\tconst parent = this.content[parentN];\n\t\t\t// Swap the elements if the parent is greater.\n\t\t\tif (this.scoreFunction(element) < this.scoreFunction(parent)) {\n\t\t\t\tthis.content[parentN] = element;\n\t\t\t\tthis.content[n] = parent;\n\t\t\t\t// Update 'n' to continue at the new position.\n\t\t\t\tn = parentN;\n\t\t\t}\n\t\t\t// Found a parent that is less, no need to sink any further.\n\t\t\telse {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tbubbleUp(n: number) {\n\t\t// Look up the target element and its score.\n\t\tconst length = this.content.length;\n\t\tconst element = this.content[n];\n\t\tconst elemScore = this.scoreFunction(element);\n\n\t\twhile (true) {\n\t\t\t// Compute the indices of the child elements.\n\t\t\tconst child2N = (n + 1) << 1;\n\t\t\tconst child1N = child2N - 1;\n\t\t\t// This is used to store the new position of the element, if any.\n\t\t\tlet swap = null;\n\t\t\tlet child1Score;\n\t\t\t// If the first child exists (is inside the array)...\n\t\t\tif (child1N < length) {\n\t\t\t\t// Look it up and compute its score.\n\t\t\t\tconst child1 = this.content[child1N];\n\t\t\t\tchild1Score = this.scoreFunction(child1);\n\n\t\t\t\t// If the score is less than our element's, we need to swap.\n\t\t\t\tif (child1Score < elemScore) {\n\t\t\t\t\tswap = child1N;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Do the same checks for the other child.\n\t\t\tif (child2N < length) {\n\t\t\t\tconst child2 = this.content[child2N];\n\t\t\t\tconst child2Score = this.scoreFunction(child2);\n\t\t\t\t// child1Score is number or undefined. To satisfy TS (for the original code) it is coerced to number,\n\t\t\t\t// but I'm not sure why it wouldn't stay undefined, really.\n\t\t\t\tif (child2Score < (swap === null ? elemScore : (child1Score as number))) {\n\t\t\t\t\tswap = child2N;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If the element needs to be moved, swap it, and continue.\n\t\t\tif (swap !== null) {\n\t\t\t\tthis.content[n] = this.content[swap];\n\t\t\t\tthis.content[swap] = element;\n\t\t\t\tn = swap;\n\t\t\t}\n\t\t\t// Otherwise, we are done.\n\t\t\telse {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n}\n","// An adaptation of:\n//   javascript-astar 0.4.1\n//   http://github.com/bgrins/javascript-astar\n//   Freely distributable under the MIT License.\n//   Implements the astar search algorithm in javascript using a Binary Heap.\n//   Includes Binary Heap (with modifications) from Marijn Haverbeke.\n//   http://eloquentjavascript.net/appendix2.html\n\nimport { BinaryHeap } from '../util/BinaryHeap';\nimport { GenericTerrain, GenericTile } from '../terrain/GenericTerrain';\n\n// See list of heuristics: http://theory.stanford.edu/~amitp/GameProgramming/Heuristics.html\ntype HeuristicScorer = (a: GenericTile, b: GenericTile) => number;\n\n/**\n * Perform an A* Search on a graph given a start and end node.\n */\n\ntype HeuristicReport = {\n\tcoordinate: GenericTile;\n\th: number;\n\tg: number;\n\tf: number;\n\tparent: HeuristicReport | null;\n\tclosed: Boolean;\n\tvisited: boolean;\n};\n\ntype PathOptions = {\n\tclosest: Boolean;\n\theuristic?: HeuristicScorer;\n};\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst MANHATTAN: HeuristicScorer = (pos0, pos1) => {\n\tconst d1 = Math.abs(pos1.x - pos0.x);\n\tconst d2 = Math.abs(pos1.y - pos0.y);\n\treturn d1 + d2;\n};\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst DIAGONAL: HeuristicScorer = (pos0, pos1) => {\n\tconst D = 1;\n\tconst D2 = Math.sqrt(2);\n\tconst d1 = Math.abs(pos1.x - pos0.x);\n\tconst d2 = Math.abs(pos1.y - pos0.y);\n\treturn D * (d1 + d2) + (D2 - 2 * D) * Math.min(d1, d2);\n};\n\nfunction getVisitationCost(\n\tterrain: GenericTerrain<GenericTile>,\n\tfrom: GenericTile,\n\tneighbor: GenericTile\n) {\n\treturn 1;\n}\n\nexport class Path {\n\tprivate readonly terrain: GenericTerrain<GenericTile>;\n\tprivate readonly options: PathOptions;\n\tprivate readonly cache: Map<GenericTile, HeuristicReport>;\n\tprivate readonly heap: BinaryHeap<GenericTile>;\n\tprivate readonly heuristic: HeuristicScorer;\n\n\tconstructor(graph: GenericTerrain<GenericTile>, options: PathOptions) {\n\t\tthis.terrain = graph;\n\t\tthis.options = options;\n\n\t\tthis.cache = new Map<GenericTile, HeuristicReport>();\n\n\t\tthis.heap = new BinaryHeap<GenericTile>(node => {\n\t\t\tconst heuristic = this.cache.get(node);\n\t\t\tif (!heuristic) {\n\t\t\t\tthrow new Error('This is weird');\n\t\t\t}\n\t\t\treturn heuristic.f;\n\t\t});\n\n\t\tthis.heuristic = DIAGONAL;\n\t}\n\n\tfind(start: GenericTile, end: GenericTile) {\n\t\tlet closestNode = start; // set the start node to be the closest if required\n\t\tlet closestNodeHeuristics: HeuristicReport = {\n\t\t\tcoordinate: closestNode,\n\t\t\th: this.heuristic(start, end),\n\t\t\tg: 0,\n\t\t\tf: 0,\n\n\t\t\tparent: null,\n\n\t\t\t// Unsure what the default value should be\n\t\t\tclosed: true,\n\t\t\tvisited: true\n\t\t};\n\n\t\t// At this stage `start` is also `closestNode`, so lets associate those heuristics\n\t\tthis.cache.set(start, closestNodeHeuristics);\n\n\t\tthis.heap.push(start);\n\n\t\twhile (this.heap.size() > 0) {\n\t\t\t// Grab the lowest f(x) to process next.  Heap keeps this sorted for us.\n\t\t\tconst currentNode = this.heap.pop();\n\t\t\tconst currentNodeHeuristics = this.cache.get(currentNode);\n\t\t\tif (!currentNodeHeuristics) {\n\t\t\t\tthrow new Error('Somehow opening a node that has no heuristic data');\n\t\t\t}\n\n\t\t\t// End case -- result has been found, return the traced path.\n\t\t\tif (currentNode.equals(end)) {\n\t\t\t\treturn this.tracePath(currentNodeHeuristics);\n\t\t\t}\n\n\t\t\t// Normal case -- move currentNode from open to closed, process each of its neighbors.\n\t\t\tcurrentNodeHeuristics.closed = true;\n\n\t\t\t// Find all neighbors for the current node.\n\t\t\tconst neighbors = this.terrain.getNeighborTiles(currentNode);\n\n\t\t\tfor (let i = 0, il = neighbors.length; i < il; ++i) {\n\t\t\t\tconst neighbor = neighbors[i];\n\t\t\t\tlet neighborHeuristics = this.cache.get(neighbor);\n\n\t\t\t\tif (neighborHeuristics?.closed || !neighbor.isLand()) {\n\t\t\t\t\t// Not a valid node to process, skip to next neighbor.\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// The g score is the shortest distance from start to current node.\n\t\t\t\t// We need to check if the path we have arrived at this neighbor is the shortest one we have seen yet.\n\t\t\t\tconst gScore =\n\t\t\t\t\tcurrentNodeHeuristics.g +\n\t\t\t\t\tgetVisitationCost(this.terrain, currentNode, neighbor);\n\t\t\t\tconst beenVisited = !!neighborHeuristics;\n\n\t\t\t\tif (!beenVisited || (neighborHeuristics && gScore < neighborHeuristics.g)) {\n\t\t\t\t\tconst hScore = this.heuristic(neighbor, end);\n\t\t\t\t\t// Found an optimal (so far) path to this node.  Take score for node to see how good it is.\n\t\t\t\t\tneighborHeuristics = {\n\t\t\t\t\t\tcoordinate: neighbor,\n\t\t\t\t\t\th: hScore,\n\t\t\t\t\t\tg: gScore,\n\t\t\t\t\t\tf: gScore + hScore,\n\t\t\t\t\t\tparent: currentNodeHeuristics,\n\t\t\t\t\t\tclosed: true,\n\t\t\t\t\t\tvisited: true\n\t\t\t\t\t};\n\t\t\t\t\tthis.cache.set(neighbor, neighborHeuristics as HeuristicReport);\n\n\t\t\t\t\tif (this.options.closest) {\n\t\t\t\t\t\t// If the neighbour is closer than the current closestNode or if it's equally close but has\n\t\t\t\t\t\t// a cheaper path than the current closest node then it becomes the closest node\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tneighborHeuristics.h < closestNodeHeuristics.h ||\n\t\t\t\t\t\t\t(neighborHeuristics.h === closestNodeHeuristics.h &&\n\t\t\t\t\t\t\t\tneighborHeuristics.g < closestNodeHeuristics.g)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tclosestNode = neighbor;\n\t\t\t\t\t\t\tclosestNodeHeuristics = neighborHeuristics;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!beenVisited) {\n\t\t\t\t\t\t// Pushing to heap will put it in proper place based on the 'f' value.\n\t\t\t\t\t\tthis.heap.push(neighbor);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Already seen the node, but since it has been rescored we need to reorder it in the heap\n\t\t\t\t\t\tthis.heap.rescoreElement(neighbor);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.options.closest) {\n\t\t\treturn this.tracePath(closestNodeHeuristics);\n\t\t}\n\n\t\t// No result was found - empty array signifies failure to find path.\n\t\tconsole.warn('-- No path --');\n\t\treturn [];\n\t}\n\n\ttracePath(heuristicReport: HeuristicReport) {\n\t\tlet curr = heuristicReport;\n\t\tconst path = [];\n\t\twhile (curr.parent) {\n\t\t\tpath.unshift(curr);\n\t\t\tcurr = curr.parent;\n\t\t}\n\t\treturn path.map(heuristicReport => heuristicReport.coordinate);\n\t}\n}\n","const FIRST_NAMES_M = `\n\tPaul, Paolo, Pablo, Pavel, Pasha, Pau, Paulo, Pol, Pavlo, Paavo, Pali, Pal, Paulin, Pava, Påvel, Paulino, Pawel,\n\tPaavali, Pauel, Pavlos, Pavlusha, Poul, Pusha, Pashenka, Pavlík, Poll, Pól, Pavlousek, Pawelek, Pål, Pavilcek, Pál\n`\n\t.replace(/\\t|\\n/g, '')\n\t.split(',')\n\t.map(name => name.trim());\n\nconst FIRST_NAMES_F = `\n\tMia, Mare, Miriam, Mary, Mara, Molly, Maren, Mariah, Marisol, Maria, Moira, Polly, Marie, Mariana, Marilyn, Malia,\n\tMari, Manon, Marissa, Mariam, Marion, Ria, Mariella, Milou, Mitzi, Marielle, Maribel, Maura, Mamie, Maureen, Mariel,\n\tMarisa, Maryam, Mairi, Malou, Marietta, Maija, Maire, Maritza, Maricela, Marya, Marika, Isamar, My, Mariska, Maryse,\n\tMariela, Maira, Marita, Mariette,\n`\n\t.replace(/\\t|\\n/g, '')\n\t.split(',')\n\t.map(name => name.trim());\n\nexport function getRandomMaleFirstName() {\n\treturn FIRST_NAMES_M[Math.floor(Math.random() * FIRST_NAMES_M.length)];\n}\nexport function getRandomFemaleFirstName() {\n\treturn FIRST_NAMES_F[Math.floor(Math.random() * FIRST_NAMES_F.length)];\n}\n\nexport function getRandomFullName() {}\n","import { FunctionComponent } from 'react';\nimport { GenericTile } from '../terrain/GenericTerrain';\nimport { Job } from '../jobs/Job';\nconst noop = () => {};\n\nexport class Entity {\n\tpublic readonly id: string;\n\n\t/**\n\t * The React SVG component that consitutes this entity. Is expected to be defined in a class\n\t * that extends `Entity`.\n\t */\n\tpublic readonly Component: FunctionComponent = () => {\n\t\treturn null;\n\t};\n\n\tpublic location: GenericTile;\n\n\t/**\n\t * The set of behaviour/tasks given to this entity.\n\t */\n\tpublic job?: Job;\n\n\tconstructor(id: string, location: GenericTile) {\n\t\tthis.id = id;\n\t\tthis.location = location;\n\t}\n\n\tpublic get label(): string {\n\t\tthrow new Error(`${this.constructor.name} ${this.id}`);\n\t}\n\n\tpublic play() {\n\t\treturn this.job?.start() || noop;\n\t}\n\n\tpublic doJob(job: Job) {\n\t\tthis.job = job;\n\n\t\t// @TODO maybe some events\n\t}\n}\n","import { FunctionComponent, useCallback, useState } from 'react';\nimport { Path } from '../classes/Path';\nimport { GenericTile } from '../terrain/GenericTerrain';\nimport { getRandomFemaleFirstName, getRandomMaleFirstName } from '../constants/names';\nimport { MovingAnchor } from '../space/Anchor';\nimport { Event, useEventListeners } from '../util/Event';\nimport { Entity } from './Entity';\n\ntype OnEntityClick = (event: React.MouseEvent<SVGElement, MouseEvent>) => void;\n\nexport class PersonEntity extends Entity {\n\t// The event that the person starts walking a path\n\tpublic readonly $startedWalking = new Event<[]>();\n\n\t// The event that the person finishes a path, according to react-spring's timing\n\tpublic readonly $stoppedWalking = new Event<[]>();\n\n\t// The person started one step\n\tpublic readonly $startedWalkStep = new Event<[GenericTile]>();\n\n\t// The person started finished one step, according to react-spring's timing\n\tpublic readonly $stoppedWalkStep = new Event<[GenericTile]>();\n\n\tpublic readonly passport: { firstName: string };\n\n\tconstructor(id: string, location: GenericTile) {\n\t\tsuper(id, location);\n\n\t\tconst feminine = Math.random() < 0.5;\n\t\tthis.passport = {\n\t\t\tfirstName: feminine ? getRandomFemaleFirstName() : getRandomMaleFirstName()\n\t\t};\n\n\t\t// Movement handling\n\t\tthis.$stoppedWalkStep.on(loc => {\n\t\t\tthis.location = loc;\n\t\t});\n\t}\n\n\t// Calculate a path and emit animations to walk it the whole way. `this.location` is updated in between each step\n\tpublic walkTo(destination: GenericTile) {\n\t\tif (!this.location.terrain) {\n\t\t\tthrow new Error(`Entity \"${this.id}\" is trying to path in a detached coordinate`);\n\t\t}\n\t\tconst path = new Path(this.location.terrain, { closest: true }).find(\n\t\t\tthis.location,\n\t\t\tdestination\n\t\t);\n\n\t\t// console.log(`${this.location}-->${destination}: ${path.length}`);\n\n\t\tif (!path.length) {\n\t\t\tconsole.warn('Path was zero steps long, finishing early.', this);\n\t\t\tthis.$stoppedWalking.emit();\n\t\t\treturn;\n\t\t}\n\t\tconst unlisten = this.$stoppedWalkStep.on(() => {\n\t\t\tconst nextStep = path.shift();\n\n\t\t\tif (!nextStep) {\n\t\t\t\tthis.$stoppedWalking.emit();\n\t\t\t\tunlisten();\n\t\t\t} else {\n\t\t\t\tthis.doPathStep(nextStep);\n\t\t\t}\n\t\t});\n\n\t\tthis.doPathStep(path.shift() as GenericTile);\n\t}\n\t/**\n\t * Move entity directly to a coordinate. Does not consider accessibility or closeness.\n\t */\n\tpublic doPathStep(coordinate: GenericTile) {\n\t\tif (coordinate.hasNaN()) {\n\t\t\tdebugger;\n\t\t}\n\t\tthis.$startedWalkStep.emit(coordinate);\n\t}\n\n\tpublic get label(): string {\n\t\treturn this.passport.firstName;\n\t}\n\n\tComponent: FunctionComponent = () => {\n\t\treturn <circle cx={0} cy={0} r=\"5\" fill=\"white\" stroke=\"black\" />;\n\t};\n}\n\n/**\n * A component that automatically transitions the entity component as per its move instructions\n */\nexport const PersonEntityComponent: FunctionComponent<{\n\tentity: PersonEntity;\n\tonClick?: OnEntityClick;\n}> = ({ entity, onClick }) => {\n\tconst [{ destination, duration }, animatePosition] = useState({\n\t\tdestination: entity.location,\n\t\tduration: 0\n\t});\n\n\tuseEventListeners(\n\t\t() => [\n\t\t\t// Listen for the entity moveStart order;\n\t\t\tentity.$startedWalkStep.on(destination =>\n\t\t\t\tanimatePosition({\n\t\t\t\t\tdestination: destination,\n\t\t\t\t\tduration: entity.location.euclideanDistanceTo(destination) * 500\n\t\t\t\t})\n\t\t\t)\n\t\t],\n\t\t[entity.$startedWalkStep]\n\t);\n\n\tconst onRest = useCallback(\n\t\t() => entity.$stoppedWalkStep.emit(destination),\n\t\t[entity.$stoppedWalkStep, destination]\n\t);\n\n\treturn (\n\t\t<MovingAnchor moveTo={destination} moveSpeed={duration} onRest={onRest} onClick={onClick}>\n\t\t\t<entity.Component />\n\t\t</MovingAnchor>\n\t);\n};\n","import { PersonEntity } from './PersonEntity';\n\nexport class CivilianEntity extends PersonEntity {\n\tget label(): string {\n\t\treturn `${this.passport.firstName}`;\n\t}\n}\n","import { InGameDistance } from '../space/PERSPECTIVE';\nexport interface CoordinateLike {\n\tx: InGameDistance;\n\ty: InGameDistance;\n\tz: InGameDistance;\n}\n\nexport type CoordinateArray = [InGameDistance, InGameDistance, InGameDistance];\n\nexport class Coordinate implements CoordinateLike {\n\tx: InGameDistance;\n\ty: InGameDistance;\n\tz: InGameDistance;\n\n\tconstructor(x: InGameDistance, y: InGameDistance, z: InGameDistance) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t}\n\n\tequals(coord: CoordinateLike) {\n\t\treturn (\n\t\t\tthis === coord ||\n\t\t\t(coord && this.x === coord.x && this.y === coord.y && this.z === coord.z)\n\t\t);\n\t}\n\n\ttransform(dx: InGameDistance = 0, dy: InGameDistance = 0, dz: InGameDistance = 0) {\n\t\tthis.x += dx;\n\t\tthis.y += dy;\n\t\tthis.z += dz;\n\n\t\treturn this;\n\t}\n\n\thasNaN() {\n\t\treturn isNaN(this.x) || isNaN(this.y) || isNaN(this.z);\n\t}\n\n\tmanhattanDistanceTo(coord: CoordinateLike) {\n\t\treturn Math.abs(this.x - coord.x) + Math.abs(this.y - coord.y) + Math.abs(this.z - coord.z);\n\t}\n\n\teuclideanDistanceTo(coord: CoordinateLike) {\n\t\tconst xy = Math.sqrt((this.x - coord.x) ** 2 + (this.y - coord.y) ** 2);\n\t\tconst xyz = Math.sqrt(xy ** 2 + (this.z - coord.z) ** 2);\n\t\treturn xyz;\n\t}\n\n\t// For debugging purposes only, may change without notice or tests\n\ttoString() {\n\t\treturn [this.x, this.y, this.z].join(',');\n\t}\n\n\tstatic clone(coord: CoordinateLike) {\n\t\treturn new Coordinate(coord.x, coord.y, coord.z);\n\t}\n}\n","import Color from 'color';\nimport React, { FunctionComponent } from 'react';\nimport { Coordinate } from '../classes/Coordinate';\nimport { Anchor } from '../space/Anchor';\nimport { MonochromeBox } from '../space/MonochromeBox';\nimport { PersonEntity } from './PersonEntity';\n\nconst zoom = 0.25;\nconst translate = zoom / 2;\nconst offset = new Coordinate(-translate, -translate, -translate / 2);\n\nexport class GuardEntity extends PersonEntity {\n\tpublic get label(): string {\n\t\treturn `Guardsman ${this.passport.firstName}`;\n\t}\n\n\tComponent: FunctionComponent = () => {\n\t\treturn (\n\t\t\t<Anchor {...offset}>\n\t\t\t\t<MonochromeBox\n\t\t\t\t\tsize={zoom}\n\t\t\t\t\tfill={Color('#227d5e')}\n\t\t\t\t\tstroke={Color('#227d5e').mix(Color('#000'), 0.3)}\n\t\t\t\t\tinnerStroke={Color('#227d5e').mix(Color('#fff'), 0.3)}\n\t\t\t\t/>\n\t\t\t</Anchor>\n\t\t);\n\t};\n}\n","import seedrandom from 'seedrandom';\n\ntype Seed = Array<string | number | boolean>;\n\nexport class Random {\n\tstatic float(...seed: Seed): number {\n\t\treturn seedrandom(seed.join('/')).double();\n\t}\n\tstatic arrayItem<P>(arr: P[], ...seed: Seed) {\n\t\tconst index = Math.floor(this.float(...seed) * arr.length);\n\t\treturn arr[index];\n\t}\n}\n","import { Entity } from '../entities/Entity';\n\nexport class Job<E = Entity> {\n\tentity: E;\n\tconstructor(entity: E) {\n\t\tthis.entity = entity;\n\t}\n\n\tget label(): string {\n\t\tthrow new Error(`Not implemented for ${this.constructor.name}`);\n\t}\n\n\tstart() {\n\t\tthrow new Error(`Not implemented for ${this.constructor.name}`);\n\t}\n}\n","import { PersonEntity } from '../entities/PersonEntity';\nimport { Random } from '../util/Random';\nimport { Job } from './Job';\n\nexport class LoiterJob extends Job<PersonEntity> {\n\t// The minimum and maximum amounts of ms before considering to move again, after having walked\n\tprivate walkMinWait = 4000;\n\tprivate walkMaxWait = 15000;\n\n\t// Every time that the entity might make a move, there's a good chance that they'll change their\n\t//   mind and lazy out instead.\n\tprivate walkChanceOnRoll = 0.3;\n\n\t// If the entity chooses to walk, its no more than this amount of times\n\tprivate walkMaxDistance = 3;\n\n\tget label() {\n\t\treturn `Loitering`;\n\t}\n\n\tstart() {\n\t\tlet steps = 0;\n\t\tconst doTimeout = () =>\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (Math.random() > this.walkChanceOnRoll) {\n\t\t\t\t\tdoTimeout();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tsteps++;\n\t\t\t\tconst destinations =\n\t\t\t\t\tthis.entity.location?.terrain?.selectClosestTiles(\n\t\t\t\t\t\tthis.entity.location,\n\t\t\t\t\t\tthis.walkMaxDistance\n\t\t\t\t\t) || [];\n\t\t\t\tthis.entity.walkTo(\n\t\t\t\t\tRandom.arrayItem(destinations, this.entity.id, 'roam-destination', steps)\n\t\t\t\t);\n\t\t\t}, this.walkMinWait + Random.float(this.entity.id, 'roam-delay', steps) * (this.walkMaxWait - this.walkMinWait));\n\n\t\tconst destroyers = [this.entity.$stoppedWalking.on(doTimeout)];\n\n\t\tdoTimeout();\n\n\t\treturn () => destroyers.forEach((d) => d());\n\t}\n}\n","import { GenericTile } from '../terrain/GenericTerrain';\nimport { PersonEntity } from '../entities/PersonEntity';\nimport { Job } from './Job';\n\nexport class PatrolJob extends Job<PersonEntity> {\n\twaypoints: GenericTile[];\n\twaypointIndex: number;\n\n\tconstructor(entity: PersonEntity, waypoints: GenericTile[]) {\n\t\tsuper(entity);\n\t\tif (waypoints.length < 2) {\n\t\t\tthrow new Error('A patrol must have at least 2 waypoints');\n\t\t}\n\t\tthis.waypoints = waypoints;\n\t\tthis.waypointIndex = 0;\n\t}\n\n\tget label() {\n\t\treturn `Patrolling between ${this.waypoints.length} waypoints`;\n\t}\n\n\tstart() {\n\t\tconst destroyers = [\n\t\t\tthis.entity.$stoppedWalking.on(() => {\n\t\t\t\t// Guards move from one waypoint to another, pausing for a random amount of time in between\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.waypointIndex += 1;\n\t\t\t\t\tconst next = this.waypoints[this.waypointIndex % this.waypoints.length];\n\t\t\t\t\tthis.entity.walkTo(next);\n\t\t\t\t}, 3000);\n\t\t\t})\n\t\t];\n\n\t\tthis.entity.walkTo(this.waypoints[0]);\n\n\t\treturn () => {\n\t\t\tdestroyers.forEach(d => d());\n\t\t};\n\t}\n}\n","import { CivilianEntity } from '../entities/CivilianEntity';\nimport { GuardEntity } from '../entities/GuardEntity';\nimport { PersonEntity } from '../entities/PersonEntity';\nimport { LoiterJob } from '../jobs/LoiterJob';\nimport { PatrolJob } from '../jobs/PatrolJob';\nimport { GenericTerrain, GenericTile } from '../terrain/GenericTerrain';\nimport { Random } from '../util/Random';\n\nfunction repeat<P>(n: number, cb: (i: number) => P): P[] {\n\treturn Array.from(new Array(n)).map((_, i) => cb(i));\n}\n\nexport const RATIO_WATER_OF_TOTAL = 0.25;\n\nexport function generateTerrain(seed: string, size: number) {}\n\nfunction generatePatrolJob(seed: string, entity: PersonEntity) {\n\tconst start = entity.location;\n\tconst island = start.terrain?.getIslands().find(island => island.includes(start));\n\tif (!island) {\n\t\t// Expect to never throw this:\n\t\tthrow new Error('Got falsy start from none of the islands');\n\t}\n\n\treturn new PatrolJob(entity, [\n\t\t...repeat(2 + Math.floor(Random.float(entity.id, 'job', 'waypoint_amount') * 4), i =>\n\t\t\tRandom.arrayItem(island, entity.id, 'job', 'waypoint', i)\n\t\t),\n\t\tstart\n\t]);\n}\n\nexport function generateEntities<T extends GenericTerrain<GenericTile>>(seed: string, terrain: T) {\n\tconst walkableTiles = terrain.tiles.filter(c => c.isLand());\n\tif (!walkableTiles.length) {\n\t\tthrow new Error('The terrain does not contain any walkable tiles!');\n\t}\n\tconst amountOfGuards = 5;\n\tconst amountOfCivilians = 10;\n\treturn [\n\t\t...repeat(amountOfGuards, i => {\n\t\t\tconst id = seed + '-guard-' + i;\n\t\t\tconst start = Random.arrayItem(walkableTiles, id, 'start');\n\t\t\tconst guard = new GuardEntity(id, start);\n\t\t\tconst job = generatePatrolJob(seed, guard);\n\t\t\tguard.doJob(job);\n\t\t\treturn guard;\n\t\t}),\n\t\t...repeat(amountOfCivilians, i => {\n\t\t\tconst id = seed + '-person-' + i;\n\t\t\tconst start = Random.arrayItem(walkableTiles, id, 'start');\n\t\t\tconst worker = new CivilianEntity(id, start);\n\t\t\tworker.doJob(new LoiterJob(worker));\n\t\t\treturn worker;\n\t\t})\n\t];\n}\n","import React, { FunctionComponent, useMemo, useState } from 'react';\nimport { PERSPECTIVE } from '../space/PERSPECTIVE';\nimport { color } from '../styles';\nimport { SvgMouseInteractionProps } from '../types';\nimport { DualMeshTerrain, DualMeshTile } from './DualMeshTerrain';\nimport { GenericTerrainComponentI } from './GenericTerrain';\n\nconst TERRAIN_FILL = color.terrain.string();\nconst TERRAIN_FILL_HIGHLIGHTED = color.beach.string();\nconst TERRAIN_FILL_WATER = 'transparent';\nconst TERRAIN_STROKE = color.terrainStroke.string();\nconst TERRAIN_STROKE_WATER = color.terrainStroke.opaquer(-0.8).string();\n\nconst DualMeshTileComponent: FunctionComponent<\n\tSvgMouseInteractionProps & {\n\t\ttile: DualMeshTile;\n\t}\n> = ({ tile, ...svgProps }) => {\n\tconst [isHovered, setIsHovered] = useState(false);\n\tconst points = useMemo(() => {\n\t\tif (!tile.isLand() && !tile._neighbors?.some(n => n.isLand())) {\n\t\t\treturn;\n\t\t}\n\t\tif (!tile._outlinePoints || tile._outlinePoints.length < 3) {\n\t\t\tthrow new Error('Not a polygon');\n\t\t}\n\t\tconst points = [...tile._outlinePoints, tile._outlinePoints[0]]\n\t\t\t.map(n => PERSPECTIVE.toPixels(n.x, n.y, tile.z).join(','))\n\t\t\t.join(' ');\n\n\t\treturn <polygon points={points} />;\n\t}, [tile]);\n\n\tif (!points) {\n\t\treturn null;\n\t}\n\treturn (\n\t\t<g\n\t\t\tclassName=\"dual-mesh-tile\"\n\t\t\tfill={\n\t\t\t\ttile.isLand()\n\t\t\t\t\t? isHovered\n\t\t\t\t\t\t? TERRAIN_FILL_HIGHLIGHTED\n\t\t\t\t\t\t: TERRAIN_FILL\n\t\t\t\t\t: TERRAIN_FILL_WATER\n\t\t\t}\n\t\t\tstroke={tile.isLand() ? TERRAIN_STROKE : TERRAIN_STROKE_WATER}\n\t\t\t{...svgProps}\n\t\t\tonMouseEnter={() => setIsHovered(true)}\n\t\t\tonMouseLeave={() => setIsHovered(false)}\n\t\t>\n\t\t\t{points}\n\t\t</g>\n\t);\n};\n\nexport const DualMeshTerrainComponent: GenericTerrainComponentI<DualMeshTerrain, DualMeshTile> = ({\n\tterrain,\n\tonTileClick,\n\tonTileContextMenu\n}) => {\n\tconst pathElements = useMemo(() => {\n\t\tconst seen: DualMeshTile[] = [];\n\n\t\treturn terrain.tiles\n\t\t\t.reduce<[DualMeshTile, DualMeshTile][]>((connections, origin) => {\n\t\t\t\tseen.push(origin);\n\t\t\t\treturn origin.isLand()\n\t\t\t\t\t? connections.concat(\n\t\t\t\t\t\t\tterrain\n\t\t\t\t\t\t\t\t.getNeighborTiles(origin)\n\t\t\t\t\t\t\t\t.filter(target => target.isLand())\n\t\t\t\t\t\t\t\t.filter(target => !seen.includes(target))\n\t\t\t\t\t\t\t\t.map(target => [origin, target])\n\t\t\t\t\t  )\n\t\t\t\t\t: connections;\n\t\t\t}, [])\n\t\t\t.map(coords => coords.map(c => PERSPECTIVE.toPixels(c.x, c.y, c.z)))\n\t\t\t.map(([origin, target]) => (\n\t\t\t\t<line\n\t\t\t\t\tkey={`${origin}x${target}`}\n\t\t\t\t\tx1={origin[0]}\n\t\t\t\t\ty1={origin[1]}\n\t\t\t\t\tx2={target[0]}\n\t\t\t\t\ty2={target[1]}\n\t\t\t\t\tstroke={color.terrainStroke.opaquer(-0.6).string()}\n\t\t\t\t\tstrokeDasharray=\"3\"\n\t\t\t\t/>\n\t\t\t));\n\t}, [terrain]);\n\tconst terrainElements = useMemo(\n\t\t() =>\n\t\t\tterrain.getTilesInRenderOrder().map(tile => (\n\t\t\t\t<DualMeshTileComponent\n\t\t\t\t\tkey={tile.toString()}\n\t\t\t\t\ttile={tile}\n\t\t\t\t\tonClick={\n\t\t\t\t\t\tonTileClick\n\t\t\t\t\t\t\t? event => {\n\t\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t\t\tonTileClick(event, tile);\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: onTileClick\n\t\t\t\t\t}\n\t\t\t\t\tonContextMenu={\n\t\t\t\t\t\tonTileContextMenu\n\t\t\t\t\t\t\t? event => {\n\t\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\t\tonTileContextMenu(event, tile);\n\t\t\t\t\t\t\t  }\n\t\t\t\t\t\t\t: onTileContextMenu\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t)),\n\t\t[terrain, onTileClick, onTileContextMenu]\n\t);\n\treturn (\n\t\t<g className=\"dual-mesh-terrain\">\n\t\t\t<g className=\"dual-mesh-terrain__tiles\">{terrainElements}</g>\n\t\t\t<g className=\"dual-mesh-terrain__paths\">{pathElements}</g>\n\t\t</g>\n\t);\n};\n","import { distanceToCameraComparator } from '../space/PERSPECTIVE';\nimport { Coordinate, CoordinateLike } from '../classes/Coordinate';\nimport { FunctionComponent } from 'react';\n\ntype TileFilter<T extends GenericTile> = (tile: T) => boolean;\n\n/**\n * A special type of coordinate that is equal to another terrain coordinate when the X and Y are equal, disregarding Z.\n */\nexport class GenericTile extends Coordinate {\n\tpublic terrain?: GenericTerrain<GenericTile>;\n\n\tequals(coord: CoordinateLike) {\n\t\treturn this === coord || (coord && this.x === coord.x && this.y === coord.y);\n\t}\n\n\tstatic clone(coord: GenericTile) {\n\t\tconst coord2 = new GenericTile(coord.x, coord.y, coord.z);\n\t\tcoord2.terrain = (coord as GenericTile).terrain;\n\t\treturn coord2;\n\t}\n\n\tisLand() {\n\t\treturn this.z >= 0;\n\t}\n\n\t// For debugging purposes only, may change without notice or tests\n\ttoString() {\n\t\treturn '(' + [this.x, this.y].map((num: number) => num.toFixed(2)).join(',') + ')';\n\t}\n}\n\nexport abstract class GenericTerrain<T extends GenericTile> {\n\t/**\n\t * Private\n\t */\n\n\t//\n\tprivate _tilesInRenderOrder: T[] | null = null;\n\n\t/**\n\t * Public, shared code\n\t */\n\n\tpublic readonly tiles: T[] = [];\n\n\t//\n\tprotected islands: Map<TileFilter<T>, T[][]> = new Map();\n\n\tconstructor(tiles: T[]) {\n\t\tthis.tiles = tiles;\n\t}\n\n\t//\n\tpublic selectContiguousTiles(start: T, selector: TileFilter<T> = c => c.isLand()): T[] {\n\t\tconst island: T[] = [];\n\t\tconst seen: T[] = [];\n\t\tconst queue: T[] = [start];\n\n\t\twhile (queue.length) {\n\t\t\tconst current = queue.shift() as T;\n\t\t\tisland.push(current);\n\n\t\t\tconst neighbours = this.getNeighborTiles(current).filter(n => !seen.includes(n));\n\t\t\tseen.splice(0, 0, current, ...neighbours);\n\t\t\tqueue.splice(0, 0, ...neighbours.filter(selector));\n\t\t}\n\t\treturn island;\n\t}\n\n\t//\n\tpublic selectClosestTiles(start: T, maxDistance: number): T[] {\n\t\treturn this.selectContiguousTiles(\n\t\t\tstart,\n\t\t\tother => other.isLand() && start.euclideanDistanceTo(other) <= maxDistance\n\t\t);\n\t}\n\n\t//\n\tpublic getIslands(selector: TileFilter<T> = t => t.isLand()): T[][] {\n\t\tconst fromCache = this.islands.get(selector);\n\t\tif (fromCache) {\n\t\t\treturn fromCache;\n\t\t}\n\n\t\tlet open = this.tiles.slice();\n\t\tconst islands = [];\n\t\twhile (open.length) {\n\t\t\tconst next = open.shift() as T;\n\t\t\tif (!selector(next)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst island = this.selectContiguousTiles(next, selector);\n\t\t\topen = open.filter(n => !island.includes(n));\n\t\t\tislands.push(island);\n\t\t}\n\n\t\tthis.islands.set(selector, islands);\n\t\treturn islands;\n\t}\n\n\t//\n\tpublic getTilesInRenderOrder() {\n\t\tif (!this._tilesInRenderOrder) {\n\t\t\tthis._tilesInRenderOrder = this.tiles.slice().sort(distanceToCameraComparator);\n\t\t}\n\t\treturn this._tilesInRenderOrder;\n\t}\n\n\t/**\n\t * Abstract methods\n\t */\n\n\t//\n\tpublic abstract Component: FunctionComponent<GenericTerrainComponentProps<T>> = () => {\n\t\tthrow new Error('Not implemented');\n\t};\n\n\t//\n\tpublic abstract getClosestToXy(x: number, y: number): T;\n\n\t//\n\tpublic abstract getNeighborTiles(center: T): T[];\n\n\t/**\n\t * Statics\n\t */\n\n\t//\n\tstatic generateRandom(seed: string, size: number): GenericTerrain<GenericTile> {\n\t\tthrow new Error('Not implemented');\n\t}\n}\n\nexport type GenericTerrainComponentProps<Tile extends GenericTile = GenericTile> = {\n\tonTileClick?: (event: React.MouseEvent<SVGGElement>, tile: Tile) => void;\n\tonTileContextMenu?: (event: React.MouseEvent<SVGGElement>, tile: Tile) => void;\n};\n\nexport type GenericTerrainComponentI<\n\tTerrain extends GenericTerrain<GenericTile> = GenericTerrain<GenericTile>,\n\tTile extends GenericTile = GenericTile\n> = FunctionComponent<\n\t{\n\t\tterrain: Terrain;\n\t} & GenericTerrainComponentProps<Tile>\n>;\n","import MeshBuilder from 'dual-mesh/create';\nimport Poisson from 'poisson-disk-sampling';\nimport React, { FunctionComponent } from 'react';\nimport { Coordinate, CoordinateArray } from '../classes/Coordinate';\nimport { Random } from '../util/Random';\nimport { DualMeshTerrainComponent } from './DualMeshTileComponent';\n\nimport { GenericTerrain, GenericTerrainComponentProps, GenericTile } from './GenericTerrain';\n\nexport class DualMeshTile extends GenericTile {\n\tpublic _neighbors?: DualMeshTile[];\n\tpublic _outlinePoints?: Coordinate[];\n\tpublic _isGhost?: boolean;\n\tprivate _isLand?: boolean = undefined;\n\n\tisLand() {\n\t\tif (this._isLand === undefined) {\n\t\t\t// Return a subset of tiles to reduce \"ugly\" shapes and the\n\t\t\tthis._isLand =\n\t\t\t\t// Must be above the waterline:\n\t\t\t\tthis.z >= 0 &&\n\t\t\t\t// And must be at least <4> neighbors away from an outermost tile\n\t\t\t\t!(function r(item: DualMeshTile, maxDepth: number): boolean {\n\t\t\t\t\tif (item._isGhost) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\tif (maxDepth <= 0) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t--maxDepth;\n\t\t\t\t\treturn item._neighbors?.some(n => r(n, maxDepth)) || false;\n\t\t\t\t})(this, 2);\n\t\t}\n\t\treturn this._isLand;\n\t}\n}\n\nexport class DualMeshTerrain extends GenericTerrain<DualMeshTile> {\n\t// private mesh: any;\n\n\tconstructor(tiles: DualMeshTile[], _mesh: any) {\n\t\tsuper(tiles);\n\t\t// this.mesh = mesh;\n\t\tthis.tiles.forEach((coordinate, i) => {\n\t\t\tcoordinate.terrain = this;\n\t\t});\n\t}\n\n\toverride Component: FunctionComponent<GenericTerrainComponentProps<DualMeshTile>> = props =>\n\t\tReact.createElement(DualMeshTerrainComponent, {\n\t\t\tterrain: this,\n\t\t\t...props\n\t\t});\n\n\toverride getClosestToXy(x: number, y: number): DualMeshTile {\n\t\tconst center = new Coordinate(x, y, 0);\n\t\tconst { tile } = this.tiles.reduce<{ tile?: DualMeshTile; distance: number }>(\n\t\t\t(last, tile) => {\n\t\t\t\tconst distance = center.euclideanDistanceTo(tile);\n\t\t\t\treturn distance < last.distance ? { distance, tile } : last;\n\t\t\t},\n\t\t\t{ distance: Infinity }\n\t\t);\n\t\tif (!tile) {\n\t\t\tthrow new Error('No tiles, ' + this.tiles.length);\n\t\t}\n\t\treturn tile;\n\t}\n\n\toverride getNeighborTiles(center: DualMeshTile): DualMeshTile[] {\n\t\treturn center._neighbors || [];\n\t}\n}\n\nexport function generateRandom(seed: string, size: number, density: number = 1) {\n\t// Use @redblobgames/dual-mesh to generate tiles and relationships.\n\t// More information:\n\t// - https://redblobgames.github.io/dual-mesh/\n\t// - https://github.com/redblobgames/dual-mesh\n\tlet i = 0;\n\tconst poisson = new Poisson(\n\t\t{\n\t\t\tshape: [size, size],\n\t\t\tminDistance: 1 / density\n\t\t},\n\t\t() => Random.float(`${seed}/${++i}`)\n\t);\n\tconst meshBuilder = new MeshBuilder({ boundarySpacing: 1 });\n\tmeshBuilder.points.forEach((p: [number, number]) => poisson.addPoint(p));\n\tmeshBuilder.points = poisson\n\t\t.fill()\n\t\t.map((xy: [number, number], i: number) => [\n\t\t\t...xy,\n\t\t\t(-0.2 + Random.float(seed, ...xy)) * 0.4\n\t\t]);\n\n\tconst mesh = meshBuilder.create();\n\tconst tiles = (meshBuilder.points as Array<CoordinateArray>)\n\t\t.map((coordinates, i) => new DualMeshTile(...coordinates))\n\t\t.map((tile, i) => {\n\t\t\tconst outlinePointIndices = mesh.r_circulate_t([], i);\n\t\t\ttile._outlinePoints = outlinePointIndices.map(\n\t\t\t\t(i: number) => new Coordinate(mesh.t_x(i), mesh.t_y(i), tile.z)\n\t\t\t);\n\n\t\t\ttile._isGhost = outlinePointIndices.some((index: number) => mesh.t_ghost(index));\n\t\t\treturn tile;\n\t\t})\n\t\t.map((tile, i, tiles) => {\n\t\t\ttile._neighbors = mesh\n\t\t\t\t.r_circulate_r([], i)\n\t\t\t\t.map((x: keyof DualMeshTerrain['tiles']) => tiles[x])\n\t\t\t\t.filter(Boolean);\n\n\t\t\treturn tile;\n\t\t})\n\t\t.filter(Boolean);\n\n\tconst terrain = new DualMeshTerrain(tiles, mesh);\n\n\t// terrain\n\t// \t.getIslands(t => t.isLand())\n\t// \t.forEach(island => {\n\t// \t\tconst { x, y } = island.reduce(\n\t// \t\t\t(c, t) => c.transform(t.x, t.y, t.z),\n\t// \t\t\tnew Coordinate(0, 0, 0)\n\t// \t\t);\n\t// \t\tconst centerIsh = terrain.getClosestToXy(x / island.length, y / island.length);\n\t// \t\tconsole.log(centerIsh);\n\t// \t\tif (!island.includes(centerIsh)) {\n\t// \t\t\treturn;\n\t// \t\t}\n\t// \t\tterrain.selectClosestTiles(centerIsh, size / 3).forEach(t => t.transform(0, 0, 5));\n\t// \t});\n\n\t// for (let iterations = 25; iterations > 0; --iterations) {\n\t// \tterrain.tiles.forEach(t => {\n\t// \t\tt.z = t._neighbors\n\t// \t\t\t? 0.5 * t.z +\n\t// \t\t\t  (0.5 * t._neighbors.reduce((tot, tt) => (tot += tt.z), 0)) / t._neighbors.length\n\t// \t\t\t: t.z;\n\t// \t});\n\t// }\n\n\treturn terrain;\n}\n","// const ActiveEntityOverlay: FunctionComponent = ({ children }) => null;\n\nimport styled from '@emotion/styled';\nimport React, { FunctionComponent } from 'react';\nimport { Entity } from '../entities/Entity';\n\nconst borderColor = `rgba(0,0, 0, 0.5)`;\nconst ActiveEntityOverlayBoundary = styled.div`\n\tbackdrop-filter: blur(2px);\n`;\n\nconst ActiveEntityOverlayBody = styled.div`\n\tborder: 1px solid ${borderColor};\n\tbackground-color: rgba(0, 0, 0, 0.4);\n\tborder-radius: 3px;\n\tpadding: 1em;\n\tdisplay: flex;\n\tflex-direction: row;\n`;\nconst Avatar = styled.div`\n\tborder: 1px solid ${borderColor};\n\tborder-radius: 50%;\n\twidth: 64px;\n\theight: 64px;\n\tjustify-content: center;\n\talign-items: center;\n\tdisplay: flex;\n\tmargin-right: 1em;\n`;\nconst HorizontalLinkList = styled.nav`\n\tdisplay: flex;\n\tflex-direction: row;\n\tfont-size: 60%;\n\ttext-transform: uppercase;\n`;\nconst HorizontalLinkListItem = styled.a`\n\tflex: 0 0 auto;\n\tbackground-color: rgba(255, 255, 255, 0.1);\n\tmargin-right: 3px;\n\n\t// Same as ContextMenuItem\n\tpadding: 0.125em 0.5em;\n\twhite-space: nowrap;\n\ttransition: background-color 0.5s;\n\tcolor: white;\n\t/* background-color: transparent; */\n\t/* background-color: rgba(255, 255, 255, 0.05); */\n\t&:hover {\n\t\tbackground-color: ${borderColor};\n\t\tcursor: pointer;\n\t}\n`;\nexport const EntityTextBadge: FunctionComponent<{ entity: Entity }> = ({ entity }) => (\n\t<>\n\t\t<p>\n\t\t\t<b>{entity.label}</b>\n\t\t</p>\n\t\t<p>{entity?.job ? entity.job.label : 'Jobless'}</p>\n\t\t<HorizontalLinkList style={{ marginTop: '1em' }}>\n\t\t\t<HorizontalLinkListItem\n\t\t\t\tonClick={() => {\n\t\t\t\t\tconsole.group('Selected entity');\n\t\t\t\t\tconsole.log(entity);\n\t\t\t\t\tconsole.groupEnd();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\tLOG\n\t\t\t</HorizontalLinkListItem>\n\t\t\t<HorizontalLinkListItem\n\t\t\t\tonClick={() => {\n\t\t\t\t\tconsole.warn('Following entity not implemented yet', entity);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\tFOLLOW\n\t\t\t</HorizontalLinkListItem>\n\t\t</HorizontalLinkList>\n\t</>\n);\nexport const ActiveEntityOverlay: FunctionComponent<{ entity?: Entity; zoom?: number }> = ({\n\tentity,\n\tzoom = 4\n}) => (\n\t<ActiveEntityOverlayBoundary>\n\t\t<ActiveEntityOverlayBody>\n\t\t\t<Avatar>\n\t\t\t\t{entity && (\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"1\"\n\t\t\t\t\t\theight=\"1\"\n\t\t\t\t\t\toverflow=\"visible\"\n\t\t\t\t\t\tshapeRendering=\"geometricPrecision\"\n\t\t\t\t\t\tviewBox={[0, 0, 1 / zoom, 1 / zoom].join(' ')}\n\t\t\t\t\t>\n\t\t\t\t\t\t<entity.Component />\n\t\t\t\t\t</svg>\n\t\t\t\t)}\n\t\t\t</Avatar>\n\t\t\t<div>{entity ? <EntityTextBadge entity={entity} /> : null}</div>\n\t\t</ActiveEntityOverlayBody>\n\t</ActiveEntityOverlayBoundary>\n);\n","import styled from '@emotion/styled';\n\nexport const Overlay = styled.section`\n\tposition: absolute;\n\tbottom: 2em;\n\tleft: 2em;\n\n\tfont-family: sans-serif;\n\tcolor: white;\n\n\ta {\n\t\tcolor: inherit;\n\t}\n`;\n","import React, { FunctionComponent, useEffect, useMemo, useState } from 'react';\nimport { Entity } from '../entities/Entity';\nimport { PersonEntity, PersonEntityComponent } from '../entities/PersonEntity';\nimport { Game } from '../Game';\nimport { Viewport } from '../space/Viewport';\nimport { GenericTile } from '../terrain/GenericTerrain';\nimport { ActiveEntityOverlay } from './ActiveEntityOverlay';\nimport { ContextMenuButton, ContextMenuContainer, ContextMenuFooter } from './ContextMenu';\nimport { Overlay } from './Overlay';\n\nfunction fancyTimeFormat(seconds: number) {\n\treturn `${~~((seconds % 3600) / 60)}′ ${Math.floor(seconds % 60)}″`;\n}\nfunction fakeCoordinates(x: number, y: number) {\n\treturn `40° ${fancyTimeFormat(1000 - x * 13)} N 79° ${fancyTimeFormat(700 - y * 13)} W`;\n}\n\nexport const GameApplication: FunctionComponent<{\n\tgame: Game;\n\tinitialViewportCenter: GenericTile;\n}> = ({ game, initialViewportCenter }) => {\n\tconst { scene, contextMenu } = game;\n\n\tconst [center, setCenter] = useState(initialViewportCenter);\n\n\tconst [activeEntity, setActiveEntity] = useState<Entity | undefined>(undefined);\n\n\tconst terrain = useMemo(\n\t\t() => (\n\t\t\t<scene.terrain.Component\n\t\t\t\tonTileClick={(event, tile) => {\n\t\t\t\t\tcontextMenu.open(\n\t\t\t\t\t\ttile,\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<ContextMenuButton onClick={() => setCenter(tile)}>\n\t\t\t\t\t\t\t\tCenter camera\n\t\t\t\t\t\t\t</ContextMenuButton>\n\t\t\t\t\t\t\t<ContextMenuButton\n\t\t\t\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\t\t\t\tconsole.group(`Tile ${tile}`);\n\t\t\t\t\t\t\t\t\tconsole.log(tile);\n\t\t\t\t\t\t\t\t\tconsole.groupEnd();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tShow in console\n\t\t\t\t\t\t\t</ContextMenuButton>\n\t\t\t\t\t\t\t<ContextMenuFooter>{fakeCoordinates(tile.x, tile.y)}</ContextMenuFooter>\n\t\t\t\t\t\t</>\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t\tonTileContextMenu={(event, tile) => {\n\t\t\t\t\tsetCenter(tile);\n\t\t\t\t}}\n\t\t\t/>\n\t\t),\n\t\t[scene, contextMenu]\n\t);\n\n\tconst entities = useMemo(\n\t\t() =>\n\t\t\tscene.entities\n\t\t\t\t.filter((entity): entity is PersonEntity => entity instanceof PersonEntity)\n\t\t\t\t.map((entity) => (\n\t\t\t\t\t<PersonEntityComponent\n\t\t\t\t\t\tkey={entity.id}\n\t\t\t\t\t\tentity={entity}\n\t\t\t\t\t\tonClick={(event) => {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tsetActiveEntity(entity);\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t)),\n\t\t[scene.entities]\n\t);\n\n\tuseEffect(() => {\n\t\tconst cb = () => {\n\t\t\tcontextMenu.close();\n\t\t};\n\n\t\twindow.addEventListener('click', cb);\n\t\treturn () => window.removeEventListener('click', cb);\n\t}, [contextMenu]);\n\n\treturn (\n\t\t<>\n\t\t\t<Viewport center={center} zoom={1} overlay={<ContextMenuContainer zoom={1} />}>\n\t\t\t\t<g id=\"scene__terrain\">{terrain}</g>\n\t\t\t\t<g id=\"scene__entities\">{entities}</g>\n\t\t\t</Viewport>\n\t\t\t<Overlay>\n\t\t\t\t<ActiveEntityOverlay entity={activeEntity} />\n\t\t\t\t<p style={{ fontSize: '0.8em', opacity: '0.5' }}>\n\t\t\t\t\t<a\n\t\t\t\t\t\thref=\"https://github.com/wvbe/kreuzzeug-im-nagelhosen\"\n\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\trel=\"noreferrer\"\n\t\t\t\t\t>\n\t\t\t\t\t\tGitHub\n\t\t\t\t\t</a>\n\t\t\t\t\t{'    '}\n\t\t\t\t\tSeed: {scene.seed}\n\t\t\t\t</p>\n\t\t\t</Overlay>\n\t\t</>\n\t);\n};\n","import React, { useEffect, useMemo } from 'react';\nimport { Route, Switch } from 'react-router';\nimport { Link } from 'react-router-dom';\nimport { Scene } from './classes/Scene';\nimport DemoCubes from './demos/demo.cubes';\nimport { Game, GameContext } from './Game';\nimport { generateEntities } from './generators/hello-world';\nimport { generateRandom as generateTerrain } from './terrain/DualMeshTerrain';\nimport { GameApplication } from './ui/GameApplication';\n\nfunction generateEverything(seed: string = String(Date.now())) {\n\tconst size = 48;\n\tconst density = 1;\n\tlet game: Game;\n\tif ((window as any).game) {\n\t\tgame = (window as any).game;\n\t} else {\n\t\tconst terrain = generateTerrain(seed, size, density);\n\t\tconst entities = generateEntities(seed, terrain);\n\t\tconst scene = new Scene(seed, terrain, entities);\n\t\tgame = new Game(scene);\n\t\t(window as any).game = game;\n\t}\n\tconst initialViewportCenter = game.scene.terrain.getClosestToXy(\n\t\tMath.floor(size / 2),\n\t\tMath.floor(size / 2)\n\t);\n\treturn {\n\t\tgame,\n\t\tinitialViewportCenter\n\t};\n}\n\nfunction GameRoute() {\n\tconst gameApplicationProps = useMemo(() => generateEverything(), []);\n\tuseEffect(() => gameApplicationProps.game.scene.play(), [gameApplicationProps.game.scene]);\n\treturn (\n\t\t<GameContext.Provider value={gameApplicationProps.game}>\n\t\t\t<GameApplication {...gameApplicationProps} />\n\t\t</GameContext.Provider>\n\t);\n}\n\nfunction TestRoute() {\n\treturn (\n\t\t<>\n\t\t\t<ul>\n\t\t\t\t<li>\n\t\t\t\t\t<Link to=\"/tests\">Tests</Link>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t<Route exact path=\"/tests\" component={DemoCubes} />\n\t\t</>\n\t);\n}\n\nfunction App() {\n\treturn (\n\t\t<Switch>\n\t\t\t<Route exact path=\"/\" component={GameRoute} />\n\t\t\t<Route component={TestRoute} />\n\t\t</Switch>\n\t);\n}\n\nexport default App;\n","import { Global } from '@emotion/react';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { HashRouter } from 'react-router-dom';\n\nimport App from './App';\nimport globalStyleRules from './styles';\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<Global styles={globalStyleRules} />\n\t\t<HashRouter hashType={'slash'}>\n\t\t\t<App />\n\t\t</HashRouter>\n\t</React.StrictMode>,\n\tdocument.getElementById('root')\n);\n"],"sourceRoot":""}
{"version":3,"sources":["space/PERSPECTIVE.ts","space/LinePath.tsx","space/Anchor.tsx","textures/nebula-282c34.png","styles.ts","space/MonochromeBox.tsx","space/Viewport.tsx","demos/scaffolding.tsx","demos/demo.cubes.tsx","util/BinaryHeap.ts","classes/Path.ts","constants/names.tsx","util/Event.ts","entities/Entity.tsx","entities/PersonEntity.tsx","entities/CivilianEntity.tsx","classes/Coordinate.ts","entities/GuardEntity.tsx","util/Random.ts","jobs/Job.ts","jobs/LoiterJob.ts","jobs/PatrolJob.ts","generators/hello-world.ts","classes/TerrainGenerator.ts","space/MonochromeTile.tsx","terrain/CubicTerrainComponent.tsx","terrain/GenericTerrain.ts","terrain/CubicTerrain.ts","classes/Scene.ts","ui/ActiveEntityOverlay.tsx","ui/ContextMenu.tsx","ui/Overlay.tsx","demos/scene.hello-world.tsx","terrain/DualMeshTileComponent.tsx","demos/scene.dual-mesh.tsx","App.tsx","index.tsx"],"names":["PERSPECTIVE","degrees","tileSize","_cos","_sin","_tan","this","isometricAngle","Math","PI","cos","sin","tan","x","y","z","cartX","cartY","tileHeight","isoY","distanceToCameraComparator","a","b","dX","dY","dZ","LinePath","path","stroke","strokeWidth","spatialCoordinates","map","coordinate","toPixels","cc","c","reduce","lines","start","i","all","concat","x1","y1","x2","y2","String","Crosshair","size","points","Anchor","children","crosshairSize","pixels","useMemo","overflow","MovingAnchor","moveTo","moveSpeed","onRest","onClick","dx","dy","ix","iy","loc","useSpring","to","config","duration","from","svg","color","white","Color","terrain","highlightedTerrain","lighten","styles","css","toString","darken","saturate","desaturate","mix","nebulaTexture","coordsToPixels","coords","borderWidth","COORDINATE_CLOSEST_TO_CAMERA","BORDER_NODES","XZ_NODES","YZ_NODES","XY_NODES","MonochromeBox","fill","strokeLinecap","innerStroke","innerStrokeWidth","gProps","innerStrokeCss","string","strokeCss","style","onContextMenu","cursor","join","PIXEL_FRIENDLY_PYTHAGORAS","pow","mathRoundMaybe","n","round","AbsolutelyPositionedContainer","styled","div","Viewport","overlay","center","zoom","translateX","translateY","springStyles","transform","ViewportSvgContainer","rest","width","height","shapeRendering","viewBox","NoAxis","YAxis","ZAxis","sqrt","XAxis","ViewportHtmlContainer","location","axis","left","top","pixelWidth","Axis","abs","Backdrop","Demo","window","alert","BinaryHeap","scoreFunction","content","element","push","sinkDown","length","result","end","pop","bubbleUp","node","indexOf","parentN","parent","elemScore","child2N","child1N","swap","child1Score","child1","child2","MANHATTAN","pos0","pos1","Path","graph","options","cache","heap","heuristic","Map","get","Error","f","closestNode","closestNodeHeuristics","h","g","closed","visited","set","currentNode","currentNodeHeuristics","equals","tracePath","neighbors","getNeighborTiles","il","neighbor","neighborHeuristics","isLand","gScore","beenVisited","hScore","closest","rescoreElement","console","warn","heuristicReport","curr","unshift","FIRST_NAMES_M","replace","split","name","trim","FIRST_NAMES_F","Event","listeners","callback","splice","args","forEach","noop","PersonEntity","id","pathStart","pathEnd","pathStepStart","pathStepEnd","passport","Component","cx","cy","r","on","feminine","random","firstName","floor","destination","find","emit","unlisten","nextStep","shift","doPathStep","hasNaN","job","constructor","PersonEntityComponent","entity","useState","animatePosition","deps","cb","useCallback","eventDestroyers","d","useEffect","useEventListeners","euclideanDistanceTo","CivilianEntity","Coordinate","coord","dz","isNaN","xy","offset","GuardEntity","Random","seed","seedrandom","double","arr","index","float","Job","LoiterJob","walkMinWait","walkMaxWait","walkChanceOnRoll","walkMaxDistance","steps","doTimeout","setTimeout","destinations","selectClosestTiles","walkTo","arrayItem","destroyers","PatrolJob","waypoints","waypointIndex","next","repeat","Array","_","generateEntities","walkableTiles","tiles","filter","guard","island","getIslands","includes","generatePatrolJob","doJob","worker","OUT_OF_BOUNDS","Symbol","average","values","valid","val","sum","TerrainGenerator","max","detail","ceil","log","Float32Array","roughness","divide","half","scale","square","diamond","ave","MonochromeTile","CubicTileComponent","terrainCoordinate","tile","svgMouseInteractionProps","isHovered","setIsHovered","translated","clone","undefined","onMouseEnter","onMouseLeave","opaquer","CubicTerrainComponent","onTileClick","onTileContextMenu","className","getTilesInRenderOrder","event","preventDefault","stopPropagation","GenericTile","coord2","GenericTerrain","islands","_tilesInRenderOrder","slice","sort","selector","seen","queue","current","neighbours","maxDistance","selectContiguousTiles","other","t","fromCache","open","CubicTile","CubicTerrain","coordinates","props","React","createElement","getClosestToXy","Boolean","getIndexForXy","Scene","entities","play","generator","generate","sortedHeights","waterlineOffset","generateRandom","generateHelloWorldEntities","ActiveEntityOverlayBoundary","ActiveEntityOverlayBody","Avatar","HorizontalLinkList","nav","HorizontalLinkListItem","EntityTextBadge","label","marginTop","group","groupEnd","ActiveEntityOverlay","ContextMenuContext","createContext","ContextMenuArrow","ContextMenuBoundary","ContextMenuBody","ContextMenuButton","button","ContextMenuFooter","ContextMenuManager","state","change","contents","ContextMenuContainer","contextMenuManager","useContext","managerState","setManagerState","Overlay","section","fancyTimeFormat","seconds","scene","Date","now","contextManager","WORLD_SIZE","setCenter","activeEntity","setActiveEntity","invoke","close","addEventListener","removeEventListener","Provider","value","fontSize","opacity","href","target","rel","DualMeshTileComponent","nodes","TerrainMesh","poisson","Poisson","shape","minDistance","mesh","MeshBuilder","boundarySpacing","p","addPoint","create","point","r_circulate_t","t_x","t_y","Demos","exact","component","DemoCubes","App","DualMeshWorld","SceneHelloWorld","ReactDOM","render","StrictMode","globalStyleRules","hashType","document","getElementById"],"mappings":"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","file":"static/js/main.4de332d7.chunk.js","sourcesContent":["import { CoordinateLike } from '../classes/Coordinate';\n\n//        z+,                height\n//        |        __ y+,    depth\n//        |     __/\n//        |  __/\n//    0,0 |_/\n//          \\__\n//             \\__\n//                \\__ x+,    width\n\nconst BASE_LENGTH = 32;\n\nexport type InGameDistance = number;\nexport type OnScreenDistance = number;\nexport type OnSreenAngle = number;\n\nclass Perspective {\n\tpublic readonly degrees: OnSreenAngle;\n\tpublic readonly tileSize: OnScreenDistance;\n\n\tprivate _cos: OnSreenAngle;\n\tprivate _sin: OnSreenAngle;\n\tprivate _tan: OnSreenAngle;\n\n\tconstructor(degrees: OnSreenAngle, tileSize: OnScreenDistance) {\n\t\tthis.degrees = degrees;\n\t\tthis.tileSize = tileSize;\n\n\t\tconst isometricAngle = degrees * (Math.PI / 180);\n\t\tthis._cos = Math.cos(isometricAngle);\n\t\tthis._sin = Math.sin(isometricAngle);\n\t\tthis._tan = Math.tan(isometricAngle);\n\t}\n\n\ttoPixels(\n\t\tx: InGameDistance,\n\t\ty: InGameDistance,\n\t\tz: InGameDistance\n\t): [OnScreenDistance, OnScreenDistance] {\n\t\tconst cartX = (x + y) * this._cos,\n\t\t\tcartY = (x - y) * this._sin;\n\n\t\tconst tileHeight = this.tileSize;\n\n\t\treturn [\n\t\t\tcartX * this.tileSize, // x\n\t\t\tcartY * this.tileSize - tileHeight * z // y\n\t\t];\n\t}\n\n\tprivate toCoords(\n\t\tcartX: InGameDistance,\n\t\tcartY: InGameDistance\n\t): [InGameDistance, InGameDistance, InGameDistance] {\n\t\tconst isoY = this._tan * cartX + cartY,\n\t\t\tisoX = (cartY - isoY) / -this._sin - isoY;\n\n\t\t// this is good so far, b should be rescaled for tile size. as\n\t\treturn [isoX / this.tileSize, isoY / this.tileSize, 0];\n\t}\n}\n\nexport const PERSPECTIVE = new Perspective(30, BASE_LENGTH);\n\nexport function distanceToCameraComparator(a: CoordinateLike, b: CoordinateLike) {\n\tconst dX = b.x - a.x;\n\tif (dX) {\n\t\treturn -dX;\n\t}\n\n\tconst dY = a.y - b.y;\n\tif (dY) {\n\t\treturn -dY;\n\t}\n\tconst dZ = b.z - a.z;\n\tif (dZ) {\n\t\treturn -dZ;\n\t}\n\treturn 0;\n}\n","import React, { FunctionComponent, ReactElement } from 'react';\nimport { CoordinateArray } from '../classes/Coordinate';\n\nimport { PERSPECTIVE } from './PERSPECTIVE';\n\nconst BORDER_WIDTH = 0;\n\nexport const LinePath: FunctionComponent<\n\tOmit<React.SVGProps<SVGLineElement>, 'path'> & {\n\t\tpath: CoordinateArray[];\n\t}\n> = ({ path, stroke = 'black', strokeWidth = BORDER_WIDTH }) => {\n\tlet spatialCoordinates = path\n\t\t.map(coordinate => PERSPECTIVE.toPixels(...coordinate))\n\t\t.map(cc => cc.map(c => c + BORDER_WIDTH));\n\n\treturn (\n\t\t<>\n\t\t\t{spatialCoordinates.reduce<ReactElement[]>(\n\t\t\t\t(lines, start, i, all) =>\n\t\t\t\t\ti\n\t\t\t\t\t\t? lines.concat([\n\t\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\t\t\tx1={start[0]}\n\t\t\t\t\t\t\t\t\ty1={start[1]}\n\t\t\t\t\t\t\t\t\tx2={all[i - 1][0]}\n\t\t\t\t\t\t\t\t\ty2={all[i - 1][1]}\n\t\t\t\t\t\t\t\t\tstroke={stroke}\n\t\t\t\t\t\t\t\t\tstrokeWidth={String(strokeWidth)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t  ])\n\t\t\t\t\t\t: lines,\n\t\t\t\t[]\n\t\t\t)}\n\t\t</>\n\t);\n};\n","import { useSpring } from '@react-spring/core';\nimport { animated } from '@react-spring/web';\nimport React, { FunctionComponent, useMemo } from 'react';\nimport { CoordinateArray, CoordinateLike } from '../classes/Coordinate';\nimport { SvgMouseInteractionProps } from '../types';\nimport { LinePath } from './LinePath';\nimport { InGameDistance, PERSPECTIVE } from './PERSPECTIVE';\n\nconst Crosshair: FunctionComponent<{ size: InGameDistance }> = ({ size = 4 }) => {\n\tconst lines: CoordinateArray[][] = [\n\t\t[\n\t\t\t// over the x axis\n\t\t\t[-1 * size, 0, 0],\n\t\t\t[size, 0, 0]\n\t\t],\n\t\t[\n\t\t\t// over the y axis\n\t\t\t[0, -1 * size, 0],\n\t\t\t[0, size, 0]\n\t\t],\n\t\t[\n\t\t\t// over the z axis\n\t\t\t[0, 0, -1 * size],\n\t\t\t[0, 0, size]\n\t\t]\n\t];\n\n\treturn (\n\t\t<>\n\t\t\t{lines.map((points, i) => (\n\t\t\t\t<LinePath key={i} path={points} stroke={'rgba(0,0,0)'} strokeWidth={0.5} />\n\t\t\t))}\n\t\t</>\n\t);\n};\n\nexport const Anchor: FunctionComponent<\n\tSvgMouseInteractionProps & {\n\t\tcrosshairSize?: InGameDistance;\n\t} & Partial<CoordinateLike>\n> = ({ x = 0, y = 0, z = 0, children, crosshairSize = 0 }) => {\n\tconst pixels = useMemo(() => PERSPECTIVE.toPixels(x, y, z), [x, y, z]);\n\n\treturn (\n\t\t<svg x={pixels[0]} y={pixels[1]} overflow={'visible'}>\n\t\t\t{crosshairSize ? <Crosshair size={crosshairSize} /> : null}\n\t\t\t{children}\n\t\t</svg>\n\t);\n};\n\nexport const MovingAnchor: FunctionComponent<\n\tSvgMouseInteractionProps & {\n\t\tmoveTo: CoordinateLike;\n\t\tmoveSpeed: number;\n\t\tonRest?: () => void;\n\t\tcrosshairSize?: InGameDistance;\n\t}\n> = ({ moveTo, moveSpeed, onRest, children, crosshairSize = 0, onClick }) => {\n\tconst [dx, dy] = useMemo(() => PERSPECTIVE.toPixels(moveTo.x, moveTo.y, moveTo.z), [moveTo]);\n\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\tconst [ix, iy] = useMemo(() => [dx, dy], []);\n\n\t// if (isNaN(dx) || isNaN(dy)) {\n\t// \tdebugger;\n\t// }\n\tconst loc = useSpring({\n\t\tto: {\n\t\t\tx: dx,\n\t\t\ty: dy\n\t\t},\n\t\tconfig: {\n\t\t\tduration: moveSpeed\n\t\t},\n\t\tfrom: {\n\t\t\tx: ix,\n\t\t\ty: iy\n\t\t},\n\t\tonRest\n\t});\n\n\t// @TODO reuse <Anchor>\n\treturn (\n\t\t<animated.svg x={loc.x} y={loc.y} overflow={'visible'} onClick={onClick}>\n\t\t\t{crosshairSize ? <Crosshair size={crosshairSize} /> : null}\n\t\t\t{children}\n\t\t</animated.svg>\n\t);\n};\n","export default __webpack_public_path__ + \"static/media/nebula-282c34.dda754f6.png\";","import { css } from '@emotion/react';\nimport Color from 'color';\nimport nebulaTexture from './textures/nebula-282c34.png';\n\nexport const color: Record<string, Color> = {};\ncolor.white = Color('#fff');\ncolor.terrain = Color('#282c34');\ncolor.highlightedTerrain = color.terrain.lighten(1);\n\nconst styles = css`\n\t:root {\n\t\t/*\n\t\t\tTerrain with nothing special about it:\n\t\t*/\n\t\t--color-terrain-normal-fill: ${color.terrain.toString()};\n\t\t--color-terrain-highlight-outer-stroke: ${color.terrain\n\t\t\t.darken(0.3)\n\t\t\t.saturate(0.3)\n\t\t\t.toString()};\n\t\t--color-terrain-highlight-inner-stroke: ${color.terrain\n\t\t\t.lighten(0.4)\n\t\t\t.desaturate(0.8)\n\t\t\t.toString()};\n\n\t\t/*\n\t\t\tTerrain that is being hovered over with the mouse\n\t\t*/\n\t\t--color-terrain-highlight-fill: ${color.terrain.lighten(1).toString()};\n\t\t--color-terrain-highlight-outer-stroke: ${Color('#fff').toString()};\n\t\t--color-terrain-highlight-inner-stroke: ${color.terrain.mix(color.white, 0.3).toString()};\n\t}\n\n\tbody {\n\t\tbackground: #282c34 url(${nebulaTexture});\n\t}\n\n\tp {\n\t\tmargin: 0;\n\t}\n`;\n\nexport default styles;\n","import Color from 'color';\nimport React, { FunctionComponent } from 'react';\nimport { CoordinateArray } from '../classes/Coordinate';\nimport { color } from '../styles';\nimport { SvgMouseInteractionProps } from '../types';\nimport { InGameDistance, PERSPECTIVE } from './PERSPECTIVE';\n\nconst BORDER_WIDTH = 0;\n\nfunction coordsToPixels(coords: CoordinateArray[], borderWidth = BORDER_WIDTH) {\n\treturn coords\n\t\t.map(coordinate => PERSPECTIVE.toPixels(...coordinate))\n\t\t.map(cc => cc.map(c => c + borderWidth));\n}\n\nconst COORDINATE_CLOSEST_TO_CAMERA = PERSPECTIVE.toPixels(1, 0, 1).map(c => c + BORDER_WIDTH);\n\nlet BORDER_NODES = coordsToPixels([\n\t[1, 1, 0], // 0\n\t[1, 1, 1],\n\t[0, 1, 1], // 2\n\t[0, 0, 1],\n\t[0, 0, 0], // 4\n\t[1, 0, 0]\n]);\n\n// facing to the bottom left, aka -y\nlet XZ_NODES = coordsToPixels([\n\t[0, 0, 0],\n\t[0, 0, 1],\n\t[1, 0, 1],\n\t[1, 0, 0]\n]);\n\n// facing to the bottom right, aka +x\nlet YZ_NODES = coordsToPixels([\n\t[1, 0, 0],\n\t[1, 1, 0],\n\t[1, 1, 1],\n\t[1, 0, 1]\n]);\n\n// facing top, aka +z\nlet XY_NODES = coordsToPixels([\n\t[0, 0, 1],\n\t[1, 0, 1],\n\t[1, 1, 1],\n\t[0, 1, 1]\n]);\n\nexport const MonochromeBox: FunctionComponent<\n\tSvgMouseInteractionProps & {\n\t\tsize?: number;\n\t\tstrokeLinecap?: 'round' | 'butt' | 'square' | 'inherit' | undefined;\n\t\tfill?: Color;\n\t\tstroke?: Color;\n\t\tstrokeWidth?: InGameDistance;\n\t\tinnerStrokeWidth?: InGameDistance;\n\t\tinnerStroke?: Color;\n\t}\n> = ({\n\tsize = 1,\n\tfill = color.terrain,\n\tstrokeLinecap = 'round',\n\tstroke = fill.darken(0.3).saturate(0.3),\n\tstrokeWidth = 1,\n\tinnerStroke = fill.lighten(0.4).desaturate(0.8),\n\tinnerStrokeWidth = strokeWidth,\n\t...gProps\n}) => {\n\tconst innerStrokeCss = innerStroke && innerStroke.string();\n\tconst strokeCss = stroke && stroke.string();\n\n\tconst style: Record<string, string> = {};\n\tif (gProps.onClick || gProps.onContextMenu) {\n\t\tstyle.cursor = 'pointer';\n\t}\n\n\treturn (\n\t\t<g {...gProps} style={style}>\n\t\t\t{fill && (\n\t\t\t\t<>\n\t\t\t\t\t<polygon\n\t\t\t\t\t\tkey={'xz'}\n\t\t\t\t\t\tpoints={XZ_NODES.map(c => c.map(cc => cc * size).join(',')).join(' ')}\n\t\t\t\t\t\tfill={fill.string()}\n\t\t\t\t\t\tstrokeWidth={0}\n\t\t\t\t\t/>\n\t\t\t\t\t<polygon\n\t\t\t\t\t\tkey={'xy'}\n\t\t\t\t\t\tpoints={XY_NODES.map(c => c.map(cc => cc * size).join(',')).join(' ')}\n\t\t\t\t\t\tfill={fill.lighten(0.2).string()}\n\t\t\t\t\t\tstrokeWidth={0}\n\t\t\t\t\t/>\n\t\t\t\t\t<polygon\n\t\t\t\t\t\tkey={'yz'}\n\t\t\t\t\t\tpoints={YZ_NODES.map(c => c.map(cc => cc * size).join(',')).join(' ')}\n\t\t\t\t\t\tfill={fill.darken(0.2).string()}\n\t\t\t\t\t\tstrokeWidth={0}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{innerStroke && (\n\t\t\t\t<>\n\t\t\t\t\t<line\n\t\t\t\t\t\tkey={'x-bar'}\n\t\t\t\t\t\tx1={COORDINATE_CLOSEST_TO_CAMERA[0] * size}\n\t\t\t\t\t\ty1={COORDINATE_CLOSEST_TO_CAMERA[1] * size}\n\t\t\t\t\t\tx2={BORDER_NODES[3][0] * size}\n\t\t\t\t\t\ty2={BORDER_NODES[3][1] * size}\n\t\t\t\t\t\tstroke={innerStrokeCss}\n\t\t\t\t\t\tstrokeWidth={innerStrokeWidth}\n\t\t\t\t\t\tstrokeLinecap={strokeLinecap}\n\t\t\t\t\t/>\n\t\t\t\t\t<line\n\t\t\t\t\t\tkey={'y-bar'}\n\t\t\t\t\t\tx1={COORDINATE_CLOSEST_TO_CAMERA[0] * size}\n\t\t\t\t\t\ty1={COORDINATE_CLOSEST_TO_CAMERA[1] * size}\n\t\t\t\t\t\tx2={BORDER_NODES[1][0] * size}\n\t\t\t\t\t\ty2={BORDER_NODES[1][1] * size}\n\t\t\t\t\t\tstroke={innerStrokeCss}\n\t\t\t\t\t\tstrokeWidth={innerStrokeWidth}\n\t\t\t\t\t\tstrokeLinecap={strokeLinecap}\n\t\t\t\t\t/>\n\t\t\t\t\t<line\n\t\t\t\t\t\tkey={'z-bar'}\n\t\t\t\t\t\tx1={COORDINATE_CLOSEST_TO_CAMERA[0] * size}\n\t\t\t\t\t\ty1={COORDINATE_CLOSEST_TO_CAMERA[1] * size}\n\t\t\t\t\t\tx2={BORDER_NODES[5][0] * size}\n\t\t\t\t\t\ty2={BORDER_NODES[5][1] * size}\n\t\t\t\t\t\tstroke={innerStrokeCss}\n\t\t\t\t\t\tstrokeWidth={innerStrokeWidth}\n\t\t\t\t\t\tstrokeLinecap={strokeLinecap}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\n\t\t\t<polygon\n\t\t\t\tkey={'outline'}\n\t\t\t\tpoints={BORDER_NODES.map(c => c.map(cc => cc * size).join(',')).join(' ')}\n\t\t\t\tstroke={strokeCss}\n\t\t\t\tfill={'transparent'}\n\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\tstrokeLinecap={strokeLinecap}\n\t\t\t/>\n\t\t</g>\n\t);\n};\n","import styled from '@emotion/styled';\nimport React, { FunctionComponent, ReactElement, useMemo } from 'react';\nimport { CoordinateLike } from '../classes/Coordinate';\nimport { InGameDistance, PERSPECTIVE } from './PERSPECTIVE';\n\n// The pythagoras distance (1/sqrt(2)) with a little tweaking for better looks\nconst PIXEL_FRIENDLY_PYTHAGORAS = 1 / Math.pow(2, 1 / 2); //0.8;\n\nfunction mathRoundMaybe(n: number) {\n\t// For debugging only. Adjust to taste.\n\n\treturn Math.round(n);\n\t// return n;\n}\n\n// Force the type to AnimatedComponent to avoid a weird TS inference bug\n//\nexport const AbsolutelyPositionedContainer = styled.div`\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\twidth: 0;\n\theight: 0;\n\ttransition: transform 5s;\n\t> * {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t}\n`;\n\ntype ViewportComponentProps = {\n\tzoom?: number;\n\tcenter?: CoordinateLike;\n\toverlay?: ReactElement;\n};\n\nexport const Viewport: FunctionComponent<ViewportComponentProps> = ({\n\toverlay,\n\tcenter = { x: 0, y: 0, z: 0 },\n\tzoom = 1,\n\tchildren\n}) => {\n\tconst [translateX, translateY] = useMemo(\n\t\t() =>\n\t\t\tPERSPECTIVE.toPixels(center.x, center.y, center.z).map(\n\t\t\t\t(n, i) => mathRoundMaybe(-n) + (i ? 0 : 0.5)\n\t\t\t),\n\t\t[center]\n\t);\n\n\tconst springStyles =\n\t\t//useSpring({\n\t\t// \tconfig: config.molasses,\n\t\t// \tto:\n\t\t{\n\t\t\ttransform: `translate(\n\t\t\t\t${translateX * zoom}px,\n\t\t\t\t${translateY * zoom}px\n\t\t\t)`\n\t\t};\n\t// });\n\n\treturn (\n\t\t<AbsolutelyPositionedContainer style={springStyles}>\n\t\t\t<ViewportSvgContainer zoom={zoom} children={children} />\n\t\t\t{overlay}\n\t\t</AbsolutelyPositionedContainer>\n\t);\n};\n\nexport const ViewportSvgContainer: FunctionComponent<\n\t{\n\t\tzoom?: number;\n\t} & React.SVGProps<SVGSVGElement>\n> = ({ zoom = 1, ...rest }) => (\n\t<svg\n\t\twidth=\"1px\"\n\t\theight=\"1px\"\n\t\toverflow=\"visible\"\n\t\tshapeRendering=\"geometricPrecision\"\n\t\tviewBox={[0, 0, 1 / zoom, 1 / zoom].join(' ')}\n\t\t{...rest}\n\t/>\n);\n\nconst NoAxis = styled.div<{ zoom?: number }>`\n\t--scale-val: ${({ zoom = 1 }) => zoom};\n\n\tposition: absolute;\n\ttransform-origin: top left;\n\ttransform: scale(var(--scale-val));\n`;\n\nconst YAxis = styled(NoAxis)`\n\ttransform: skewY(-${PERSPECTIVE.degrees}deg)\n\t\tscale(calc(${PIXEL_FRIENDLY_PYTHAGORAS} * var(--scale-val)), var(--scale-val));\n`;\n\nconst ZAxis = styled(NoAxis)`\n\ttransform: rotate(-${PERSPECTIVE.degrees}deg) skewX(${PERSPECTIVE.degrees}deg)\n\t\tscale(\n\t\t\tcalc(${Math.sqrt(PIXEL_FRIENDLY_PYTHAGORAS)} * var(--scale-val)),\n\t\t\tcalc(${PIXEL_FRIENDLY_PYTHAGORAS} * var(--scale-val))\n\t\t);\n`;\n\nconst XAxis = styled(NoAxis)`\n\ttransform: skewY(${PERSPECTIVE.degrees}deg)\n\t\tscale(calc(${PIXEL_FRIENDLY_PYTHAGORAS} * var(--scale-val)), var(--scale-val));\n`;\n\nexport const ViewportHtmlContainer: FunctionComponent<{\n\taxis?: 'x' | 'y' | 'z';\n\twidth: InGameDistance;\n\theight: InGameDistance;\n\tzoom?: number;\n\tlocation: CoordinateLike;\n}> = ({ location, zoom = 1, axis, width, height, children }) => {\n\tconst { x, y, z } = location,\n\t\t// @TODO use css variable to zoom instead of JS\n\t\t[left, top] = PERSPECTIVE.toPixels(x, y, z).map(n => mathRoundMaybe(n * zoom));\n\t// @TODO use css variable to zoom instead of JS\n\tconst [pixelWidth] = PERSPECTIVE.toPixels(0, width, height).map(n => mathRoundMaybe(n * zoom));\n\tconst Axis = axis === 'y' ? YAxis : axis === 'x' ? XAxis : axis === 'z' ? ZAxis : NoAxis;\n\treturn (\n\t\t<Axis\n\t\t\tzoom={zoom}\n\t\t\tstyle={{\n\t\t\t\tleft: mathRoundMaybe(left),\n\t\t\t\ttop: mathRoundMaybe(top),\n\t\t\t\twidth:\n\t\t\t\t\tmathRoundMaybe(axis ? pixelWidth / PIXEL_FRIENDLY_PYTHAGORAS : pixelWidth) +\n\t\t\t\t\t'px',\n\t\t\t\theight:\n\t\t\t\t\tMath.abs(\n\t\t\t\t\t\t(height * PERSPECTIVE.tileSize) /\n\t\t\t\t\t\t\t(axis === 'z' ? PIXEL_FRIENDLY_PYTHAGORAS : 1)\n\t\t\t\t\t) + 'px'\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</Axis>\n\t);\n};\n","import styled from '@emotion/styled';\n\nexport const Backdrop = styled.div<{ height?: number }>`\n\tposition: relative;\n\theight: ${({ height = 180 }) => `${height}px`};\n\tbackground-image: linear-gradient(\n\t\t45deg,\n\t\trgba(255, 255, 255, 0.02) 25%,\n\t\trgba(0, 0, 0, 0.02) 25%,\n\t\trgba(0, 0, 0, 0.02) 50%,\n\t\trgba(255, 255, 255, 0.02) 50%,\n\t\trgba(255, 255, 255, 0.02) 75%,\n\t\trgba(0, 0, 0, 0.02) 75%,\n\t\trgba(0, 0, 0, 0.02) 100%\n\t);\n\tbackground-size: 56.57px 56.57px;\n\tmargin-bottom: 1em;\n`;\n","import Color from 'color';\nimport { FunctionComponent } from 'react';\nimport { Anchor } from '../space/Anchor';\nimport { MonochromeBox } from '../space/MonochromeBox';\nimport { Viewport } from '../space/Viewport';\nimport { Backdrop } from './scaffolding';\n\nconst Demo: FunctionComponent = () => (\n\t<>\n\t\t<Backdrop>\n\t\t\t<Viewport zoom={1} center={{ x: 0.5, y: 0.5, z: 0.5 }}>\n\t\t\t\t<Anchor x={-2} y={-2} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={0} y={0} z={0}>\n\t\t\t\t\t<MonochromeBox innerStroke={Color('#630a0a7d')} fill={Color('#960202')} />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={2} y={2} z={0}>\n\t\t\t\t\t<MonochromeBox\n\t\t\t\t\t\tfill={Color('#ffffff7f')}\n\t\t\t\t\t\tonClick={() => window.alert('Clicky click!')}\n\t\t\t\t\t/>\n\t\t\t\t</Anchor>\n\t\t\t</Viewport>\n\t\t</Backdrop>\n\t\t<Backdrop>\n\t\t\t<Viewport center={{ x: 1, y: 0, z: 0.5 }}>\n\t\t\t\t<Anchor x={0} y={0} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={1} y={0} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={2} y={0} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={2} y={-1} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t</Viewport>\n\t\t</Backdrop>\n\t</>\n);\n\nexport default Demo;\n","type BinaryHeapScorer<P> = (node: P) => number;\n\nexport class BinaryHeap<P> {\n\tscoreFunction: BinaryHeapScorer<P>;\n\tcontent: P[] = [];\n\tconstructor(scoreFunction: BinaryHeapScorer<P>) {\n\t\tthis.content = [];\n\t\tthis.scoreFunction = scoreFunction;\n\t}\n\tpush(element: P) {\n\t\t// Add the new element to the end of the array.\n\t\tthis.content.push(element);\n\n\t\t// Allow it to sink down.\n\t\tthis.sinkDown(this.content.length - 1);\n\t}\n\tpop() {\n\t\t// Store the first element so we can return it later.\n\t\tconst result = this.content[0];\n\n\t\t// Get the element at the end of the array.\n\t\tconst end = this.content.pop();\n\t\tif (!end) {\n\t\t\treturn result;\n\t\t}\n\n\t\t// If there are any elements left, put the end element at the\n\t\t// start, and let it bubble up.\n\t\tif (this.content.length > 0) {\n\t\t\tthis.content[0] = end;\n\t\t\tthis.bubbleUp(0);\n\t\t}\n\t\treturn result;\n\t}\n\tremove(node: P) {\n\t\tconst i = this.content.indexOf(node);\n\n\t\t// When it is found, the process seen in 'pop' is repeated\n\t\t// to fill up the hole.\n\t\tconst end = this.content.pop();\n\t\tif (!end) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (i !== this.content.length - 1) {\n\t\t\tthis.content[i] = end;\n\n\t\t\tif (this.scoreFunction(end) < this.scoreFunction(node)) {\n\t\t\t\tthis.sinkDown(i);\n\t\t\t} else {\n\t\t\t\tthis.bubbleUp(i);\n\t\t\t}\n\t\t}\n\t}\n\tsize() {\n\t\treturn this.content.length;\n\t}\n\trescoreElement(node: P) {\n\t\tthis.sinkDown(this.content.indexOf(node));\n\t}\n\tsinkDown(n: number) {\n\t\t// Fetch the element that has to be sunk.\n\t\tconst element = this.content[n];\n\n\t\t// When at 0, an element can not sink any further.\n\t\twhile (n > 0) {\n\t\t\t// Compute the parent element's index, and fetch it.\n\t\t\tconst parentN = ((n + 1) >> 1) - 1;\n\t\t\tconst parent = this.content[parentN];\n\t\t\t// Swap the elements if the parent is greater.\n\t\t\tif (this.scoreFunction(element) < this.scoreFunction(parent)) {\n\t\t\t\tthis.content[parentN] = element;\n\t\t\t\tthis.content[n] = parent;\n\t\t\t\t// Update 'n' to continue at the new position.\n\t\t\t\tn = parentN;\n\t\t\t}\n\t\t\t// Found a parent that is less, no need to sink any further.\n\t\t\telse {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tbubbleUp(n: number) {\n\t\t// Look up the target element and its score.\n\t\tconst length = this.content.length;\n\t\tconst element = this.content[n];\n\t\tconst elemScore = this.scoreFunction(element);\n\n\t\twhile (true) {\n\t\t\t// Compute the indices of the child elements.\n\t\t\tconst child2N = (n + 1) << 1;\n\t\t\tconst child1N = child2N - 1;\n\t\t\t// This is used to store the new position of the element, if any.\n\t\t\tlet swap = null;\n\t\t\tlet child1Score;\n\t\t\t// If the first child exists (is inside the array)...\n\t\t\tif (child1N < length) {\n\t\t\t\t// Look it up and compute its score.\n\t\t\t\tconst child1 = this.content[child1N];\n\t\t\t\tchild1Score = this.scoreFunction(child1);\n\n\t\t\t\t// If the score is less than our element's, we need to swap.\n\t\t\t\tif (child1Score < elemScore) {\n\t\t\t\t\tswap = child1N;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Do the same checks for the other child.\n\t\t\tif (child2N < length) {\n\t\t\t\tconst child2 = this.content[child2N];\n\t\t\t\tconst child2Score = this.scoreFunction(child2);\n\t\t\t\t// child1Score is number or undefined. To satisfy TS (for the original code) it is coerced to number,\n\t\t\t\t// but I'm not sure why it wouldn't stay undefined, really.\n\t\t\t\tif (child2Score < (swap === null ? elemScore : (child1Score as number))) {\n\t\t\t\t\tswap = child2N;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// If the element needs to be moved, swap it, and continue.\n\t\t\tif (swap !== null) {\n\t\t\t\tthis.content[n] = this.content[swap];\n\t\t\t\tthis.content[swap] = element;\n\t\t\t\tn = swap;\n\t\t\t}\n\t\t\t// Otherwise, we are done.\n\t\t\telse {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n}\n","// An adaptation of:\n//   javascript-astar 0.4.1\n//   http://github.com/bgrins/javascript-astar\n//   Freely distributable under the MIT License.\n//   Implements the astar search algorithm in javascript using a Binary Heap.\n//   Includes Binary Heap (with modifications) from Marijn Haverbeke.\n//   http://eloquentjavascript.net/appendix2.html\n\nimport { BinaryHeap } from '../util/BinaryHeap';\nimport { GenericTerrain, GenericTile } from '../terrain/GenericTerrain';\n\n// See list of heuristics: http://theory.stanford.edu/~amitp/GameProgramming/Heuristics.html\ntype HeuristicScorer = (a: GenericTile, b: GenericTile) => number;\n\n/**\n * Perform an A* Search on a graph given a start and end node.\n */\n\ntype HeuristicReport = {\n\tcoordinate: GenericTile;\n\th: number;\n\tg: number;\n\tf: number;\n\tparent: HeuristicReport | null;\n\tclosed: Boolean;\n\tvisited: boolean;\n};\n\ntype PathOptions = {\n\tclosest: Boolean;\n\theuristic?: HeuristicScorer;\n};\n\nconst MANHATTAN: HeuristicScorer = (pos0, pos1) => {\n\tconst d1 = Math.abs(pos1.x - pos0.x);\n\tconst d2 = Math.abs(pos1.y - pos0.y);\n\treturn d1 + d2;\n};\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst DIAGONAL: HeuristicScorer = (pos0, pos1) => {\n\tconst D = 1;\n\tconst D2 = Math.sqrt(2);\n\tconst d1 = Math.abs(pos1.x - pos0.x);\n\tconst d2 = Math.abs(pos1.y - pos0.y);\n\treturn D * (d1 + d2) + (D2 - 2 * D) * Math.min(d1, d2);\n};\n\nfunction getVisitationCost(\n\tterrain: GenericTerrain<GenericTile>,\n\tfrom: GenericTile,\n\tneighbor: GenericTile\n) {\n\treturn 1;\n}\n\nexport class Path {\n\tprivate readonly terrain: GenericTerrain<GenericTile>;\n\tprivate readonly options: PathOptions;\n\tprivate readonly cache: Map<GenericTile, HeuristicReport>;\n\tprivate readonly heap: BinaryHeap<GenericTile>;\n\tprivate readonly heuristic: HeuristicScorer;\n\n\tconstructor(graph: GenericTerrain<GenericTile>, options: PathOptions) {\n\t\tthis.terrain = graph;\n\t\tthis.options = options;\n\n\t\tthis.cache = new Map<GenericTile, HeuristicReport>();\n\n\t\tthis.heap = new BinaryHeap<GenericTile>(node => {\n\t\t\tconst heuristic = this.cache.get(node);\n\t\t\tif (!heuristic) {\n\t\t\t\tthrow new Error('This is weird');\n\t\t\t}\n\t\t\treturn heuristic.f;\n\t\t});\n\n\t\tthis.heuristic = MANHATTAN;\n\t}\n\n\tfind(start: GenericTile, end: GenericTile) {\n\t\tlet closestNode = start; // set the start node to be the closest if required\n\t\tlet closestNodeHeuristics: HeuristicReport = {\n\t\t\tcoordinate: closestNode,\n\t\t\th: this.heuristic(start, end),\n\t\t\tg: 0,\n\t\t\tf: 0,\n\n\t\t\tparent: null,\n\n\t\t\t// Unsure what the default value should be\n\t\t\tclosed: true,\n\t\t\tvisited: true\n\t\t};\n\n\t\t// At this stage `start` is also `closestNode`, so lets associate those heuristics\n\t\tthis.cache.set(start, closestNodeHeuristics);\n\n\t\tthis.heap.push(start);\n\n\t\twhile (this.heap.size() > 0) {\n\t\t\t// Grab the lowest f(x) to process next.  Heap keeps this sorted for us.\n\t\t\tconst currentNode = this.heap.pop();\n\t\t\tconst currentNodeHeuristics = this.cache.get(currentNode);\n\t\t\tif (!currentNodeHeuristics) {\n\t\t\t\tthrow new Error('Somehow opening a node that has no heuristic data');\n\t\t\t}\n\n\t\t\t// End case -- result has been found, return the traced path.\n\t\t\tif (currentNode.equals(end)) {\n\t\t\t\treturn this.tracePath(currentNodeHeuristics);\n\t\t\t}\n\n\t\t\t// Normal case -- move currentNode from open to closed, process each of its neighbors.\n\t\t\tcurrentNodeHeuristics.closed = true;\n\n\t\t\t// Find all neighbors for the current node.\n\t\t\tconst neighbors = this.terrain.getNeighborTiles(currentNode);\n\n\t\t\tfor (let i = 0, il = neighbors.length; i < il; ++i) {\n\t\t\t\tconst neighbor = neighbors[i];\n\t\t\t\tlet neighborHeuristics = this.cache.get(neighbor);\n\n\t\t\t\tif (neighborHeuristics?.closed || !neighbor.isLand()) {\n\t\t\t\t\t// Not a valid node to process, skip to next neighbor.\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// The g score is the shortest distance from start to current node.\n\t\t\t\t// We need to check if the path we have arrived at this neighbor is the shortest one we have seen yet.\n\t\t\t\tconst gScore =\n\t\t\t\t\tcurrentNodeHeuristics.g +\n\t\t\t\t\tgetVisitationCost(this.terrain, currentNode, neighbor);\n\t\t\t\tconst beenVisited = !!neighborHeuristics;\n\n\t\t\t\tif (!beenVisited || (neighborHeuristics && gScore < neighborHeuristics.g)) {\n\t\t\t\t\tconst hScore = this.heuristic(neighbor, end);\n\t\t\t\t\t// Found an optimal (so far) path to this node.  Take score for node to see how good it is.\n\t\t\t\t\tneighborHeuristics = {\n\t\t\t\t\t\tcoordinate: neighbor,\n\t\t\t\t\t\th: hScore,\n\t\t\t\t\t\tg: gScore,\n\t\t\t\t\t\tf: gScore + hScore,\n\t\t\t\t\t\tparent: currentNodeHeuristics,\n\t\t\t\t\t\tclosed: true,\n\t\t\t\t\t\tvisited: true\n\t\t\t\t\t};\n\t\t\t\t\tthis.cache.set(neighbor, neighborHeuristics as HeuristicReport);\n\n\t\t\t\t\tif (this.options.closest) {\n\t\t\t\t\t\t// If the neighbour is closer than the current closestNode or if it's equally close but has\n\t\t\t\t\t\t// a cheaper path than the current closest node then it becomes the closest node\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tneighborHeuristics.h < closestNodeHeuristics.h ||\n\t\t\t\t\t\t\t(neighborHeuristics.h === closestNodeHeuristics.h &&\n\t\t\t\t\t\t\t\tneighborHeuristics.g < closestNodeHeuristics.g)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tclosestNode = neighbor;\n\t\t\t\t\t\t\tclosestNodeHeuristics = neighborHeuristics;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!beenVisited) {\n\t\t\t\t\t\t// Pushing to heap will put it in proper place based on the 'f' value.\n\t\t\t\t\t\tthis.heap.push(neighbor);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// Already seen the node, but since it has been rescored we need to reorder it in the heap\n\t\t\t\t\t\tthis.heap.rescoreElement(neighbor);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.options.closest) {\n\t\t\treturn this.tracePath(closestNodeHeuristics);\n\t\t}\n\n\t\t// No result was found - empty array signifies failure to find path.\n\t\tconsole.warn('-- No path --');\n\t\treturn [];\n\t}\n\n\ttracePath(heuristicReport: HeuristicReport) {\n\t\tlet curr = heuristicReport;\n\t\tconst path = [];\n\t\twhile (curr.parent) {\n\t\t\tpath.unshift(curr);\n\t\t\tcurr = curr.parent;\n\t\t}\n\t\treturn path.map(heuristicReport => heuristicReport.coordinate);\n\t}\n}\n","const FIRST_NAMES_M = `\n\tPaul, Paolo, Pablo, Pavel, Pasha, Pau, Paulo, Pol, Pavlo, Paavo, Pali, Pal, Paulin, Pava, Pvel, Paulino, Pawel,\n\tPaavali, Pauel, Pavlos, Pavlusha, Poul, Pusha, Pashenka, Pavlk, Poll, Pl, Pavlousek, Pawelek, Pl, Pavilcek, Pl\n`\n\t.replace(/\\t|\\n/g, '')\n\t.split(',')\n\t.map(name => name.trim());\n\nconst FIRST_NAMES_F = `\n\tMia, Mare, Miriam, Mary, Mara, Molly, Maren, Mariah, Marisol, Maria, Moira, Polly, Marie, Mariana, Marilyn, Malia,\n\tMari, Manon, Marissa, Mariam, Marion, Ria, Mariella, Milou, Mitzi, Marielle, Maribel, Maura, Mamie, Maureen, Mariel,\n\tMarisa, Maryam, Mairi, Malou, Marietta, Maija, Maire, Maritza, Maricela, Marya, Marika, Isamar, My, Mariska, Maryse,\n\tMariela, Maira, Marita, Mariette,\n`\n\t.replace(/\\t|\\n/g, '')\n\t.split(',')\n\t.map(name => name.trim());\n\nexport function getRandomMaleFirstName() {\n\treturn FIRST_NAMES_M[Math.floor(Math.random() * FIRST_NAMES_M.length)];\n}\nexport function getRandomFemaleFirstName() {\n\treturn FIRST_NAMES_F[Math.floor(Math.random() * FIRST_NAMES_F.length)];\n}\n\nexport function getRandomFullName() {}\n","import { DependencyList, useCallback, useEffect } from 'react';\n\ntype EventHandler<EventData extends Array<unknown>> = (...args: EventData) => void;\ntype EventDestroyer = () => void;\n\n/**\n *  Consitutes one named event type\n */\nexport class Event<EventData extends Array<unknown> = []> {\n\tprivate listeners: EventHandler<EventData>[] = [];\n\n\ton(callback: EventHandler<EventData>) {\n\t\tthis.listeners.push(callback);\n\n\t\treturn () => {\n\t\t\tthis.listeners.splice(this.listeners.indexOf(callback));\n\t\t};\n\t}\n\n\temit(...args: EventData) {\n\t\tthis.listeners.forEach(callback => callback(...args));\n\t}\n\n\tclear() {\n\t\tthis.listeners = [];\n\t}\n}\n\n/**\n * A conventience wrapper for `useEffect` specifically for listening to a list of events, and unlistening when the\n * component is unmounted.\n *\n * For example:\n *\n *   useEventListeners(() => [\n *       entity.moveStart.on(coordinate => animatePosition(coordinate)),\n *       entity.moveRest.on(coordinate => console.log('Done'))\n *   ], [entity.moveStart, entity.moveRest]);\n */\nexport const useEventListeners = (callback: () => EventDestroyer[], deps: DependencyList = []) => {\n\tconst cb = useCallback(\n\t\t() => {\n\t\t\tconst eventDestroyers = callback();\n\t\t\treturn () => eventDestroyers.forEach(d => d());\n\t\t},\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\tdeps\n\t);\n\treturn useEffect(cb, [cb]);\n};\n","import { FunctionComponent } from 'react';\nimport { GenericTile } from '../terrain/GenericTerrain';\nimport { Job } from '../jobs/Job';\nconst noop = () => {};\n\nexport class Entity {\n\tpublic readonly id: string;\n\n\t/**\n\t * The React SVG component that consitutes this entity. Is expected to be defined in a class\n\t * that extends `Entity`.\n\t */\n\tpublic readonly Component: FunctionComponent = () => {\n\t\treturn null;\n\t};\n\n\tpublic location: GenericTile;\n\n\t/**\n\t * The set of behaviour/tasks given to this entity.\n\t */\n\tpublic job?: Job;\n\n\tconstructor(id: string, location: GenericTile) {\n\t\tthis.id = id;\n\t\tthis.location = location;\n\t}\n\n\tpublic get label(): string {\n\t\tthrow new Error(`${this.constructor.name} ${this.id}`);\n\t}\n\n\tpublic play() {\n\t\treturn this.job?.start() || noop;\n\t}\n\n\tpublic doJob(job: Job) {\n\t\tthis.job = job;\n\n\t\t// @TODO maybe some events\n\t}\n}\n","import { FunctionComponent, useCallback, useState } from 'react';\nimport { Path } from '../classes/Path';\nimport { GenericTile } from '../terrain/GenericTerrain';\nimport { getRandomFemaleFirstName, getRandomMaleFirstName } from '../constants/names';\nimport { MovingAnchor } from '../space/Anchor';\nimport { Event, useEventListeners } from '../util/Event';\nimport { Entity } from './Entity';\n\ntype OnEntityClick = (event: React.MouseEvent<SVGElement, MouseEvent>) => void;\n\nexport class PersonEntity extends Entity {\n\t// The event that the person starts walking a path\n\tpublic readonly pathStart = new Event<[]>();\n\n\t// The event that the person finishes a path, according to react-spring's timing\n\tpublic readonly pathEnd = new Event<[]>();\n\n\t// The person started one step\n\tpublic readonly pathStepStart = new Event<[GenericTile]>();\n\n\t// The person started finished one step, according to react-spring's timing\n\tpublic readonly pathStepEnd = new Event<[GenericTile]>();\n\n\tpublic readonly passport: { firstName: string };\n\n\tconstructor(id: string, location: GenericTile) {\n\t\tsuper(id, location);\n\n\t\t// Movement handling\n\t\tthis.pathStepEnd.on(loc => {\n\t\t\tthis.location = loc;\n\t\t});\n\n\t\tconst feminine = Math.random() < 0.5;\n\t\tthis.passport = {\n\t\t\tfirstName: feminine ? getRandomFemaleFirstName() : getRandomMaleFirstName()\n\t\t};\n\t}\n\n\t// Calculate a path and emit animations to walk it the whole way. `this.location` is updated in between each step\n\tpublic walkTo(destination: GenericTile) {\n\t\tif (!this.location.terrain) {\n\t\t\tthrow new Error(`Entity \"${this.id}\" is trying to path in a detached coordinate`);\n\t\t}\n\t\tconst path = new Path(this.location.terrain, { closest: true }).find(\n\t\t\tthis.location,\n\t\t\tdestination\n\t\t);\n\n\t\t// console.log(`${this.location}-->${destination}: ${path.length}`);\n\n\t\tif (!path.length) {\n\t\t\tconsole.warn('Path was zero steps long, finishing early.', this);\n\t\t\tthis.pathEnd.emit();\n\t\t\treturn;\n\t\t}\n\t\tlet unlisten = this.pathStepEnd.on(() => {\n\t\t\tconst nextStep = path.shift();\n\n\t\t\tif (!nextStep) {\n\t\t\t\tthis.pathEnd.emit();\n\t\t\t\tunlisten();\n\t\t\t} else {\n\t\t\t\tthis.doPathStep(nextStep);\n\t\t\t}\n\t\t});\n\n\t\tthis.doPathStep(path.shift() as GenericTile);\n\t}\n\t/**\n\t * Move entity directly to a coordinate. Does not consider accessibility or closeness.\n\t */\n\tpublic doPathStep(coordinate: GenericTile) {\n\t\tif (coordinate.hasNaN()) {\n\t\t\tdebugger;\n\t\t}\n\t\tthis.pathStepStart.emit(coordinate);\n\t}\n\n\tpublic get label(): string {\n\t\treturn this.passport.firstName;\n\t}\n\n\tComponent: FunctionComponent = () => {\n\t\treturn <circle cx={0} cy={0} r=\"5\" fill=\"white\" />;\n\t};\n}\n\n/**\n * A component that automatically transitions the entity component as per its move instructions\n */\nexport const PersonEntityComponent: FunctionComponent<{\n\tentity: PersonEntity;\n\tonClick?: OnEntityClick;\n}> = ({ entity, onClick }) => {\n\tconst [{ destination, duration }, animatePosition] = useState({\n\t\tdestination: entity.location,\n\t\tduration: 0\n\t});\n\n\tuseEventListeners(\n\t\t() => [\n\t\t\t// Listen for the entity moveStart order;\n\t\t\tentity.pathStepStart.on(destination =>\n\t\t\t\tanimatePosition({\n\t\t\t\t\tdestination: destination,\n\t\t\t\t\tduration: entity.location.euclideanDistanceTo(destination) * 500\n\t\t\t\t})\n\t\t\t)\n\t\t],\n\t\t[entity.pathStepStart]\n\t);\n\n\tconst onRest = useCallback(() => entity.pathStepEnd.emit(destination), [\n\t\tentity.pathStepEnd,\n\t\tdestination\n\t]);\n\n\treturn (\n\t\t<MovingAnchor moveTo={destination} moveSpeed={duration} onRest={onRest} onClick={onClick}>\n\t\t\t<entity.Component />\n\t\t</MovingAnchor>\n\t);\n};\n","import { PersonEntity } from './PersonEntity';\n\nexport class CivilianEntity extends PersonEntity {\n\tget label(): string {\n\t\treturn `${this.passport.firstName}`;\n\t}\n}\n","import { InGameDistance } from '../space/PERSPECTIVE';\nexport interface CoordinateLike {\n\tx: InGameDistance;\n\ty: InGameDistance;\n\tz: InGameDistance;\n}\n\nexport type CoordinateArray = [InGameDistance, InGameDistance, InGameDistance];\n\nexport class Coordinate implements CoordinateLike {\n\tx: InGameDistance;\n\ty: InGameDistance;\n\tz: InGameDistance;\n\n\tconstructor(x: InGameDistance, y: InGameDistance, z: InGameDistance) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t}\n\n\tequals(coord: CoordinateLike) {\n\t\treturn (\n\t\t\tthis === coord ||\n\t\t\t(coord && this.x === coord.x && this.y === coord.y && this.z === coord.z)\n\t\t);\n\t}\n\n\ttransform(dx: InGameDistance = 0, dy: InGameDistance = 0, dz: InGameDistance = 0) {\n\t\tthis.x += dx;\n\t\tthis.y += dy;\n\t\tthis.z += dz;\n\n\t\treturn this;\n\t}\n\n\thasNaN() {\n\t\treturn isNaN(this.x) || isNaN(this.y) || isNaN(this.z);\n\t}\n\n\tmanhattanDistanceTo(coord: CoordinateLike) {\n\t\treturn Math.abs(this.x - coord.x) + Math.abs(this.y - coord.y) + Math.abs(this.z - coord.z);\n\t}\n\n\teuclideanDistanceTo(coord: CoordinateLike) {\n\t\tconst xy = Math.sqrt((this.x - coord.x) ** 2 + (this.y - coord.y) ** 2);\n\t\tconst xyz = Math.sqrt(xy ** 2 + (this.z - coord.z) ** 2);\n\t\treturn xyz;\n\t}\n\n\t// For debugging purposes only, may change without notice or tests\n\ttoString() {\n\t\treturn [this.x, this.y, this.z].join(',');\n\t}\n\n\tstatic clone(coord: CoordinateLike) {\n\t\treturn new Coordinate(coord.x, coord.y, coord.z);\n\t}\n}\n","import Color from 'color';\nimport React, { FunctionComponent } from 'react';\nimport { Coordinate } from '../classes/Coordinate';\nimport { Anchor } from '../space/Anchor';\nimport { MonochromeBox } from '../space/MonochromeBox';\nimport { PersonEntity } from './PersonEntity';\n\nconst zoom = 0.25;\nconst translate = zoom / 2;\nconst offset = new Coordinate(-translate, -translate, -translate / 2);\n\nexport class GuardEntity extends PersonEntity {\n\tpublic get label(): string {\n\t\treturn `Guardsman ${this.passport.firstName}`;\n\t}\n\n\tComponent: FunctionComponent = () => {\n\t\treturn (\n\t\t\t<Anchor {...offset}>\n\t\t\t\t<MonochromeBox\n\t\t\t\t\tsize={zoom}\n\t\t\t\t\tfill={Color('#227d5e')}\n\t\t\t\t\tstroke={Color('#227d5e').mix(Color('#000'), 0.3)}\n\t\t\t\t\tinnerStroke={Color('#227d5e').mix(Color('#fff'), 0.3)}\n\t\t\t\t/>\n\t\t\t</Anchor>\n\t\t);\n\t};\n}\n","import seedrandom from 'seedrandom';\n\ntype Seed = Array<string | number | boolean>;\n\nexport class Random {\n\tstatic float(...seed: Seed): number {\n\t\treturn seedrandom(seed.join('/')).double();\n\t}\n\tstatic arrayItem<P>(arr: P[], ...seed: Seed) {\n\t\tconst index = Math.floor(this.float(...seed) * arr.length);\n\t\treturn arr[index];\n\t}\n}\n","import { Entity } from '../entities/Entity';\n\nexport class Job<E = Entity> {\n\tentity: E;\n\tconstructor(entity: E) {\n\t\tthis.entity = entity;\n\t}\n\n\tget label(): string {\n\t\tthrow new Error(`Not implemented for ${this.constructor.name}`);\n\t}\n\n\tstart() {\n\t\tthrow new Error(`Not implemented for ${this.constructor.name}`);\n\t}\n}\n","import { PersonEntity } from '../entities/PersonEntity';\nimport { Random } from '../util/Random';\nimport { Job } from './Job';\n\nexport class LoiterJob extends Job<PersonEntity> {\n\t// The minimum and maximum amounts of ms before considering to move again, after having walked\n\tprivate walkMinWait = 2000;\n\tprivate walkMaxWait = 10000;\n\n\t// Every time that the entity might make a move, there's a good chance that they'll change their\n\t//   mind and lazy out instead.\n\tprivate walkChanceOnRoll = 0.3;\n\n\t// If the entity chooses to walk, its no more than this amount of times\n\tprivate walkMaxDistance = 7;\n\n\tget label() {\n\t\treturn `Loitering`;\n\t}\n\n\tstart() {\n\t\tlet steps = 0;\n\t\tconst doTimeout = () =>\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (Math.random() > this.walkChanceOnRoll) {\n\t\t\t\t\tdoTimeout();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tsteps++;\n\t\t\t\tconst destinations =\n\t\t\t\t\tthis.entity.location?.terrain?.selectClosestTiles(\n\t\t\t\t\t\tthis.entity.location,\n\t\t\t\t\t\tthis.walkMaxDistance\n\t\t\t\t\t) || [];\n\t\t\t\tthis.entity.walkTo(\n\t\t\t\t\tRandom.arrayItem(destinations, this.entity.id, 'roam-destination', steps)\n\t\t\t\t);\n\t\t\t}, this.walkMinWait + Random.float(this.entity.id, 'roam-delay', steps) * (this.walkMaxWait - this.walkMinWait));\n\n\t\tconst destroyers = [this.entity.pathEnd.on(doTimeout)];\n\n\t\tdoTimeout();\n\n\t\treturn () => destroyers.forEach(d => d());\n\t}\n}\n","import { GenericTile } from '../terrain/GenericTerrain';\nimport { PersonEntity } from '../entities/PersonEntity';\nimport { Job } from './Job';\n\nexport class PatrolJob extends Job<PersonEntity> {\n\twaypoints: GenericTile[];\n\twaypointIndex: number;\n\n\tconstructor(entity: PersonEntity, waypoints: GenericTile[]) {\n\t\tsuper(entity);\n\t\tif (waypoints.length < 2) {\n\t\t\tthrow new Error('A patrol must have at least 2 waypoints');\n\t\t}\n\t\tthis.waypoints = waypoints;\n\t\tthis.waypointIndex = 0;\n\t}\n\n\tget label() {\n\t\treturn `Patrolling between ${this.waypoints.length} waypoints`;\n\t}\n\n\tstart() {\n\t\tconst destroyers = [\n\t\t\tthis.entity.pathEnd.on(() => {\n\t\t\t\t// Guards move from one waypoint to another, pausing for a random amount of time in between\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.waypointIndex += 1;\n\t\t\t\t\tconst next = this.waypoints[this.waypointIndex % this.waypoints.length];\n\t\t\t\t\tthis.entity.walkTo(next);\n\t\t\t\t}, 3000);\n\t\t\t})\n\t\t];\n\n\t\tthis.entity.walkTo(this.waypoints[0]);\n\n\t\treturn () => {\n\t\t\tdestroyers.forEach(d => d());\n\t\t};\n\t}\n}\n","import { CivilianEntity } from '../entities/CivilianEntity';\nimport { GuardEntity } from '../entities/GuardEntity';\nimport { PersonEntity } from '../entities/PersonEntity';\nimport { LoiterJob } from '../jobs/LoiterJob';\nimport { PatrolJob } from '../jobs/PatrolJob';\nimport { GenericTerrain, GenericTile } from '../terrain/GenericTerrain';\nimport { Random } from '../util/Random';\n\nfunction repeat<P>(n: number, cb: (i: number) => P): P[] {\n\treturn Array.from(new Array(n)).map((_, i) => cb(i));\n}\n\nexport const RATIO_WATER_OF_TOTAL = 0.25;\n\nexport function generateTerrain(seed: string, size: number) {}\n\nfunction generatePatrolJob(seed: string, entity: PersonEntity) {\n\tconst start = entity.location;\n\tconst island = start.terrain?.getIslands().find(island => island.includes(start));\n\tif (!island) {\n\t\t// Expect to never throw this:\n\t\tthrow new Error('Got falsy start from none of the islands');\n\t}\n\n\treturn new PatrolJob(entity, [\n\t\t...repeat(2 + Math.floor(Random.float(entity.id, 'job', 'waypoint_amount') * 4), i =>\n\t\t\tRandom.arrayItem(island, entity.id, 'job', 'waypoint', i)\n\t\t),\n\t\tstart\n\t]);\n}\n\nexport function generateEntities<Y extends GenericTile, T extends GenericTerrain<Y>>(\n\tseed: string,\n\tterrain: T\n) {\n\tconst walkableTiles = terrain.tiles.filter(c => c.isLand());\n\t// const islands = terrain.getIslands();\n\n\tconst amountOfGuards = 0;\n\tconst amountOfCivilians = 10;\n\treturn [\n\t\t...repeat(amountOfGuards, i => {\n\t\t\tconst id = seed + '-guard-' + i;\n\t\t\tconst start = Random.arrayItem(walkableTiles, id, 'start');\n\t\t\tconst guard = new GuardEntity(id, start);\n\t\t\tconst job = generatePatrolJob(seed, guard);\n\t\t\tguard.doJob(job);\n\t\t\treturn guard;\n\t\t}),\n\t\t...repeat(amountOfCivilians, i => {\n\t\t\tconst id = seed + '-person-' + i;\n\t\t\tconst start = Random.arrayItem(walkableTiles, id, 'start');\n\t\t\tconst worker = new CivilianEntity(id, start);\n\t\t\tworker.doJob(new LoiterJob(worker));\n\t\t\treturn worker;\n\t\t})\n\t];\n}\n","/**\n * Adapted from\n *   https://github.com/hunterloftis/playfuljs-demos/blob/gh-pages/terrain/index.html#L118\n */\n\nimport { Random } from '../util/Random';\n\nexport const OUT_OF_BOUNDS = Symbol();\n\nfunction average(values: Array<number | typeof OUT_OF_BOUNDS>) {\n\tvar valid = values.filter((val): val is number => typeof val === 'number');\n\tvar total = valid.reduce<number>((sum, val) => sum + val, 0);\n\treturn total / valid.length;\n}\n\nexport class TerrainGenerator {\n\tprivate size: number;\n\tprivate max: number;\n\tprivate map: Float32Array;\n\tprivate seed;\n\n\tconstructor(seed: string, size: number) {\n\t\tthis.seed = seed;\n\t\tconst detail = Math.ceil(Math.log(size) / Math.log(2));\n\t\tthis.size = Math.pow(2, detail) + 1;\n\t\tthis.max = this.size - 1;\n\t\tthis.map = new Float32Array(this.size * this.size);\n\t}\n\n\tpublic generate(roughness: number) {\n\t\tthis.set(0, 0, this.max);\n\t\tthis.set(this.max, 0, this.max / 2);\n\t\tthis.set(this.max, this.max, 0);\n\t\tthis.set(0, this.max, this.max / 2);\n\n\t\tthis.divide(this.max, roughness);\n\t}\n\n\tpublic get(x: number, y: number) {\n\t\tif (x < 0 || x > this.max || y < 0 || y > this.max) {\n\t\t\treturn OUT_OF_BOUNDS;\n\t\t}\n\t\treturn this.map[x + this.size * y];\n\t}\n\n\tprivate set(x: number, y: number, val: number) {\n\t\tthis.map[x + this.size * y] = val;\n\t}\n\n\tprivate divide(size: number, roughness: number) {\n\t\tvar x,\n\t\t\ty,\n\t\t\thalf = size / 2;\n\t\tvar scale = roughness * size;\n\t\tif (half < 1) return;\n\n\t\tfor (y = half; y < this.max; y += size) {\n\t\t\tfor (x = half; x < this.max; x += size) {\n\t\t\t\tthis.square(\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\thalf,\n\t\t\t\t\tRandom.float(this.seed, size, 'square', x, y) * scale * 2 - scale\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tfor (y = 0; y <= this.max; y += half) {\n\t\t\tfor (x = (y + half) % size; x <= this.max; x += size) {\n\t\t\t\tthis.diamond(\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\thalf,\n\t\t\t\t\tRandom.float(this.seed, size, 'square', x, y) * scale * 2 - scale\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tthis.divide(size / 2, roughness);\n\t}\n\n\tprivate square(x: number, y: number, size: number, offset: number) {\n\t\tvar ave = average([\n\t\t\tthis.get(x - size, y - size), // upper left\n\t\t\tthis.get(x + size, y - size), // upper right\n\t\t\tthis.get(x + size, y + size), // lower right\n\t\t\tthis.get(x - size, y + size) // lower left\n\t\t]);\n\t\tthis.set(x, y, ave + offset);\n\t}\n\n\tprivate diamond(x: number, y: number, size: number, offset: number) {\n\t\tvar ave = average([\n\t\t\tthis.get(x, y - size), // top\n\t\t\tthis.get(x + size, y), // right\n\t\t\tthis.get(x, y + size), // bottom\n\t\t\tthis.get(x - size, y) // left\n\t\t]);\n\t\tthis.set(x, y, ave + offset);\n\t}\n}\n","import Color from 'color';\nimport React, { FunctionComponent } from 'react';\nimport { CoordinateArray } from '../classes/Coordinate';\nimport { color } from '../styles';\n\nimport { PERSPECTIVE } from './PERSPECTIVE';\n\nconst BORDER_WIDTH = 1;\nconst BORDER_NODES: CoordinateArray[] = [\n\t[1, 0, 0],\n\t[1, 1, 0],\n\t[0, 1, 0],\n\t[0, 0, 0]\n];\n\nlet spatialCoordinates = BORDER_NODES.map(coordinate =>\n\tPERSPECTIVE.toPixels(...coordinate)\n).map(cc => cc.map(c => c + BORDER_WIDTH));\n\nexport const MonochromeTile: FunctionComponent<\n\tOmit<React.SVGProps<SVGPolygonElement>, 'fill' | 'stroke'> & {\n\t\tzoom?: number;\n\t\tfill?: Color;\n\t\tstroke?: Color;\n\t}\n> = ({\n\tfill = color.terrain,\n\tstroke = fill.darken(0.3).saturate(0.3),\n\tstrokeWidth = BORDER_WIDTH,\n\tzoom = 1,\n\t...rest\n}) => {\n\treturn (\n\t\t<polygon\n\t\t\tpoints={spatialCoordinates.map(c => c.map(c => c * zoom).join(',')).join(' ')}\n\t\t\tstroke={stroke.string()}\n\t\t\tfill={fill.string()}\n\t\t\tstrokeWidth={strokeWidth}\n\t\t\t{...rest}\n\t\t/>\n\t);\n};\n","import { FunctionComponent, useState } from 'react';\nimport { Coordinate } from '../classes/Coordinate';\nimport { Anchor } from '../space/Anchor';\nimport { MonochromeBox } from '../space/MonochromeBox';\nimport { MonochromeTile } from '../space/MonochromeTile';\nimport { color } from '../styles';\nimport { SvgMouseInteractionProps } from '../types';\nimport { GenericTerrainComponentI, GenericTile } from './GenericTerrain';\n\n/**\n * A component that automatically transitions the entity component as per its move instructions\n */\nconst CubicTileComponent: FunctionComponent<\n\tSvgMouseInteractionProps & {\n\t\ttile: GenericTile;\n\t}\n> = ({ tile: terrainCoordinate, ...svgMouseInteractionProps }) => {\n\tconst [isHovered, setIsHovered] = useState(false);\n\tconst translated = Coordinate.clone(terrainCoordinate).transform(\n\t\t-0.5,\n\t\t-0.5,\n\t\tterrainCoordinate.z < 0 ? -terrainCoordinate.z - 0.5 : -1\n\t);\n\treturn (\n\t\t<Anchor key={translated.toString()} x={translated.x} y={translated.y} z={translated.z}>\n\t\t\t{terrainCoordinate.z > 0 ? (\n\t\t\t\t<MonochromeBox\n\t\t\t\t\tfill={isHovered ? color.highlightedTerrain : color.terrain}\n\t\t\t\t\tstroke={isHovered ? color.white : undefined}\n\t\t\t\t\tinnerStroke={\n\t\t\t\t\t\tisHovered ? color.highlightedTerrain.mix(color.white, 0.6) : undefined\n\t\t\t\t\t}\n\t\t\t\t\tonMouseEnter={() => setIsHovered(true)}\n\t\t\t\t\tonMouseLeave={() => setIsHovered(false)}\n\t\t\t\t\t{...svgMouseInteractionProps}\n\t\t\t\t/>\n\t\t\t) : (\n\t\t\t\t<MonochromeTile\n\t\t\t\t\tfill={(isHovered ? color.highlightedTerrain : color.terrain).opaquer(-0.5)}\n\t\t\t\t\tstroke={isHovered ? color.white : undefined}\n\t\t\t\t\tonMouseEnter={() => setIsHovered(true)}\n\t\t\t\t\tonMouseLeave={() => setIsHovered(false)}\n\t\t\t\t\t{...svgMouseInteractionProps}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</Anchor>\n\t);\n};\n\nexport const CubicTerrainComponent: GenericTerrainComponentI = ({\n\tterrain,\n\tonTileClick,\n\tonTileContextMenu\n}) => (\n\t<g className=\"cubic-terrain\">\n\t\t{terrain.getTilesInRenderOrder().map(tile => (\n\t\t\t<CubicTileComponent\n\t\t\t\tkey={tile.toString()}\n\t\t\t\ttile={tile}\n\t\t\t\tonClick={\n\t\t\t\t\tonTileClick\n\t\t\t\t\t\t? event => {\n\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t\t\t\t\tonTileClick(event, tile);\n\t\t\t\t\t\t  }\n\t\t\t\t\t\t: onTileClick\n\t\t\t\t}\n\t\t\t\tonContextMenu={\n\t\t\t\t\tonTileContextMenu\n\t\t\t\t\t\t? event => {\n\t\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\t\tonTileContextMenu(event, tile);\n\t\t\t\t\t\t  }\n\t\t\t\t\t\t: onTileContextMenu\n\t\t\t\t}\n\t\t\t/>\n\t\t))}\n\t</g>\n);\n","import { distanceToCameraComparator } from '../space/PERSPECTIVE';\nimport { Coordinate, CoordinateLike } from '../classes/Coordinate';\nimport { FunctionComponent } from 'react';\n\ntype TileFilter<T extends GenericTile> = (coordinate: T) => boolean;\n\n/**\n * A special type of coordinate that is equal to another terrain coordinate when the X and Y are equal, disregarding Z.\n */\nexport class GenericTile extends Coordinate {\n\tpublic terrain?: GenericTerrain<any>;\n\n\tequals(coord: CoordinateLike) {\n\t\treturn this === coord || (coord && this.x === coord.x && this.y === coord.y);\n\t}\n\n\tstatic clone(coord: GenericTile) {\n\t\tconst coord2 = new GenericTile(coord.x, coord.y, coord.z);\n\t\tcoord2.terrain = (coord as GenericTile).terrain;\n\t\treturn coord2;\n\t}\n\n\tisLand() {\n\t\treturn this.z > 0;\n\t}\n\n\t// For debugging purposes only, may change without notice or tests\n\ttoString() {\n\t\treturn '(' + [this.x, this.y].join(',') + ')';\n\t}\n}\n\nexport class GenericTerrain<T extends GenericTile> {\n\tpublic readonly tiles: T[] = [];\n\n\tprotected islands: Map<TileFilter<T>, T[][]> = new Map();\n\n\tpublic readonly Component: FunctionComponent<GenericTerrainComponentProps<T>> = () => {\n\t\tthrow new Error('Not implemented');\n\t};\n\n\tconstructor(tiles: T[]) {\n\t\tthis.tiles = tiles;\n\t}\n\n\tprivate _tilesInRenderOrder: GenericTile[] | null = null;\n\tpublic getTilesInRenderOrder() {\n\t\tif (!this._tilesInRenderOrder) {\n\t\t\tthis._tilesInRenderOrder = this.tiles.slice().sort(distanceToCameraComparator);\n\t\t}\n\t\treturn this._tilesInRenderOrder;\n\t}\n\n\t/**\n\t * Select all neighbouring points that connect to one another, like an island.\n\t */\n\tpublic selectContiguousTiles(start: T, selector: TileFilter<T> = c => c.isLand()): T[] {\n\t\tconst island: T[] = [];\n\t\tconst seen: T[] = [];\n\t\tconst queue: T[] = [start];\n\n\t\twhile (queue.length) {\n\t\t\tconst current = queue.shift() as T;\n\t\t\tisland.push(current);\n\n\t\t\tconst neighbours = this.getNeighborTiles(current).filter(n => !seen.includes(n));\n\t\t\tseen.splice(0, 0, current, ...neighbours);\n\t\t\tqueue.splice(0, 0, ...neighbours.filter(selector));\n\t\t}\n\t\treturn island;\n\t}\n\n\tpublic selectClosestTiles(start: T, maxDistance: number): T[] {\n\t\treturn this.selectContiguousTiles(\n\t\t\tstart,\n\t\t\tother => other.isLand() && start.euclideanDistanceTo(other) <= maxDistance\n\t\t);\n\t}\n\n\t/**\n\t * Get all distinct contiguous groups of cells\n\t */\n\tpublic getIslands(selector: TileFilter<T> = t => t.isLand()): T[][] {\n\t\tconst fromCache = this.islands.get(selector);\n\t\tif (fromCache) {\n\t\t\treturn fromCache;\n\t\t}\n\n\t\tlet open = this.tiles.slice();\n\t\tconst islands = [];\n\t\twhile (open.length) {\n\t\t\tconst next = open.shift() as T;\n\t\t\tif (!selector(next)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst island = this.selectContiguousTiles(next, selector);\n\t\t\topen = open.filter(n => !island.includes(n));\n\t\t\tislands.push(island);\n\t\t}\n\n\t\tthis.islands.set(selector, islands);\n\t\treturn islands;\n\t}\n\n\tpublic getClosestToXy(x: number, y: number): T {\n\t\tthrow new Error('Not implemented');\n\t}\n\n\tpublic getNeighborTiles(center: T): T[] {\n\t\tthrow new Error('Not implemented');\n\t}\n\n\tstatic generateRandom(seed: string, size: number): GenericTerrain<GenericTile> {\n\t\tthrow new Error('Not implemented');\n\t}\n}\n\nexport type GenericTerrainComponentProps<Tile extends GenericTile = GenericTile> = {\n\tonTileClick?: (event: React.MouseEvent<SVGGElement>, tile: Tile) => void;\n\tonTileContextMenu?: (event: React.MouseEvent<SVGGElement>, tile: Tile) => void;\n};\n\nexport type GenericTerrainComponentI<\n\tTerrain extends GenericTerrain<GenericTile> = GenericTerrain<GenericTile>,\n\tTile extends GenericTile = GenericTile\n> = FunctionComponent<\n\t{\n\t\tterrain: Terrain;\n\t} & GenericTerrainComponentProps<Tile>\n>;\n","import React, { FunctionComponent } from 'react';\nimport { OUT_OF_BOUNDS, TerrainGenerator } from '../classes/TerrainGenerator';\nimport { RATIO_WATER_OF_TOTAL } from '../generators/hello-world';\nimport { CubicTerrainComponent } from './CubicTerrainComponent';\nimport { GenericTerrain, GenericTerrainComponentProps, GenericTile } from './GenericTerrain';\n\nexport class CubicTile extends GenericTile {\n\t// public terrain?: CubicTerrain;\n\n\tstatic clone(coord: CubicTile) {\n\t\tconst coord2 = new CubicTile(coord.x, coord.y, coord.z);\n\t\tcoord2.terrain = (coord as CubicTile).terrain;\n\t\treturn coord2;\n\t}\n}\n\nexport class CubicTerrain extends GenericTerrain<CubicTile> {\n\tprotected size: number;\n\n\tComponent: FunctionComponent<GenericTerrainComponentProps<CubicTile>> = props =>\n\t\tReact.createElement(CubicTerrainComponent, { terrain: this, ...props });\n\n\tconstructor(coordinates: CubicTile[]) {\n\t\tsuper(coordinates);\n\t\tthis.tiles.forEach(coordinate => (coordinate.terrain = this));\n\n\t\tthis.size = Math.sqrt(this.tiles.length);\n\t}\n\n\tpublic getNeighborTiles(center: CubicTile) {\n\t\treturn [\n\t\t\t[-1, 0],\n\t\t\t[1, 0],\n\t\t\t[0, -1],\n\t\t\t[0, 1]\n\t\t\t// Diagonal neigbors not included\n\t\t]\n\t\t\t.map(([dx, dy]) => this.getClosestToXy(center.x + dx, center.y + dy))\n\t\t\t.filter(Boolean) as CubicTile[];\n\t}\n\n\tprivate getIndexForXy(x: number, y: number) {\n\t\treturn this.size * y + x;\n\t}\n\n\tpublic getClosestToXy(x: number, y: number): CubicTile {\n\t\tif (x < 0 || x > this.size - 1 || y < 0 || y > this.size - 1) {\n\t\t\t// Out of bounds\n\t\t\treturn this.tiles[0];\n\t\t}\n\t\treturn this.tiles[this.getIndexForXy(x, y)];\n\t}\n}\n\nexport function generateRandom(seed: string, size: number) {\n\tconst generator = new TerrainGenerator(seed, size);\n\n\tgenerator.generate(1);\n\n\t// For clarity, the terrain must currently always be square\n\t// @TODO fix that some time.\n\tconst width = size,\n\t\theight = size;\n\n\tconst coordinates = Array.from(new Array(width * height)).map<[number, number, number]>(\n\t\t(_, i) => {\n\t\t\tconst x = i % width;\n\t\t\tconst y = Math.floor(i / width);\n\t\t\tconst z = generator.get(x, y);\n\t\t\tif (z === OUT_OF_BOUNDS) {\n\t\t\t\tthrow new Error(`Out of bounds @ ${x}, ${y}`);\n\t\t\t}\n\t\t\treturn [x, y, (2 * (z as number)) / size];\n\t\t}\n\t);\n\n\tconst sortedHeights = coordinates.map(coordinate => coordinate[2]).sort();\n\tconst waterlineOffset = sortedHeights[Math.floor(sortedHeights.length * RATIO_WATER_OF_TOTAL)];\n\treturn new CubicTerrain(\n\t\tcoordinates.map(([x, y, z]) => new CubicTile(x, y, z - waterlineOffset))\n\t);\n}\n","import { Entity } from '../entities/Entity';\nimport { generateEntities as generateHelloWorldEntities } from '../generators/hello-world';\nimport { generateRandom } from '../terrain/CubicTerrain';\nimport { GenericTerrain, GenericTile } from '../terrain/GenericTerrain';\n\nexport class Scene {\n\tpublic readonly terrain: GenericTerrain<GenericTile>;\n\n\t// @TODO change to not readonly, and handle spontaneous changes\n\tpublic readonly entities: Entity[];\n\n\tpublic readonly seed;\n\n\tconstructor(seed: string, terrain: GenericTerrain<GenericTile>, entities: Entity[]) {\n\t\tthis.seed = seed;\n\t\tthis.terrain = terrain;\n\t\tthis.entities = entities;\n\t}\n\n\tplay() {\n\t\tconst destroyers = this.entities.map(entity => entity.play());\n\t\treturn () => destroyers.forEach(d => d());\n\t}\n\n\tstatic generateRandom(seed: string, size: number) {\n\t\tconst terrain = generateRandom(seed, size);\n\t\tconst entities = generateHelloWorldEntities(seed, terrain);\n\t\treturn new Scene(seed, terrain, entities);\n\t}\n}\n","// const ActiveEntityOverlay: FunctionComponent = ({ children }) => null;\n\nimport styled from '@emotion/styled';\nimport React, { FunctionComponent } from 'react';\nimport { Entity } from '../entities/Entity';\n\nconst ActiveEntityOverlayBoundary = styled.div`\n\tbackdrop-filter: blur(2px);\n`;\n\nconst ActiveEntityOverlayBody = styled.div`\n\tborder: 1px solid rgba(255, 255, 255, 0.5);\n\tborder-radius: 3px;\n\tpadding: 1em;\n\tdisplay: flex;\n\tflex-direction: row;\n`;\nconst Avatar = styled.div`\n\tborder: 1px solid rgba(255, 255, 255, 0.5);\n\tborder-radius: 50%;\n\twidth: 64px;\n\theight: 64px;\n\tjustify-content: center;\n\talign-items: center;\n\tdisplay: flex;\n\tmargin-right: 1em;\n`;\nconst HorizontalLinkList = styled.nav`\n\tdisplay: flex;\n\tflex-direction: row;\n\tfont-size: 60%;\n\ttext-transform: uppercase;\n`;\nconst HorizontalLinkListItem = styled.a`\n\tflex: 0 0 auto;\n\tbackground-color: rgba(255, 255, 255, 0.1);\n\tmargin-right: 3px;\n\n\t// Same as ContextMenuItem\n\tpadding: 0.125em 0.5em;\n\twhite-space: nowrap;\n\ttransition: background-color 0.5s;\n\tcolor: white;\n\t/* background-color: transparent; */\n\t/* background-color: rgba(255, 255, 255, 0.05); */\n\t&:hover {\n\t\tbackground-color: rgba(255, 255, 255, 0.5);\n\t\tcursor: pointer;\n\t}\n`;\nexport const EntityTextBadge: FunctionComponent<{ entity: Entity }> = ({ entity }) => (\n\t<>\n\t\t<p>\n\t\t\t<b>{entity.label}</b>\n\t\t</p>\n\t\t<p>{entity?.job ? entity.job.label : 'Jobless'}</p>\n\t\t<HorizontalLinkList style={{ marginTop: '1em' }}>\n\t\t\t<HorizontalLinkListItem\n\t\t\t\tonClick={() => {\n\t\t\t\t\tconsole.group('Selected entity');\n\t\t\t\t\tconsole.log(entity);\n\t\t\t\t\tconsole.groupEnd();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\tLOG\n\t\t\t</HorizontalLinkListItem>\n\t\t\t<HorizontalLinkListItem\n\t\t\t\tonClick={() => {\n\t\t\t\t\tconsole.warn('Following entity not implemented yet', entity);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\tFOLLOW\n\t\t\t</HorizontalLinkListItem>\n\t\t</HorizontalLinkList>\n\t</>\n);\nexport const ActiveEntityOverlay: FunctionComponent<{ entity?: Entity; zoom?: number }> = ({\n\tentity,\n\tzoom = 4\n}) => (\n\t<ActiveEntityOverlayBoundary>\n\t\t<ActiveEntityOverlayBody>\n\t\t\t<Avatar>\n\t\t\t\t{entity && (\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"1\"\n\t\t\t\t\t\theight=\"1\"\n\t\t\t\t\t\toverflow=\"visible\"\n\t\t\t\t\t\tshapeRendering=\"geometricPrecision\"\n\t\t\t\t\t\tviewBox={[0, 0, 1 / zoom, 1 / zoom].join(' ')}\n\t\t\t\t\t>\n\t\t\t\t\t\t<entity.Component />\n\t\t\t\t\t</svg>\n\t\t\t\t)}\n\t\t\t</Avatar>\n\t\t\t<div>{entity ? <EntityTextBadge entity={entity} /> : null}</div>\n\t\t</ActiveEntityOverlayBody>\n\t</ActiveEntityOverlayBoundary>\n);\n","import styled from '@emotion/styled';\nimport React, {\n\tcreateContext,\n\tFunctionComponent,\n\tReactElement,\n\tuseContext,\n\tuseEffect,\n\tuseState\n} from 'react';\nimport { CoordinateLike } from '../classes/Coordinate';\nimport { ViewportHtmlContainer } from '../space/Viewport';\nimport { Event } from '../util/Event';\n\nexport const ContextMenuContext = createContext<null | ContextMenuManager>(null);\n\n/**\n * Presentational components\n */\n\nconst ContextMenuArrow = styled.div`\n\twidth: 0;\n\theight: 0;\n\tborder-left: 6px solid transparent;\n\tborder-right: 6px solid transparent;\n\tborder-top: 6px solid rgba(255, 255, 255, 0.5);\n\ttransform: translate(calc(-50% + 0px), -6px);\n`;\n\nconst ContextMenuBoundary = styled.div`\n\tposition: absolute;\n\tbottom: 100%;\n\tleft: 50%;\n\tbackdrop-filter: blur(2px);\n\ttransform: translate(-50%, -6px);\n`;\n\nconst ContextMenuBody = styled.div`\n\tborder: 1px solid rgba(255, 255, 255, 0.5);\n\tborder-radius: 3px;\n\toverflow: hidden;\n`;\n\nexport const ContextMenuButton = styled.button`\n\tborder: none;\n\tdisplay: block;\n\twidth: 100%;\n\tbox-sizing: border-box;\n\n\t// Same as HorizontalLinkListItem\n\tpadding: 0.5em 1em;\n\twhite-space: nowrap;\n\ttransition: background-color 0.5s;\n\tcolor: white;\n\tbackground-color: transparent;\n\t&:hover {\n\t\tbackground-color: rgba(255, 255, 255, 0.5);\n\t\tcursor: pointer;\n\t}\n`;\n\nexport const ContextMenuFooter = styled.button`\n\tborder: none;\n\tdisplay: block;\n\twidth: 100%;\n\tbox-sizing: border-box;\n\n\t// Same as HorizontalLinkListItem\n\tpadding: 0.5em 1em;\n\twhite-space: nowrap;\n\ttransition: background-color 0.5s;\n\tcolor: white;\n\tbackground-color: rgba(255, 255, 255, 0.1);\n`;\n\n/**\n * Logic\n */\ntype ContextManagerState = false | { location: CoordinateLike; contents: ReactElement };\nexport class ContextMenuManager {\n\tpublic state: ContextManagerState = false;\n\tpublic change = new Event<[ContextManagerState]>();\n\n\tinvoke(location: CoordinateLike, contents: ReactElement) {\n\t\tthis.state = { location, contents };\n\t\tthis.change.emit(this.state);\n\t}\n\n\tisOpen() {\n\t\treturn !!this.state;\n\t}\n\n\tclose() {\n\t\tthis.state = false;\n\t\tthis.change.emit(this.state);\n\t}\n}\n\nexport const useContextMenuManager = () => {\n\tconst contextMenuManager = useContext(ContextMenuContext);\n\treturn contextMenuManager;\n};\n\nexport const ContextMenuContainer: FunctionComponent<{ zoom?: number }> = ({ zoom = 1 }) => {\n\tconst contextMenuManager = useContextMenuManager();\n\tconst [managerState, setManagerState] = useState(contextMenuManager?.state);\n\tuseEffect(() => {\n\t\tif (!contextMenuManager) {\n\t\t\tthrow new Error('Shit.');\n\t\t}\n\t\treturn contextMenuManager.change.on(setManagerState);\n\t}, [contextMenuManager]);\n\n\tif (!managerState) {\n\t\treturn null;\n\t}\n\treturn (\n\t\t<ViewportHtmlContainer location={managerState.location} width={0} height={0} zoom={zoom}>\n\t\t\t<ContextMenuBoundary>\n\t\t\t\t<ContextMenuBody>{managerState.contents}</ContextMenuBody>\n\t\t\t</ContextMenuBoundary>\n\t\t\t<ContextMenuArrow />\n\t\t</ViewportHtmlContainer>\n\t);\n};\n","import styled from '@emotion/styled';\n\nexport const Overlay = styled.section`\n\tposition: absolute;\n\tbottom: 2em;\n\tleft: 2em;\n\n\tfont-family: sans-serif;\n\tcolor: white;\n\n\ta {\n\t\tcolor: inherit;\n\t}\n`;\n","import React, { FunctionComponent, useEffect, useMemo, useState } from 'react';\nimport { Scene } from '../classes/Scene';\nimport { Entity } from '../entities/Entity';\nimport { PersonEntity, PersonEntityComponent } from '../entities/PersonEntity';\nimport { Viewport } from '../space/Viewport';\nimport { ActiveEntityOverlay } from '../ui/ActiveEntityOverlay';\nimport {\n\tContextMenuButton,\n\tContextMenuContainer,\n\tContextMenuContext,\n\tContextMenuFooter,\n\tContextMenuManager\n} from '../ui/ContextMenu';\nimport { Overlay } from '../ui/Overlay';\n\nconst WORLD_SIZE = 32;\n\nfunction fancyTimeFormat(seconds: number) {\n\t// Output like \"1:01\" or \"4:03:59\" or \"123:03:59\"\n\treturn `${~~((seconds % 3600) / 60)} ${seconds % 60}`;\n}\nfunction fakeCoordinates(x: number, y: number) {\n\treturn `40 ${fancyTimeFormat(1000 - x)} N 79 ${fancyTimeFormat(700 - y)} W`;\n}\n\nconst Demo: FunctionComponent = () => {\n\tconst scene = useMemo(() => {\n\t\tconst scene = Scene.generateRandom(String(Date.now()), WORLD_SIZE);\n\t\t(window as any).scene = scene;\n\t\treturn scene;\n\t}, []);\n\n\tconst contextManager = useMemo(() => new ContextMenuManager(), []);\n\n\tconst [center, setCenter] = useState(\n\t\tscene.terrain.getClosestToXy(Math.floor(WORLD_SIZE / 2), Math.floor(WORLD_SIZE / 2))\n\t);\n\n\tconst [activeEntity, setActiveEntity] = useState<Entity | undefined>(undefined);\n\n\tconst terrain = useMemo(\n\t\t() => (\n\t\t\t<scene.terrain.Component\n\t\t\t\tonTileClick={(event, tile) => {\n\t\t\t\t\tcontextManager.invoke(\n\t\t\t\t\t\ttile,\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<ContextMenuButton onClick={() => setCenter(tile)}>\n\t\t\t\t\t\t\t\tCenter camera\n\t\t\t\t\t\t\t</ContextMenuButton>\n\t\t\t\t\t\t\t<ContextMenuFooter>{fakeCoordinates(tile.x, tile.y)}</ContextMenuFooter>\n\t\t\t\t\t\t</>\n\t\t\t\t\t);\n\t\t\t\t}}\n\t\t\t\tonTileContextMenu={(event, tile) => {\n\t\t\t\t\tsetCenter(tile);\n\t\t\t\t}}\n\t\t\t/>\n\t\t),\n\t\t[scene, contextManager]\n\t);\n\n\tconst entities = useMemo(\n\t\t() =>\n\t\t\tscene.entities\n\t\t\t\t.filter((entity): entity is PersonEntity => entity instanceof PersonEntity)\n\t\t\t\t.map(entity => (\n\t\t\t\t\t<PersonEntityComponent\n\t\t\t\t\t\tkey={entity.id}\n\t\t\t\t\t\tentity={entity}\n\t\t\t\t\t\tonClick={event => {\n\t\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\t\tsetActiveEntity(entity);\n\t\t\t\t\t\t}}\n\t\t\t\t\t/>\n\t\t\t\t)),\n\t\t[scene.entities]\n\t);\n\n\t// Make all the things move!\n\tuseEffect(() => scene.play(), [scene]);\n\n\tuseEffect(() => {\n\t\tconst cb = () => {\n\t\t\tcontextManager.close();\n\t\t};\n\n\t\twindow.addEventListener('click', cb);\n\t\treturn () => window.removeEventListener('click', cb);\n\t}, [contextManager]);\n\n\treturn (\n\t\t<ContextMenuContext.Provider value={contextManager}>\n\t\t\t<Viewport center={center} zoom={1} overlay={<ContextMenuContainer zoom={1} />}>\n\t\t\t\t<g id=\"scene__terrain\">{terrain}</g>\n\t\t\t\t<g id=\"scene__entities\">{entities}</g>\n\t\t\t</Viewport>\n\t\t\t<Overlay>\n\t\t\t\t<ActiveEntityOverlay entity={activeEntity} />\n\t\t\t\t<p style={{ fontSize: '0.8em', opacity: '0.5' }}>\n\t\t\t\t\t<a\n\t\t\t\t\t\thref=\"https://github.com/wvbe/kreuzzeug-im-nagelhosen\"\n\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\trel=\"noreferrer\"\n\t\t\t\t\t>\n\t\t\t\t\t\tGitHub\n\t\t\t\t\t</a>\n\t\t\t\t\t{'    '}\n\t\t\t\t\tSeed: {scene.seed}\n\t\t\t\t</p>\n\t\t\t</Overlay>\n\t\t</ContextMenuContext.Provider>\n\t);\n};\n\nexport default Demo;\n","import React, { FunctionComponent } from 'react';\nimport { CoordinateArray } from '../classes/Coordinate';\nimport { PERSPECTIVE } from '../space/PERSPECTIVE';\n\nexport const DualMeshTileComponent: FunctionComponent<{\n\tcenter: CoordinateArray;\n\tnodes: CoordinateArray[];\n}> = ({ center, nodes }) => {\n\treturn (\n\t\t<polyline\n\t\t\tfill=\"rgba(0,0,0,0.1)\"\n\t\t\tstroke=\"black\"\n\t\t\tpoints={[...nodes, nodes[0]]\n\t\t\t\t.map(n => PERSPECTIVE.toPixels(n[0], n[1], 0).join(','))\n\t\t\t\t.join(' ')}\n\t\t/>\n\t);\n};\n","import MeshBuilder from 'dual-mesh/create';\nimport Poisson from 'poisson-disk-sampling';\nimport React, { FunctionComponent, useMemo, useState } from 'react';\nimport { Coordinate, CoordinateArray } from '../classes/Coordinate';\nimport { Viewport } from '../space/Viewport';\nimport { DualMeshTileComponent } from '../terrain/DualMeshTileComponent';\n\nconst TerrainMesh: FunctionComponent = () => {\n\tconst { mesh, points } = useMemo(() => {\n\t\t// new MeshBuilder({ boundarySpacing: 75 }).addPoisson(Poisson, 75).create();\n\t\tconst poisson = new Poisson(\n\t\t\t{\n\t\t\t\tshape: [64, 64],\n\t\t\t\tminDistance: 2\n\t\t\t},\n\t\t\tMath.random\n\t\t);\n\t\tconst mesh = new MeshBuilder({ boundarySpacing: 2 });\n\n\t\tmesh.points.forEach((p: [number, number]) => poisson.addPoint(p));\n\t\tmesh.points = poisson.fill().map((xy: [number, number]) => [...xy, 0]);\n\n\t\treturn {\n\t\t\tmesh: mesh.create(),\n\t\t\tpoints: mesh.points\n\t\t};\n\t}, []);\n\tconst [center] = useState(new Coordinate(32, 32, 0));\n\n\treturn (\n\t\t<Viewport center={center} zoom={1}>\n\t\t\t{points.map((point: CoordinateArray, i: number) => {\n\t\t\t\treturn (\n\t\t\t\t\t<DualMeshTileComponent\n\t\t\t\t\t\tkey={point.join('/')}\n\t\t\t\t\t\tcenter={point}\n\t\t\t\t\t\tnodes={mesh\n\t\t\t\t\t\t\t.r_circulate_t([], i)\n\t\t\t\t\t\t\t.map((i: number) => [mesh.t_x(i), mesh.t_y(i)])}\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t})}\n\t\t</Viewport>\n\t);\n};\n\nexport default TerrainMesh;\n","import React from 'react';\nimport { Route, Switch } from 'react-router';\nimport { Link } from 'react-router-dom';\nimport DemoCubes from './demos/demo.cubes';\nimport SceneHelloWorld from './demos/scene.hello-world';\nimport DualMeshWorld from './demos/scene.dual-mesh';\n\nfunction Demos() {\n\treturn (\n\t\t<>\n\t\t\t<ul>\n\t\t\t\t<li>\n\t\t\t\t\t<Link to=\"/tests\">Tests</Link>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t<Route exact path=\"/tests\" component={DemoCubes} />\n\t\t</>\n\t);\n}\n\nfunction App() {\n\treturn (\n\t\t<Switch>\n\t\t\t<Route exact path=\"/dual-mesh\" component={DualMeshWorld} />\n\t\t\t<Route exact path=\"/\" component={SceneHelloWorld} />\n\t\t\t<Route component={Demos} />\n\t\t</Switch>\n\t);\n}\n\nexport default App;\n","import { Global } from '@emotion/react';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { HashRouter } from 'react-router-dom';\n\nimport App from './App';\nimport globalStyleRules from './styles';\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<Global styles={globalStyleRules} />\n\t\t<HashRouter hashType={'slash'}>\n\t\t\t<App />\n\t\t</HashRouter>\n\t</React.StrictMode>,\n\tdocument.getElementById('root')\n);\n"],"sourceRoot":""}
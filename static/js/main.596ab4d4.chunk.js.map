{"version":3,"sources":["space/PERSPECTIVE.ts","space/LinePath.tsx","space/Anchor.tsx","space/MonochromeBox.tsx","space/Viewport.tsx","demos/scaffolding.tsx","demos/demo.cubes.tsx","classes/Coordinate.ts","space/MonochromeTile.tsx","util/events.ts","entities/Entity.tsx","entities/GuardEntity.tsx","classes/TerrainCoordinate.ts","classes/TerrainGenerator.ts","classes/Terrain.ts","classes/Scene.ts","jobs/Patrol.ts","ui/ActiveEntityOverlay.tsx","demos/scene.hello-world.tsx","App.tsx","textures/nebula-282c34.png","styles.ts","index.tsx"],"names":["PERSPECTIVE","degrees","tileSize","isometricAngle","Math","PI","_isometricCos","cos","_isometricSin","sin","_isometricTan","tan","tileHeight","radians","toPixels","x","y","z","toCoords","cartX","cartY","isoY","createPerspective","distanceToCameraComparator","a","b","dX","dY","dZ","LinePath","path","stroke","strokeWidth","spatialCoordinates","map","coordinate","cc","c","reduce","lines","start","i","all","concat","x1","y1","x2","y2","String","Crosshair","size","points","Anchor","children","crosshairSize","pixels","useMemo","overflow","MovingAnchor","moveTo","moveSpeed","onRest","dx","dy","ix","iy","loc","useSpring","to","config","duration","from","svg","coordsToPixels","coords","borderWidth","COORDINATE_CLOSEST_TO_CAMERA","BORDER_NODES","XZ_NODES","YZ_NODES","XY_NODES","MonochromeBox","fill","Color","strokeLinecap","darken","saturate","innerStroke","lighten","desaturate","innerStrokeWidth","gProps","innerStrokeCss","string","strokeCss","style","onClick","onContextMenu","cursor","join","PIXEL_FRIENDLY_PYTHAGORAS","pow","mathRoundMaybe","n","round","AbsolutelyPositionedContainer","styled","div","Viewport","overlay","center","zoom","translateX","translateY","springStyles","transform","ViewportSvgContainer","rest","width","height","shapeRendering","viewBox","NoAxis","Backdrop","sqrt","Demo","window","alert","Coordinate","this","coord","dz","isNaN","abs","xy","MonochromeTile","Event","listeners","callback","push","splice","indexOf","args","forEach","noop","Entity","id","location","moveStart","moveRest","Component","job","on","hasNaN","emit","EntityComponent","entity","useState","destination","animatePosition","deps","cb","useCallback","eventDestroyers","d","useEffect","useEventListeners","euclideanDistanceTo","offset","GuardEntity","TerrainCoordinate","OUT_OF_BOUNDS","Symbol","average","values","valid","filter","val","sum","length","TerrainGenerator","max","detail","ceil","log","Float32Array","roughness","set","divide","half","scale","square","random","diamond","ave","get","Terrain","coordinates","coordinatesInRenderOrder","getIndexForXy","getAtXy","Boolean","slice","sort","generator","generate","Array","_","floor","Error","Scene","terrain","entities","destroyers","play","generateRandom","PatrolJob","waypoints","waypointIndex","setTimeout","constructor","name","ActiveEntityOverlayWrapper","section","ActiveEntityOverlay","HelloWorldSceneTerrain","monochromeBoxProps","isHovered","setIsHovered","translated","clone","undefined","onMouseEnter","onMouseLeave","toString","scene","guard","doJob","getRandomLocation","console","WORLD_SIZE","centerCoord","setCenterCoord","getCoordinatesInRenderOrder","event","preventDefault","Demos","exact","component","DemoCubes","App","SceneHelloWorld","styles","css","nebulaTexture","ReactDOM","render","StrictMode","globalStyleRules","hashType","document","getElementById"],"mappings":"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","file":"static/js/main.596ab4d4.chunk.js","sourcesContent":["import { CoordinateLike } from '../classes/Coordinate';\n//     z+\n//     |     y+\n//     |    /\n//     |  /\n//     |/\n// 0,0  \\\n//        \\\n//          \\ x+\n\nconst BASE_LENGTH = 24;\n\nexport type CoordValue = number;\nexport type Length = number;\nexport type Angle = number;\nexport type CoordArray = [CoordValue, CoordValue, CoordValue];\nexport type CoordObject = { x: CoordValue; y: CoordValue; z: CoordValue };\n\nfunction createPerspective(degrees: Angle, tileSize: Length) {\n\tconst isometricAngle = degrees * (Math.PI / 180);\n\tconst _isometricCos = Math.cos(isometricAngle);\n\tconst _isometricSin = Math.sin(isometricAngle);\n\tconst _isometricTan = Math.tan(isometricAngle);\n\n\tconst tileHeight = tileSize;\n\n\treturn {\n\t\tdegrees: degrees,\n\t\tradians: degrees * (Math.PI / 180),\n\t\ttileSize: tileSize,\n\t\ttoPixels: (x: CoordValue, y: CoordValue, z: CoordValue) => {\n\t\t\tconst cartX = (x + y) * _isometricCos,\n\t\t\t\tcartY = (x - y) * _isometricSin;\n\n\t\t\treturn [\n\t\t\t\tcartX * tileSize, // x\n\t\t\t\tcartY * tileSize - tileHeight * z // y\n\t\t\t];\n\t\t},\n\t\ttoCoords: (cartX: CoordValue, cartY: CoordValue) => {\n\t\t\tconst isoY = _isometricTan * cartX + cartY,\n\t\t\t\tisoX = (cartY - isoY) / -_isometricSin - isoY;\n\n\t\t\t// this is good so far, b should be rescaled for tile size. as\n\t\t\treturn [isoX / tileSize, isoY / tileSize];\n\t\t}\n\t};\n}\n\nexport const PERSPECTIVE = createPerspective(30, BASE_LENGTH);\n\nexport function randomComparator() {\n\treturn 0.5 - Math.random();\n}\n\nexport function distanceToCameraComparator(a: CoordinateLike, b: CoordinateLike) {\n\tconst dX = b.x - a.x;\n\tif (dX) {\n\t\treturn -dX;\n\t}\n\n\tconst dY = a.y - b.y;\n\tif (dY) {\n\t\treturn -dY;\n\t}\n\tconst dZ = b.z - a.z;\n\tif (dZ) {\n\t\treturn -dZ;\n\t}\n\treturn 0;\n}\n","import React, { FunctionComponent, ReactElement } from 'react';\n\nimport { CoordArray, PERSPECTIVE } from './PERSPECTIVE';\n\nconst BORDER_WIDTH = 0;\n\nexport const LinePath: FunctionComponent<\n\tOmit<React.SVGProps<SVGLineElement>, 'path'> & {\n\t\tpath: CoordArray[];\n\t}\n> = ({ path, stroke = 'black', strokeWidth = BORDER_WIDTH }) => {\n\tlet spatialCoordinates = path\n\t\t.map(coordinate => PERSPECTIVE.toPixels(...coordinate))\n\t\t.map(cc => cc.map(c => c + BORDER_WIDTH));\n\n\treturn (\n\t\t<>\n\t\t\t{spatialCoordinates.reduce<ReactElement[]>(\n\t\t\t\t(lines, start, i, all) =>\n\t\t\t\t\ti\n\t\t\t\t\t\t? lines.concat([\n\t\t\t\t\t\t\t\t<line\n\t\t\t\t\t\t\t\t\tkey={i}\n\t\t\t\t\t\t\t\t\tx1={start[0]}\n\t\t\t\t\t\t\t\t\ty1={start[1]}\n\t\t\t\t\t\t\t\t\tx2={all[i - 1][0]}\n\t\t\t\t\t\t\t\t\ty2={all[i - 1][1]}\n\t\t\t\t\t\t\t\t\tstroke={stroke}\n\t\t\t\t\t\t\t\t\tstrokeWidth={String(strokeWidth)}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t  ])\n\t\t\t\t\t\t: lines,\n\t\t\t\t[]\n\t\t\t)}\n\t\t</>\n\t);\n};\n","import { useSpring } from '@react-spring/core';\nimport { animated } from '@react-spring/web';\nimport React, { FunctionComponent, useMemo } from 'react';\nimport { CoordinateLike } from '../classes/Coordinate';\nimport { LinePath } from './LinePath';\nimport { CoordArray, Length, PERSPECTIVE } from './PERSPECTIVE';\n\nconst Crosshair: FunctionComponent<{ size: Length }> = ({ size = 4 }) => {\n\tconst lines: CoordArray[][] = [\n\t\t[\n\t\t\t// over the x axis\n\t\t\t[-1 * size, 0, 0],\n\t\t\t[size, 0, 0]\n\t\t],\n\t\t[\n\t\t\t// over the y axis\n\t\t\t[0, -1 * size, 0],\n\t\t\t[0, size, 0]\n\t\t],\n\t\t[\n\t\t\t// over the z axis\n\t\t\t[0, 0, -1 * size],\n\t\t\t[0, 0, size]\n\t\t]\n\t];\n\n\treturn (\n\t\t<>\n\t\t\t{lines.map((points, i) => (\n\t\t\t\t<LinePath key={i} path={points} stroke={'rgba(0,0,0)'} strokeWidth={0.5} />\n\t\t\t))}\n\t\t</>\n\t);\n};\n\nexport const Anchor: FunctionComponent<\n\t{\n\t\tcrosshairSize?: Length;\n\t} & Partial<CoordinateLike>\n> = ({ x = 0, y = 0, z = 0, children, crosshairSize = 0 }) => {\n\tconst pixels = useMemo(() => PERSPECTIVE.toPixels(x, y, z), [x, y, z]);\n\n\treturn (\n\t\t<svg x={pixels[0]} y={pixels[1]} overflow={'visible'}>\n\t\t\t{crosshairSize ? <Crosshair size={crosshairSize} /> : null}\n\t\t\t{children}\n\t\t</svg>\n\t);\n};\n\nexport const MovingAnchor: FunctionComponent<{\n\tmoveTo: CoordinateLike;\n\tmoveSpeed: number;\n\tonRest?: () => void;\n\tcrosshairSize?: Length;\n}> = ({ moveTo, moveSpeed, onRest, children, crosshairSize = 0 }) => {\n\tconst [dx, dy] = useMemo(() => PERSPECTIVE.toPixels(moveTo.x, moveTo.y, moveTo.z), [moveTo]);\n\n\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\tconst [ix, iy] = useMemo(() => [dx, dy], []);\n\n\t// if (isNaN(dx) || isNaN(dy)) {\n\t// \tdebugger;\n\t// }\n\tconst loc = useSpring({\n\t\tto: {\n\t\t\tx: dx,\n\t\t\ty: dy\n\t\t},\n\t\tconfig: {\n\t\t\tduration: moveSpeed\n\t\t},\n\t\tfrom: {\n\t\t\tx: ix,\n\t\t\ty: iy\n\t\t},\n\t\tonRest\n\t});\n\n\t// @TODO reuse <Anchor>\n\treturn (\n\t\t<animated.svg x={loc.x} y={loc.y} overflow={'visible'}>\n\t\t\t{crosshairSize ? <Crosshair size={crosshairSize} /> : null}\n\t\t\t{children}\n\t\t</animated.svg>\n\t);\n};\n","import Color from 'color';\nimport React, { FunctionComponent } from 'react';\nimport { CoordArray, Length, PERSPECTIVE } from './PERSPECTIVE';\n\nconst BORDER_WIDTH = 0;\n\nfunction coordsToPixels(coords: CoordArray[], borderWidth = BORDER_WIDTH) {\n\treturn coords\n\t\t.map(coordinate => PERSPECTIVE.toPixels(...coordinate))\n\t\t.map(cc => cc.map(c => c + borderWidth));\n}\n\nconst COORDINATE_CLOSEST_TO_CAMERA = PERSPECTIVE.toPixels(1, 0, 1).map(c => c + BORDER_WIDTH);\n\nlet BORDER_NODES = coordsToPixels([\n\t[1, 1, 0], // 0\n\t[1, 1, 1],\n\t[0, 1, 1], // 2\n\t[0, 0, 1],\n\t[0, 0, 0], // 4\n\t[1, 0, 0]\n]);\n\n// facing to the bottom left, aka -y\nlet XZ_NODES = coordsToPixels([\n\t[0, 0, 0],\n\t[0, 0, 1],\n\t[1, 0, 1],\n\t[1, 0, 0]\n]);\n\n// facing to the bottom right, aka +x\nlet YZ_NODES = coordsToPixels([\n\t[1, 0, 0],\n\t[1, 1, 0],\n\t[1, 1, 1],\n\t[1, 0, 1]\n]);\n\n// facing top, aka +z\nlet XY_NODES = coordsToPixels([\n\t[0, 0, 1],\n\t[1, 0, 1],\n\t[1, 1, 1],\n\t[0, 1, 1]\n]);\n\nexport const MonochromeBox: FunctionComponent<\n\t{\n\t\tstrokeLinecap?: 'round' | 'butt' | 'square' | 'inherit' | undefined;\n\t\tfill?: Color;\n\t\tstroke?: Color;\n\t\tstrokeWidth?: Length;\n\t\tinnerStrokeWidth?: Length;\n\t\tinnerStroke?: Color;\n\t} & Pick<\n\t\tReact.SVGProps<SVGGElement>,\n\t\t'onClick' | 'onContextMenu' | 'onMouseEnter' | 'onMouseLeave'\n\t>\n> = ({\n\tfill = Color('#282c34'),\n\tstrokeLinecap = 'round',\n\tstroke = fill.darken(0.3).saturate(0.3),\n\tstrokeWidth = 1,\n\tinnerStroke = fill.lighten(0.4).desaturate(0.8),\n\tinnerStrokeWidth = strokeWidth,\n\t...gProps\n}) => {\n\tconst innerStrokeCss = innerStroke && innerStroke.string();\n\tconst strokeCss = stroke && stroke.string();\n\n\tconst style: Record<string, string> = {};\n\tif (gProps.onClick || gProps.onContextMenu) {\n\t\tstyle.cursor = 'pointer';\n\t}\n\n\treturn (\n\t\t<g {...gProps} style={style}>\n\t\t\t{fill && (\n\t\t\t\t<>\n\t\t\t\t\t<polygon\n\t\t\t\t\t\tkey={'xz'}\n\t\t\t\t\t\tpoints={XZ_NODES.map(c => c.join(',')).join(' ')}\n\t\t\t\t\t\tfill={fill.string()}\n\t\t\t\t\t\tstrokeWidth={0}\n\t\t\t\t\t/>\n\t\t\t\t\t<polygon\n\t\t\t\t\t\tkey={'xy'}\n\t\t\t\t\t\tpoints={XY_NODES.map(c => c.join(',')).join(' ')}\n\t\t\t\t\t\tfill={fill.lighten(0.2).string()}\n\t\t\t\t\t\tstrokeWidth={0}\n\t\t\t\t\t/>\n\t\t\t\t\t<polygon\n\t\t\t\t\t\tkey={'yz'}\n\t\t\t\t\t\tpoints={YZ_NODES.map(c => c.join(',')).join(' ')}\n\t\t\t\t\t\tfill={fill.darken(0.2).string()}\n\t\t\t\t\t\tstrokeWidth={0}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\t\t\t{innerStroke && (\n\t\t\t\t<>\n\t\t\t\t\t<line\n\t\t\t\t\t\tkey={'x-bar'}\n\t\t\t\t\t\tx1={COORDINATE_CLOSEST_TO_CAMERA[0]}\n\t\t\t\t\t\ty1={COORDINATE_CLOSEST_TO_CAMERA[1]}\n\t\t\t\t\t\tx2={BORDER_NODES[3][0]}\n\t\t\t\t\t\ty2={BORDER_NODES[3][1]}\n\t\t\t\t\t\tstroke={innerStrokeCss}\n\t\t\t\t\t\tstrokeWidth={innerStrokeWidth}\n\t\t\t\t\t\tstrokeLinecap={strokeLinecap}\n\t\t\t\t\t/>\n\t\t\t\t\t<line\n\t\t\t\t\t\tkey={'y-bar'}\n\t\t\t\t\t\tx1={COORDINATE_CLOSEST_TO_CAMERA[0]}\n\t\t\t\t\t\ty1={COORDINATE_CLOSEST_TO_CAMERA[1]}\n\t\t\t\t\t\tx2={BORDER_NODES[1][0]}\n\t\t\t\t\t\ty2={BORDER_NODES[1][1]}\n\t\t\t\t\t\tstroke={innerStrokeCss}\n\t\t\t\t\t\tstrokeWidth={innerStrokeWidth}\n\t\t\t\t\t\tstrokeLinecap={strokeLinecap}\n\t\t\t\t\t/>\n\t\t\t\t\t<line\n\t\t\t\t\t\tkey={'z-bar'}\n\t\t\t\t\t\tx1={COORDINATE_CLOSEST_TO_CAMERA[0]}\n\t\t\t\t\t\ty1={COORDINATE_CLOSEST_TO_CAMERA[1]}\n\t\t\t\t\t\tx2={BORDER_NODES[5][0]}\n\t\t\t\t\t\ty2={BORDER_NODES[5][1]}\n\t\t\t\t\t\tstroke={innerStrokeCss}\n\t\t\t\t\t\tstrokeWidth={innerStrokeWidth}\n\t\t\t\t\t\tstrokeLinecap={strokeLinecap}\n\t\t\t\t\t/>\n\t\t\t\t</>\n\t\t\t)}\n\n\t\t\t<polygon\n\t\t\t\tkey={'outline'}\n\t\t\t\tpoints={BORDER_NODES.map(c => c.join(',')).join(' ')}\n\t\t\t\tstroke={strokeCss}\n\t\t\t\tfill={'transparent'}\n\t\t\t\tstrokeWidth={strokeWidth}\n\t\t\t\tstrokeLinecap={strokeLinecap}\n\t\t\t/>\n\t\t</g>\n\t);\n};\n","import styled from '@emotion/styled';\nimport React, { FunctionComponent, ReactElement, useMemo } from 'react';\nimport { AnimatedComponent } from 'react-spring';\nimport { CoordinateLike } from '../classes/Coordinate';\nimport { Length, PERSPECTIVE } from './PERSPECTIVE';\n\n// The pythagoras distance (1/sqrt(2)) with a little tweaking for better looks\nconst PIXEL_FRIENDLY_PYTHAGORAS = 1 / Math.pow(2, 1 / 2); //0.8;\n\nfunction mathRoundMaybe(n: number) {\n\t// For debugging only. Adjust to taste.\n\n\treturn Math.round(n);\n\t// return n;\n}\n\n// Force the type to AnimatedComponent to avoid a weird TS inference bug\n//\nexport const AbsolutelyPositionedContainer = styled.div`\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\twidth: 0;\n\theight: 0;\n\ttransition: transform 0.5s;\n\t> * {\n\t\tposition: absolute;\n\t\ttop: 0;\n\t\tleft: 0;\n\t}\n` as unknown as AnimatedComponent<'div'>;\n\ntype ViewportComponentProps = {\n\tzoom?: number;\n\tcenter?: CoordinateLike;\n\toverlay?: ReactElement;\n};\n\nexport const Viewport: FunctionComponent<ViewportComponentProps> = ({\n\toverlay,\n\tcenter = { x: 0, y: 0, z: 0 },\n\tzoom = 1,\n\tchildren\n}) => {\n\tconst [translateX, translateY] = useMemo(\n\t\t() =>\n\t\t\tPERSPECTIVE.toPixels(center.x, center.y, center.z).map(\n\t\t\t\t(n, i) => mathRoundMaybe(-n) + (i ? 0 : 0.5)\n\t\t\t),\n\t\t[center]\n\t);\n\n\tconst springStyles =\n\t\t//useSpring({\n\t\t// \tconfig: config.molasses,\n\t\t// \tto:\n\t\t{\n\t\t\ttransform: `translate(\n\t\t\t\t${translateX * zoom}px,\n\t\t\t\t${translateY * zoom}px\n\t\t\t)`\n\t\t};\n\t// });\n\n\treturn (\n\t\t<AbsolutelyPositionedContainer style={springStyles}>\n\t\t\t<ViewportSvgContainer zoom={zoom} children={children} />\n\t\t\t{overlay}\n\t\t</AbsolutelyPositionedContainer>\n\t);\n};\n\nexport const ViewportSvgContainer: FunctionComponent<\n\t{\n\t\tzoom?: number;\n\t} & React.SVGProps<SVGSVGElement>\n> = ({ zoom = 1, ...rest }) => (\n\t<svg\n\t\twidth=\"1px\"\n\t\theight=\"1px\"\n\t\toverflow=\"visible\"\n\t\tshapeRendering=\"geometricPrecision\"\n\t\tviewBox={[0, 0, 1 / zoom, 1 / zoom].join(' ')}\n\t\t{...rest}\n\t/>\n);\n\nconst NoAxis = styled.div<{ zoom?: number }>`\n\t--scale-val: ${({ zoom = 1 }) => zoom};\n\n\tposition: absolute;\n\ttransform-origin: top left;\n\ttransform: scale(var(--scale-val));\n`;\n\nconst YAxis = styled(NoAxis)`\n\ttransform: skewY(-${PERSPECTIVE.degrees}deg)\n\t\tscale(calc(${PIXEL_FRIENDLY_PYTHAGORAS} * var(--scale-val)), var(--scale-val));\n`;\n\nconst ZAxis = styled(NoAxis)`\n\ttransform: rotate(-${PERSPECTIVE.degrees}deg) skewX(${PERSPECTIVE.degrees}deg)\n\t\tscale(\n\t\t\tcalc(${Math.sqrt(PIXEL_FRIENDLY_PYTHAGORAS)} * var(--scale-val)),\n\t\t\tcalc(${PIXEL_FRIENDLY_PYTHAGORAS} * var(--scale-val))\n\t\t);\n`;\n\nconst XAxis = styled(NoAxis)`\n\ttransform: skewY(${PERSPECTIVE.degrees}deg)\n\t\tscale(calc(${PIXEL_FRIENDLY_PYTHAGORAS} * var(--scale-val)), var(--scale-val));\n`;\n\nexport const ViewportHtmlContainer: FunctionComponent<{\n\taxis?: 'x' | 'y' | 'z';\n\twidth: Length;\n\theight: Length;\n\tzoom?: number;\n\tlocation: CoordinateLike;\n}> = ({ location, zoom = 1, axis, width, height, children }) => {\n\tconst { x, y, z } = location,\n\t\t// @TODO use css variable to zoom instead of JS\n\t\t[left, top] = PERSPECTIVE.toPixels(x, y, z).map(n => mathRoundMaybe(n * zoom));\n\t// @TODO use css variable to zoom instead of JS\n\tconst [pixelWidth] = PERSPECTIVE.toPixels(0, width, height).map(n => mathRoundMaybe(n * zoom));\n\tconst Axis = axis === 'y' ? YAxis : axis === 'x' ? XAxis : axis === 'z' ? ZAxis : NoAxis;\n\treturn (\n\t\t<Axis\n\t\t\tzoom={zoom}\n\t\t\tstyle={{\n\t\t\t\tleft: mathRoundMaybe(left),\n\t\t\t\ttop: mathRoundMaybe(top),\n\t\t\t\twidth:\n\t\t\t\t\tmathRoundMaybe(axis ? pixelWidth / PIXEL_FRIENDLY_PYTHAGORAS : pixelWidth) +\n\t\t\t\t\t'px',\n\t\t\t\theight:\n\t\t\t\t\tMath.abs(\n\t\t\t\t\t\t(height * PERSPECTIVE.tileSize) /\n\t\t\t\t\t\t\t(axis === 'z' ? PIXEL_FRIENDLY_PYTHAGORAS : 1)\n\t\t\t\t\t) + 'px'\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</Axis>\n\t);\n};\n","import styled from '@emotion/styled';\n\nexport const Backdrop = styled.div<{ height?: number }>`\n\tposition: relative;\n\theight: ${({ height = 180 }) => `${height}px`};\n\tbackground-image: linear-gradient(\n\t\t45deg,\n\t\trgba(255, 255, 255, 0.02) 25%,\n\t\trgba(0, 0, 0, 0.02) 25%,\n\t\trgba(0, 0, 0, 0.02) 50%,\n\t\trgba(255, 255, 255, 0.02) 50%,\n\t\trgba(255, 255, 255, 0.02) 75%,\n\t\trgba(0, 0, 0, 0.02) 75%,\n\t\trgba(0, 0, 0, 0.02) 100%\n\t);\n\tbackground-size: 56.57px 56.57px;\n\tmargin-bottom: 1em;\n`;\n","import Color from 'color';\nimport { FunctionComponent } from 'react';\nimport { Anchor } from '../space/Anchor';\nimport { MonochromeBox } from '../space/MonochromeBox';\nimport { Viewport } from '../space/Viewport';\nimport { Backdrop } from './scaffolding';\n\nconst Demo: FunctionComponent = () => (\n\t<>\n\t\t<Backdrop>\n\t\t\t<Viewport zoom={1} center={{ x: 0.5, y: 0.5, z: 0.5 }}>\n\t\t\t\t<Anchor x={-2} y={-2} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={0} y={0} z={0}>\n\t\t\t\t\t<MonochromeBox innerStroke={Color('#630a0a7d')} fill={Color('#960202')} />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={2} y={2} z={0}>\n\t\t\t\t\t<MonochromeBox\n\t\t\t\t\t\tfill={Color('#ffffff7f')}\n\t\t\t\t\t\tonClick={() => window.alert('Clicky click!')}\n\t\t\t\t\t/>\n\t\t\t\t</Anchor>\n\t\t\t</Viewport>\n\t\t</Backdrop>\n\t\t<Backdrop>\n\t\t\t<Viewport center={{ x: 1, y: 0, z: 0.5 }}>\n\t\t\t\t<Anchor x={0} y={0} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={1} y={0} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={2} y={0} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t\t<Anchor x={2} y={-1} z={0}>\n\t\t\t\t\t<MonochromeBox />\n\t\t\t\t</Anchor>\n\t\t\t</Viewport>\n\t\t</Backdrop>\n\t</>\n);\n\nexport default Demo;\n","import { CoordValue, Length } from '../space/PERSPECTIVE';\nexport interface CoordinateLike {\n\tx: CoordValue;\n\ty: CoordValue;\n\tz: CoordValue;\n}\n\nexport class Coordinate implements CoordinateLike {\n\tx: CoordValue;\n\ty: CoordValue;\n\tz: CoordValue;\n\n\tconstructor(x: CoordValue, y: CoordValue, z: CoordValue) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t}\n\n\tequals(coord: CoordinateLike) {\n\t\treturn (\n\t\t\tthis === coord ||\n\t\t\t(coord && this.x === coord.x && this.y === coord.y && this.z === coord.z)\n\t\t);\n\t}\n\n\ttransform(dx: Length = 0, dy: Length = 0, dz: Length = 0) {\n\t\tthis.x += dx;\n\t\tthis.y += dy;\n\t\tthis.z += dz;\n\n\t\treturn this;\n\t}\n\n\thasNaN() {\n\t\treturn isNaN(this.x) || isNaN(this.y) || isNaN(this.z);\n\t}\n\n\tmanhattanDistanceTo(coord: CoordinateLike) {\n\t\treturn Math.abs(this.x - coord.x) + Math.abs(this.y - coord.y) + Math.abs(this.z - coord.z);\n\t}\n\n\teuclideanDistanceTo(coord: CoordinateLike) {\n\t\tconst xy = Math.sqrt((this.x - coord.x) ** 2 + (this.y - coord.y) ** 2);\n\t\tconst xyz = Math.sqrt(xy ** 2 + (this.z - coord.z) ** 2);\n\t\treturn xyz;\n\t}\n\n\t// For debugging purposes only, may change without notice or tests\n\ttoString() {\n\t\treturn [this.x, this.y, this.z].join(',');\n\t}\n\n\tstatic clone(coord: CoordinateLike) {\n\t\treturn new Coordinate(coord.x, coord.y, coord.z);\n\t}\n}\n","import Color from 'color';\nimport React, { FunctionComponent } from 'react';\n\nimport { CoordArray, PERSPECTIVE } from './PERSPECTIVE';\n\nconst BORDER_WIDTH = 1;\nconst BORDER_NODES: CoordArray[] = [\n\t[1, 0, 0],\n\t[1, 1, 0],\n\t[0, 1, 0],\n\t[0, 0, 0]\n];\n\nlet spatialCoordinates = BORDER_NODES.map(coordinate => PERSPECTIVE.toPixels(...coordinate)).map(\n\tcc => cc.map(c => c + BORDER_WIDTH)\n);\n\nexport const MonochromeTile: FunctionComponent<\n\tOmit<React.SVGProps<SVGPolygonElement>, 'fill'> & {\n\t\tzoom?: number;\n\t\tfill?: Color;\n\t\tstroke?: Color;\n\t}\n> = ({\n\tfill = Color('#282c34'), //.lighten(0.3),\n\n\tstroke = fill.darken(0.3).saturate(0.3),\n\tstrokeWidth = BORDER_WIDTH,\n\tzoom = 1,\n\t...rest\n}) => {\n\treturn (\n\t\t<polygon\n\t\t\tpoints={spatialCoordinates.map(c => c.map(c => c * zoom).join(',')).join(' ')}\n\t\t\tstroke={stroke.string()}\n\t\t\tfill={fill.string()}\n\t\t\tstrokeWidth={strokeWidth}\n\t\t\t{...rest}\n\t\t/>\n\t);\n};\n","import { DependencyList, useCallback, useEffect } from 'react';\n\ntype EventHandler<EventData extends Array<unknown>> = (...args: EventData) => void;\ntype EventDestroyer = () => void;\n\n/**\n *  Consitutes one named event type\n */\nexport class Event<EventData extends Array<unknown> = []> {\n\tprivate listeners: EventHandler<EventData>[] = [];\n\n\ton(callback: EventHandler<EventData>) {\n\t\tthis.listeners.push(callback);\n\n\t\treturn () => {\n\t\t\tthis.listeners.splice(this.listeners.indexOf(callback));\n\t\t};\n\t}\n\n\temit(...args: EventData) {\n\t\tthis.listeners.forEach(callback => callback(...args));\n\t}\n\n\tclear() {\n\t\tthis.listeners = [];\n\t}\n}\n\n/**\n * A conventience wrapper for `useEffect` specifically for listening to a list of events, and unlistening when the\n * component is unmounted.\n *\n * For example:\n *\n *   useEventListeners(() => [\n *       entity.moveStart.on(coordinate => animatePosition(coordinate)),\n *       entity.moveRest.on(coordinate => console.log('Done'))\n *   ], [entity.moveStart, entity.moveRest]);\n */\nexport const useEventListeners = (callback: () => EventDestroyer[], deps: DependencyList = []) => {\n\tconst cb = useCallback(\n\t\t() => {\n\t\t\tconst eventDestroyers = callback();\n\t\t\treturn () => eventDestroyers.forEach(d => d());\n\t\t},\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t\tdeps\n\t);\n\treturn useEffect(cb, [cb]);\n};\n","import { FunctionComponent, useCallback, useState } from 'react';\nimport { Job } from '../jobs/Patrol';\nimport { MovingAnchor } from '../space/Anchor';\nimport { Coordinate } from '../classes/Coordinate';\nimport { Event, useEventListeners } from '../util/events';\nconst noop = () => {};\n\nexport class Entity {\n\tpublic readonly id: string;\n\n\t/**\n\t * The event that an entity was instructed to moveTo()\n\t */\n\tpublic readonly moveStart = new Event<[Coordinate]>();\n\n\t/**\n\t * The event that this entity has completed a moveTo(), according to react-spring's timing\n\t */\n\tpublic readonly moveRest = new Event<[Coordinate]>();\n\n\t/**\n\t * The React SVG component that consitutes this entity. Is expected to be defined in a class\n\t * that extends `Entity`.\n\t */\n\tpublic readonly Component: FunctionComponent = () => {\n\t\treturn null;\n\t};\n\n\tpublic location: Coordinate;\n\n\t/**\n\t * The set of behaviour/tasks given to this entity.\n\t */\n\tpublic job?: Job;\n\n\tconstructor(id: string, location: Coordinate) {\n\t\tthis.id = id;\n\t\tthis.location = location;\n\n\t\t// Movement handling\n\t\tthis.moveRest.on((loc) => {\n\t\t\tthis.location = loc;\n\t\t});\n\t}\n\n\tpublic play() {\n\t\treturn this.job?.start() || noop;\n\t}\n\n\tpublic doJob(job: Job) {\n\t\tthis.job = job;\n\n\t\t// @TODO maybe some events\n\t}\n\n\t/**\n\t * Move entity directly to a coordinate. Does not consider accessibility or closeness.\n\t */\n\tpublic moveTo(coordinate: Coordinate) {\n\t\tif (coordinate.hasNaN()) {\n\t\t\tdebugger;\n\t\t}\n\t\tthis.moveStart.emit(coordinate);\n\t}\n}\n\n/**\n * A component that automatically transitions the entity component as per its move instructions\n */\nexport const EntityComponent: FunctionComponent<{ entity: Entity }> = ({ entity }) => {\n\tconst [{ destination, duration }, animatePosition] = useState({\n\t\tdestination: entity.location,\n\t\tduration: 0\n\t});\n\n\tuseEventListeners(\n\t\t() => [\n\t\t\t// Listen for the entity moveStart order;\n\t\t\tentity.moveStart.on((destination) =>\n\t\t\t\tanimatePosition({\n\t\t\t\t\tdestination,\n\t\t\t\t\tduration: entity.location.euclideanDistanceTo(destination) * 100\n\t\t\t\t})\n\t\t\t)\n\t\t],\n\t\t[entity.moveStart]\n\t);\n\n\tconst onRest = useCallback(\n\t\t() => entity.moveRest.emit(destination),\n\t\t[entity.moveRest, destination]\n\t);\n\n\treturn (\n\t\t<MovingAnchor moveTo={destination} moveSpeed={duration} onRest={onRest}>\n\t\t\t<entity.Component />\n\t\t</MovingAnchor>\n\t);\n};\n","import Color from 'color';\nimport React, { FunctionComponent } from 'react';\nimport { Anchor } from '../space/Anchor';\nimport { Coordinate } from '../classes/Coordinate';\nimport { MonochromeTile } from '../space/MonochromeTile';\nimport { Entity } from './Entity';\n\nconst zoom = 0.5;\nconst translate = zoom / 2;\nconst offset = new Coordinate(-translate, -translate, 0);\n\nexport class GuardEntity extends Entity {\n\tComponent: FunctionComponent = () => {\n\t\treturn (\n\t\t\t<Anchor {...offset}>\n\t\t\t\t<MonochromeTile zoom={zoom} fill={Color('#ff0000')} />\n\t\t\t</Anchor>\n\t\t);\n\t};\n}\n","import { Coordinate, CoordinateLike } from './Coordinate';\n\n/**\n * A special type of coordinate that is equal to another terrain coordinate when the X and Y are equal, disregarding Z.\n */\nexport class TerrainCoordinate extends Coordinate {\n\tequals(coord: CoordinateLike) {\n\t\treturn this === coord || (coord && this.x === coord.x && this.y === coord.y);\n\t}\n\tstatic clone(coord: CoordinateLike) {\n\t\treturn new TerrainCoordinate(coord.x, coord.y, coord.z);\n\t}\n}\n","/**\n * Adapted from\n *   https://github.com/hunterloftis/playfuljs-demos/blob/gh-pages/terrain/index.html#L118\n */\n\nexport const OUT_OF_BOUNDS = Symbol();\n\nfunction average(values: Array<number | typeof OUT_OF_BOUNDS>) {\n\tvar valid = values.filter((val): val is number => typeof val === 'number');\n\tvar total = valid.reduce<number>((sum, val) => sum + val, 0);\n\treturn total / valid.length;\n}\n\nexport class TerrainGenerator {\n\tprivate size: number;\n\tprivate max: number;\n\tprivate map: Float32Array;\n\n\tconstructor(size: number) {\n\t\tconst detail = Math.ceil(Math.log(size) / Math.log(2));\n\t\tthis.size = Math.pow(2, detail) + 1;\n\t\tthis.max = this.size - 1;\n\t\tthis.map = new Float32Array(this.size * this.size);\n\t}\n\n\tpublic generate(roughness: number) {\n\t\tthis.set(0, 0, this.max);\n\t\tthis.set(this.max, 0, this.max / 2);\n\t\tthis.set(this.max, this.max, 0);\n\t\tthis.set(0, this.max, this.max / 2);\n\n\t\tthis.divide(this.max, roughness);\n\t}\n\n\tpublic get(x: number, y: number) {\n\t\tif (x < 0 || x > this.max || y < 0 || y > this.max) {\n\t\t\treturn OUT_OF_BOUNDS;\n\t\t}\n\t\treturn this.map[x + this.size * y];\n\t}\n\n\tprivate set(x: number, y: number, val: number) {\n\t\tthis.map[x + this.size * y] = val;\n\t}\n\n\tprivate divide(size: number, roughness: number) {\n\t\tvar x,\n\t\t\ty,\n\t\t\thalf = size / 2;\n\t\tvar scale = roughness * size;\n\t\tif (half < 1) return;\n\n\t\tfor (y = half; y < this.max; y += size) {\n\t\t\tfor (x = half; x < this.max; x += size) {\n\t\t\t\tthis.square(x, y, half, Math.random() * scale * 2 - scale);\n\t\t\t}\n\t\t}\n\t\tfor (y = 0; y <= this.max; y += half) {\n\t\t\tfor (x = (y + half) % size; x <= this.max; x += size) {\n\t\t\t\tthis.diamond(x, y, half, Math.random() * scale * 2 - scale);\n\t\t\t}\n\t\t}\n\t\tthis.divide(size / 2, roughness);\n\t}\n\n\tprivate square(x: number, y: number, size: number, offset: number) {\n\t\tvar ave = average([\n\t\t\tthis.get(x - size, y - size), // upper left\n\t\t\tthis.get(x + size, y - size), // upper right\n\t\t\tthis.get(x + size, y + size), // lower right\n\t\t\tthis.get(x - size, y + size) // lower left\n\t\t]);\n\t\tthis.set(x, y, ave + offset);\n\t}\n\n\tprivate diamond(x: number, y: number, size: number, offset: number) {\n\t\tvar ave = average([\n\t\t\tthis.get(x, y - size), // top\n\t\t\tthis.get(x + size, y), // right\n\t\t\tthis.get(x, y + size), // bottom\n\t\t\tthis.get(x - size, y) // left\n\t\t]);\n\t\tthis.set(x, y, ave + offset);\n\t}\n}\n","import { distanceToCameraComparator } from '../space/PERSPECTIVE';\nimport { TerrainCoordinate } from './TerrainCoordinate';\nimport { OUT_OF_BOUNDS, TerrainGenerator } from './TerrainGenerator';\n\nexport class Terrain {\n\tpublic readonly coordinates: TerrainCoordinate[];\n\tprivate coordinatesInRenderOrder: TerrainCoordinate[] | null = null;\n\tprivate readonly size: number;\n\n\tconstructor(coordinates: TerrainCoordinate[]) {\n\t\tthis.coordinates = coordinates;\n\t\tthis.size = Math.sqrt(this.coordinates.length);\n\t}\n\n\tprivate getIndexForXy(x: number, y: number) {\n\t\treturn this.size * y + x;\n\t}\n\n\tpublic getAtXy(x: number, y: number) {\n\t\tif (x < 0 || x > this.size - 1 || y < 0 || y > this.size - 1) {\n\t\t\t// Out of bounds\n\t\t\treturn;\n\t\t}\n\t\treturn this.coordinates[this.getIndexForXy(x, y)];\n\t}\n\n\tpublic getNeighbors(center: TerrainCoordinate) {\n\t\treturn [\n\t\t\t[-1, 0],\n\t\t\t[1, 0],\n\t\t\t[0, -1],\n\t\t\t[0, 1]\n\t\t\t// Diagonal neigbors not included\n\t\t]\n\t\t\t.map(([dx, dy]) => this.getAtXy(center.x + dx, center.y + dy))\n\t\t\t.filter(Boolean) as TerrainCoordinate[];\n\t}\n\n\tpublic getCoordinatesInRenderOrder() {\n\t\tif (!this.coordinatesInRenderOrder) {\n\t\t\tthis.coordinatesInRenderOrder = this.coordinates\n\t\t\t\t.slice()\n\t\t\t\t.sort(distanceToCameraComparator);\n\t\t}\n\t\treturn this.coordinatesInRenderOrder;\n\t}\n\n\tstatic generateRandom(size: number) {\n\t\tconst generator = new TerrainGenerator(size + 3);\n\t\tgenerator.generate(1);\n\n\t\t// For clarity, the terrain must currently always be square\n\t\t// @TODO fix that some time.\n\t\tconst width = size,\n\t\t\theight = size;\n\n\t\tconst coordinates = Array.from(new Array(width * height)).map((_, i) => {\n\t\t\tconst x = i % width;\n\t\t\tconst y = Math.floor(i / width);\n\t\t\tconst z = generator.get(x, y);\n\t\t\tif (z === OUT_OF_BOUNDS) {\n\t\t\t\tthrow new Error(`Out of bounds @ ${x}, ${y}`);\n\t\t\t}\n\t\t\treturn new TerrainCoordinate(x, y, ((z as number) - 512) / 20);\n\t\t});\n\t\treturn new Terrain(coordinates);\n\t}\n}\n","import { Entity } from '../entities/Entity';\nimport { GuardEntity } from '../entities/GuardEntity';\nimport { Terrain } from './Terrain';\nimport { TerrainCoordinate } from './TerrainCoordinate';\n\nexport class Scene {\n\tpublic readonly terrain: Terrain;\n\n\t// @TODO change to not readonly, and handle spontaneous changes\n\tpublic readonly entities: Entity[];\n\n\tconstructor(terrain: Terrain, entities: Entity[]) {\n\t\tthis.terrain = terrain;\n\t\tthis.entities = entities;\n\t}\n\n\tplay() {\n\t\tconst destroyers = this.entities.map((entity) => entity.play());\n\t\treturn () => destroyers.forEach((d) => d());\n\t}\n\n\tstatic generateRandom(size: number) {\n\t\tconst terrain = Terrain.generateRandom(size);\n\t\tconst entities = Array.from(new Array(Math.round(size ** 2 / 90))).map(\n\t\t\t(_, i) =>\n\t\t\t\tnew GuardEntity(\n\t\t\t\t\t'guard-' + i,\n\t\t\t\t\tterrain.getAtXy(\n\t\t\t\t\t\tMath.floor(Math.random() * (size - 1)),\n\t\t\t\t\t\tMath.floor(Math.random() * (size - 1))\n\t\t\t\t\t) as TerrainCoordinate\n\t\t\t\t)\n\t\t);\n\t\treturn new Scene(terrain, entities);\n\t}\n}\n","import { Entity } from '../entities/Entity';\nimport { Coordinate } from '../classes/Coordinate';\n\nexport class Job {\n\tentity: Entity;\n\tconstructor(entity: Entity) {\n\t\tthis.entity = entity;\n\t}\n\tstart() {\n\t\tthrow new Error(`Not implemented for ${this.constructor.name}`);\n\t}\n}\n\nexport class PatrolJob extends Job {\n\twaypoints: Coordinate[];\n\twaypointIndex: number;\n\n\tconstructor(entity: Entity, waypoints: Coordinate[]) {\n\t\tsuper(entity);\n\t\tif (waypoints.length < 2) {\n\t\t\tthrow new Error('A patrol must have at least 2 waypoints');\n\t\t}\n\t\tthis.waypoints = waypoints;\n\t\tthis.waypointIndex = 0;\n\t}\n\n\tstart() {\n\t\tconst destroyers = [\n\t\t\tthis.entity.moveRest.on(() => {\n\t\t\t\t// Guards move from one waypoint to another, pausing for a random amount of time in between\n\t\t\t\tthis.waypointIndex = (this.waypointIndex + 1) % this.waypoints.length;\n\t\t\t\tsetTimeout(\n\t\t\t\t\t() => this.entity.moveTo(this.waypoints[this.waypointIndex]),\n\t\t\t\t\t500 + Math.random() * 1000\n\t\t\t\t);\n\t\t\t})\n\t\t];\n\n\t\tthis.entity.moveTo(this.waypoints[0]);\n\t\treturn () => destroyers.forEach((d) => d());\n\t}\n}\n","// const ActiveEntityOverlay: FunctionComponent = ({ children }) => null;\n\nimport styled from '@emotion/styled';\nimport React, { FunctionComponent } from 'react';\n\n// const ActiveEntityOverlay: FunctionComponent = ({ children }) => null;\nconst ActiveEntityOverlayWrapper = styled.section`\n  position: absolute;\n  bottom: 0;\n  left: 0;\n`;\n\nexport const ActiveEntityOverlay: FunctionComponent = () => (\n  <ActiveEntityOverlayWrapper>\n    <p>Heyyoo</p>\n  </ActiveEntityOverlayWrapper>\n);\n","import Color from 'color';\nimport React, { FunctionComponent, useEffect, useMemo, useState } from 'react';\nimport { Coordinate } from '../classes/Coordinate';\nimport { Scene } from '../classes/Scene';\nimport { TerrainCoordinate } from '../classes/TerrainCoordinate';\nimport { EntityComponent } from '../entities/Entity';\nimport { PatrolJob } from '../jobs/Patrol';\nimport { Anchor } from '../space/Anchor';\nimport { MonochromeBox } from '../space/MonochromeBox';\nimport { distanceToCameraComparator } from '../space/PERSPECTIVE';\nimport { Viewport } from '../space/Viewport';\nimport { ActiveEntityOverlay } from '../ui/ActiveEntityOverlay';\n\nconst HelloWorldSceneTerrain: FunctionComponent<\n\t{\n\t\tcoordinate: Coordinate;\n\t} & (typeof MonochromeBox extends FunctionComponent<infer T> ? T : {})\n> = ({ coordinate: coord, ...monochromeBoxProps }) => {\n\tconst [isHovered, setIsHovered] = useState(false);\n\tconst translated = Coordinate.clone(coord).transform(-0.5, -0.5, -1);\n\treturn (\n\t\t<Anchor key={translated.toString()} x={translated.x} y={translated.y} z={translated.z}>\n\t\t\t<MonochromeBox\n\t\t\t\t{...monochromeBoxProps}\n\t\t\t\tfill={isHovered ? Color('#282c34').lighten(1) : undefined}\n\t\t\t\tstroke={isHovered ? Color('#fff') : undefined}\n\t\t\t\tinnerStroke={isHovered ? Color('#ccd1dd') : undefined}\n\t\t\t\tonMouseEnter={() => setIsHovered(true)}\n\t\t\t\tonMouseLeave={() => setIsHovered(false)}\n\t\t\t/>\n\t\t</Anchor>\n\t);\n};\n\nconst WORLD_SIZE = 40;\nfunction getRandomLocation(scene: Scene) {\n\treturn scene.terrain.getAtXy(\n\t\tMath.floor(Math.random() * (WORLD_SIZE - 1)),\n\t\tMath.floor(Math.random() * (WORLD_SIZE - 1))\n\t) as TerrainCoordinate;\n}\n\nconst Demo: FunctionComponent = () => {\n\tconst scene = useMemo(() => {\n\t\tconst scene = Scene.generateRandom(WORLD_SIZE);\n\t\tscene.entities.forEach(guard =>\n\t\t\tguard.doJob(\n\t\t\t\tnew PatrolJob(\n\t\t\t\t\tguard,\n\t\t\t\t\tArray.from(new Array(2 + Math.floor(Math.random() * 4))).map(() =>\n\t\t\t\t\t\tgetRandomLocation(scene)\n\t\t\t\t\t)\n\t\t\t\t)\n\t\t\t)\n\t\t);\n\n\t\t(window as any).scene = scene;\n\t\treturn scene;\n\t}, []);\n\n\tuseEffect(() => {\n\t\tconsole.log('--- Scene#play ---');\n\t\treturn scene.play();\n\t}, [scene]);\n\n\tconst [centerCoord, setCenterCoord] = useState(\n\t\tscene.terrain.getAtXy(Math.floor(WORLD_SIZE / 2), Math.floor(WORLD_SIZE / 2))\n\t);\n\n\tconst zoomFactor = 1;\n\n\tconst terrain = useMemo(\n\t\t() =>\n\t\t\tscene.terrain.getCoordinatesInRenderOrder().map(coord => (\n\t\t\t\t<HelloWorldSceneTerrain\n\t\t\t\t\tkey={coord.toString()}\n\t\t\t\t\tcoordinate={coord}\n\t\t\t\t\tonClick={event => {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tsetCenterCoord(coord);\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t)),\n\t\t[scene.terrain]\n\t);\n\n\tconst entities = useMemo(\n\t\t() =>\n\t\t\tscene.entities\n\t\t\t\t.slice()\n\t\t\t\t.sort((a, b) => distanceToCameraComparator(a.location, b.location))\n\t\t\t\t.map(entity => <EntityComponent key={entity.id} entity={entity} />),\n\t\t[scene.entities]\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t<Viewport center={centerCoord} zoom={zoomFactor}>\n\t\t\t\t<g id=\"scene-terrain\">{terrain}</g>\n\t\t\t\t<g id=\"scene-entities\">{entities}</g>\n\t\t\t</Viewport>\n\t\t\t<ActiveEntityOverlay />\n\t\t</>\n\t);\n};\nexport default Demo;\n","import React from 'react';\nimport { Route, Switch } from 'react-router';\nimport { Link } from 'react-router-dom';\nimport DemoCubes from './demos/demo.cubes';\nimport SceneHelloWorld from './demos/scene.hello-world';\n\nfunction Demos() {\n\treturn (\n\t\t<>\n\t\t\t<ul>\n\t\t\t\t<li>\n\t\t\t\t\t<Link to=\"/tests\">Tests</Link>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t<Route exact path=\"/tests\" component={DemoCubes} />\n\t\t</>\n\t);\n}\n\nfunction App() {\n\treturn (\n\t\t<Switch>\n\t\t\t<Route exact path=\"/\" component={SceneHelloWorld} />\n\t\t\t<Route component={Demos} />\n\t\t</Switch>\n\t);\n}\n\nexport default App;\n","export default __webpack_public_path__ + \"static/media/nebula-282c34.dda754f6.png\";","import { css } from '@emotion/react';\nimport nebulaTexture from './textures/nebula-282c34.png';\n\nconst styles = css`\n\tbody {\n\t\tbackground: url(${nebulaTexture});\n\t}\n`;\n\nexport default styles;\n","import { Global } from '@emotion/react';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport { HashRouter } from 'react-router-dom';\n\nimport App from './App';\nimport globalStyleRules from './styles';\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<Global styles={globalStyleRules} />\n\t\t<HashRouter hashType={'slash'}>\n\t\t\t<App />\n\t\t</HashRouter>\n\t</React.StrictMode>,\n\tdocument.getElementById('root')\n);\n"],"sourceRoot":""}